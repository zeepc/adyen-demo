{"version":3,"file":"SRPanel.js","sources":["../../../../src/core/Errors/SRPanel.tsx"],"sourcesContent":["import { h } from 'preact';\nimport { AriaAttributes, SRPanelProps } from './types';\nimport BaseElement from '../../components/internal/BaseElement/BaseElement';\nimport { SRMessages, SRMessagesRef } from './SRMessages';\nimport type { ICore } from '../types';\nimport './SRPanel.scss';\n\n/**\n * A panel meant to hold messages that will be read out by ScreenReaders on an aria-live=\"polite\" basis\n * Expects a string or string array of message to add to the panel to be read out\n * For testing purposes can be made visible\n */\nexport class SRPanel extends BaseElement<SRPanelProps> {\n    public static type = 'srPanel';\n\n    public static defaultProps: Partial<SRPanelProps> = {\n        enabled: true,\n        node: 'body',\n        showPanel: false,\n        id: 'ariaLiveSRPanel',\n        ariaAttributes: {\n            'aria-relevant': 'all',\n            'aria-live': 'polite',\n            'aria-atomic': 'true'\n        }\n    };\n\n    private readonly srPanelContainer = null;\n\n    private readonly id;\n    private readonly showPanel;\n    private readonly _enabled: boolean;\n    private readonly _moveFocus: boolean;\n\n    private componentRef: SRMessagesRef;\n\n    constructor(checkout: ICore, props?: SRPanelProps) {\n        super(checkout, props);\n\n        this.id = this.props.id;\n        this.showPanel = process.env.NODE_ENV !== 'production' ? this.props.showPanel : false;\n        this._enabled = false;\n        this._moveFocus = this.props.moveFocus ?? true;\n\n        if (this.props.enabled) {\n            this._enabled = true;\n\n            const panelParent = document.querySelector(this.props.node);\n\n            if (panelParent) {\n                const preExistingSRPanel = document.getElementById(this.id);\n                if (preExistingSRPanel) {\n                    panelParent.removeChild(preExistingSRPanel);\n                }\n\n                this.srPanelContainer = document.createElement('div');\n                this.srPanelContainer.className = 'sr-panel-holder';\n                this.srPanelContainer.id = this.id;\n\n                panelParent.appendChild(this.srPanelContainer);\n\n                this.mount(this.srPanelContainer);\n            } else {\n                throw new Error('Component could not mount. Root node was not found.');\n            }\n        }\n    }\n\n    public setComponentRef = ref => {\n        this.componentRef = ref;\n    };\n\n    public get enabled() {\n        return this._enabled;\n    }\n\n    public get moveFocus() {\n        return this._moveFocus;\n    }\n\n    public setAriaProps(ariaAttributes: AriaAttributes): void {\n        if (!this.props.enabled) return;\n\n        const firstPanel = document.querySelector('[class^=\"adyen-checkout-sr-panel\"]');\n\n        if (!firstPanel) {\n            console.error('SRPanel: Failed to set aria props because no panel was found');\n            return;\n        }\n\n        for (const [key, value] of Object.entries(ariaAttributes)) {\n            firstPanel.setAttribute(key, value);\n        }\n        this.props = { ...this.props, ariaAttributes: { ...this.props.ariaAttributes, ...ariaAttributes } };\n    }\n\n    // A method we can expose to allow comps to set messages in this panel\n    public setMessages = (messages: string[] | string): void => {\n        if (!this.props.enabled) return;\n\n        let panelMessages = null;\n        if (messages) {\n            // Ensure panelMessages is an array\n            panelMessages = Array.isArray(messages) ? messages : [messages];\n        }\n\n        this.componentRef.setMessages(panelMessages);\n    };\n\n    render() {\n        if (!this.props.enabled) return null;\n        return (\n            <div\n                className={this.showPanel ? 'adyen-checkout-sr-panel' : 'adyen-checkout-sr-panel--sr-only'}\n                role={'log'}\n                {...this.props.ariaAttributes}\n                {...(process.env.NODE_ENV !== 'production' && { 'data-testid': this.id })}\n            >\n                <SRMessages setComponentRef={this.setComponentRef} />\n            </div>\n        );\n    }\n}\n"],"names":["SRPanel","BaseElement","enabled","this","_enabled","moveFocus","_moveFocus","setAriaProps","ariaAttributes","props","firstPanel","document","querySelector","key","value","Object","entries","setAttribute","_object_spread_props","_object_spread","console","error","render","h","div","className","showPanel","role","SRMessages","setComponentRef","constructor","checkout","_this_props_moveFocus","super","_define_property","srPanelContainer","id","componentRef","ref","setMessages","messages","panelMessages","Array","isArray","panelParent","node","Error","preExistingSRPanel","getElementById","removeChild","createElement","appendChild","mount","type","defaultProps"],"mappings":"+9BAYO,MAAMA,UAAgBC,EA4DzB,WAAWC,GACP,OAAOC,KAAKC,QAChB,CAEA,aAAWC,GACP,OAAOF,KAAKG,UAChB,CAEOC,YAAAA,CAAaC,GAChB,IAAKL,KAAKM,MAAMP,QAAS,OAEzB,MAAMQ,EAAaC,SAASC,cAAc,sCAE1C,GAAKF,EAAL,CAKA,IAAK,MAAOG,EAAKC,KAAUC,OAAOC,QAAQR,GACtCE,EAAWO,aAAaJ,EAAKC,GAEjCX,KAAKM,MAAQS,EAAAC,EAAA,CAAA,EAAKhB,KAAKM,OAAK,CAAED,eAAgBW,KAAKhB,KAAKM,MAAMD,eAAmBA,IALjF,MAFIY,QAAQC,MAAM,+DAQtB,CAeAC,MAAAA,GACI,OAAKnB,KAAKM,MAAMP,QAEZqB,EAACC,MAAAA,EAAAA,CACGC,UAAWtB,KAAKuB,UAAY,0BAA4B,mCACxDC,KAAM,OACFxB,KAAKM,MAAMD,gBACV,GAELe,EAACK,EAAAA,CAAWC,gBAAiB1B,KAAK0B,mBARV,IAWpC,CArFA,WAAAC,CAAYC,EAAiBtB,GAMP,IAAAuB,EAElB,GAPAC,MAAMF,EAAUtB,GAVpByB,EAAA/B,KAAiBgC,mBAAmB,MAEpCD,EAAA/B,KAAiBiC,aACjBF,EAAA/B,KAAiBuB,oBACjBQ,EAAA/B,KAAiBC,mBACjB8B,EAAA/B,KAAiBG,qBAEjB4B,EAAA/B,KAAQkC,uBAkCRH,EAAA/B,KAAO0B,kBAAkBS,IACrBnC,KAAKkC,aAAeC,IA4BxBJ,EAAA/B,KAAOoC,cAAeC,IAClB,IAAKrC,KAAKM,MAAMP,QAAS,OAEzB,IAAIuC,EAAgB,KAChBD,IAEAC,EAAgBC,MAAMC,QAAQH,GAAYA,EAAW,CAACA,IAG1DrC,KAAKkC,aAAaE,YAAYE,KAnE9BtC,KAAKiC,GAAKjC,KAAKM,MAAM2B,GACrBjC,KAAKuB,WAA2E,EAChFvB,KAAKC,UAAW,EAChBD,KAAKG,WAAiC,QAApB0B,EAAA7B,KAAKM,MAAMJ,iBAAX,IAAA2B,GAAAA,EAEd7B,KAAKM,MAAMP,QAAS,CACpBC,KAAKC,UAAW,EAEhB,MAAMwC,EAAcjC,SAASC,cAAcT,KAAKM,MAAMoC,MAEtD,IAAID,EAcA,MAAM,IAAIE,MAAM,uDAdH,CACb,MAAMC,EAAqBpC,SAASqC,eAAe7C,KAAKiC,IACpDW,GACAH,EAAYK,YAAYF,GAG5B5C,KAAKgC,iBAAmBxB,SAASuC,cAAc,OAC/C/C,KAAKgC,iBAAiBV,UAAY,kBAClCtB,KAAKgC,iBAAiBC,GAAKjC,KAAKiC,GAEhCQ,EAAYO,YAAYhD,KAAKgC,kBAE7BhC,KAAKiD,MAAMjD,KAAKgC,iBACpB,CAGJ,CACJ,EArDAD,EADSlC,EACKqD,OAAO,WAErBnB,EAHSlC,EAGKsD,eAAsC,CAChDpD,SAAS,EACT2C,KAAM,OACNnB,WAAW,EACXU,GAAI,kBACJ5B,eAAgB,CACZ,gBAAiB,MACjB,YAAa,SACb,cAAe"}