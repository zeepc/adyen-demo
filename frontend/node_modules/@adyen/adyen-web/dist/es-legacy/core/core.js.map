{"version":3,"file":"core.js","sources":["../../../src/core/core.ts"],"sourcesContent":["import Language from '../language';\nimport UIElement from '../components/internal/UIElement/UIElement';\nimport RiskModule from './RiskModule';\nimport PaymentMethods from './ProcessResponse/PaymentMethods';\nimport getComponentForAction from './ProcessResponse/PaymentAction';\nimport Analytics from './Analytics';\nimport { assertConfigurationPropertiesAreValid, processGlobalOptions } from './utils';\nimport Session from './CheckoutSession';\nimport { hasOwnProperty } from '../utils/hasOwnProperty';\nimport { Resources } from './Context/Resources';\nimport { SRPanel } from './Errors/SRPanel';\nimport registry, { NewableComponent } from './core.registry';\nimport { cleanupFinalResult, sanitizeResponse, verifyPaymentDidNotFail } from '../components/internal/UIElement/utils';\nimport AdyenCheckoutError, { IMPLEMENTATION_ERROR } from './Errors/AdyenCheckoutError';\nimport { THREEDS2_FULL } from '../components/ThreeDS2/constants';\nimport { DEFAULT_LOCALE } from '../language/constants';\nimport getTranslations from './Services/get-translations';\nimport { defaultProps } from './core.defaultProps';\nimport { formatCustomTranslations, formatLocale } from '../language/utils';\nimport { resolveEnvironments } from './Environment';\nimport { LIBRARY_BUNDLE_TYPE, LIBRARY_VERSION } from './config';\n\nimport type { PaymentAction, PaymentAmount, PaymentResponseData } from '../types/global-types';\nimport type { CoreConfiguration, ICore, AdditionalDetailsData, CoreModules } from './types';\nimport type { Translations } from '../language/types';\nimport type { UIElementProps } from '../components/internal/UIElement/types';\nimport { AnalyticsLogEvent, LogEventType } from './Analytics/events/AnalyticsLogEvent';\nimport CancelError from './Errors/CancelError';\nimport { AnalyticsService } from './Analytics/AnalyticsService';\nimport { AnalyticsEventQueue } from './Analytics/AnalyticsEventQueue';\nimport { isAmountValid } from '../utils/amount-util';\n\nclass Core implements ICore {\n    public session?: Session;\n    public paymentMethodsResponse: PaymentMethods;\n    public modules: CoreModules;\n    public options: CoreConfiguration;\n\n    public analyticsContext: string;\n    public loadingContext: string;\n    public cdnImagesUrl: string;\n    public cdnTranslationsUrl: string;\n\n    private components: UIElement[] = [];\n\n    public static readonly metadata = {\n        version: LIBRARY_VERSION,\n        bundleType: LIBRARY_BUNDLE_TYPE\n    };\n\n    public static registry = registry;\n\n    public static setBundleType(type: string): void {\n        Core.metadata.bundleType = type;\n    }\n\n    public static register(...items: NewableComponent[]) {\n        registry.add(...items);\n    }\n\n    /**\n     * Used internally by the PaymentMethod components to auto-register themselves\n     * @internal\n     */\n    public register(...items: NewableComponent[]) {\n        registry.add(...items);\n    }\n\n    public getComponent(txVariant: string) {\n        return registry.getComponent(txVariant);\n    }\n\n    constructor(props: CoreConfiguration) {\n        assertConfigurationPropertiesAreValid(props);\n\n        this.createFromAction = this.createFromAction.bind(this);\n        this.update = this.update.bind(this);\n\n        this.setOptions({ ...defaultProps, ...props });\n\n        const { apiUrl, analyticsUrl, cdnImagesUrl, cdnTranslationsUrl } = resolveEnvironments(\n            this.options.environment,\n            this.options._environmentUrls\n        );\n\n        this.loadingContext = apiUrl;\n        this.analyticsContext = analyticsUrl;\n        this.cdnImagesUrl = cdnImagesUrl;\n        this.cdnTranslationsUrl = cdnTranslationsUrl;\n\n        this.session = this.options.session && new Session(this.options.session, this.options.clientKey, this.loadingContext);\n\n        const clientKeyType = this.options.clientKey?.substring(0, 4);\n        if ((clientKeyType === 'test' || clientKeyType === 'live') && !this.loadingContext.includes(clientKeyType)) {\n            throw new AdyenCheckoutError(\n                'IMPLEMENTATION_ERROR',\n                `Error: you are using a ${clientKeyType} clientKey against the ${this.options._environmentUrls?.api || this.options.environment} environment`\n            );\n        }\n        if (clientKeyType === 'pub.') {\n            console.debug(\n                `The value you are passing as your \"clientKey\" looks like an originKey (${this.options.clientKey?.substring(0, 12)}..). Although this is supported it is not the recommended way to integrate. To generate a clientKey, see the documentation (https://docs.adyen.com/development-resources/client-side-authentication/migrate-from-origin-key-to-client-key/) for more details.`\n            );\n        }\n\n        if (this.options.exposeLibraryMetadata) {\n            window['AdyenWebMetadata'] = Core.metadata;\n        }\n    }\n\n    public async initialize(): Promise<this> {\n        await this.initializeCore();\n        this.validateCoreConfiguration();\n        await this.createCoreModules();\n        await this.requestAnalyticsAttemptId();\n        return this;\n    }\n\n    private async initializeCore(): Promise<this> {\n        if (this.session) {\n            return this.session\n                .setupSession(this.options)\n                .then(sessionResponse => {\n                    const { amount, shopperLocale, countryCode, paymentMethods, ...rest } = sessionResponse;\n\n                    this.setOptions({\n                        ...rest,\n                        amount: this.options.order ? this.options.order.remainingAmount : amount,\n                        locale: this.options.locale || shopperLocale,\n                        countryCode: this.options.countryCode || countryCode\n                    });\n\n                    this.createPaymentMethodsList(paymentMethods);\n\n                    return this;\n                })\n                .catch(error => {\n                    if (this.options.onError) this.options.onError(error);\n                    return Promise.reject(error);\n                });\n        }\n\n        this.createPaymentMethodsList();\n        return Promise.resolve(this);\n    }\n\n    private async fetchLocaleTranslations(): Promise<Translations> {\n        try {\n            return await getTranslations(this.cdnTranslationsUrl, Core.metadata.version, this.options.locale);\n        } catch (error: unknown) {\n            if (error instanceof AdyenCheckoutError) this.options.onError?.(error);\n            else this.options.onError?.(new AdyenCheckoutError('ERROR', 'Failed to fetch translation', { cause: error }));\n        }\n    }\n\n    private validateCoreConfiguration(): void {\n        // @ts-ignore This property does not exist, although merchants might be using when migrating from v5 to v6\n        if (this.options.paymentMethodsConfiguration) {\n            console.warn('WARNING:  \"paymentMethodsConfiguration\" is supported only by Drop-in.');\n        }\n\n        if (!this.options.countryCode) {\n            throw new AdyenCheckoutError(IMPLEMENTATION_ERROR, 'You must specify a countryCode when initializing checkout.');\n        }\n\n        if (!this.options.locale) {\n            this.setOptions({ locale: DEFAULT_LOCALE });\n        }\n\n        this.options.locale = formatLocale(this.options.locale);\n        this.options.translations = formatCustomTranslations(this.options.translations);\n    }\n\n    /**\n     * Method used when handling redirects. It submits details using 'onAdditionalDetails' or the Sessions flow if available.\n     *\n     * @public\n     * @see {https://docs.adyen.com/online-payments/build-your-integration/?platform=Web&integration=Components&version=5.55.1#handle-the-redirect}\n     * @param details - Details object containing the redirectResult\n     */\n    public submitDetails(details: AdditionalDetailsData['data']): void {\n        let promise = null;\n\n        if (this.options.onAdditionalDetails) {\n            promise = new Promise((resolve, reject) => {\n                this.options.onAdditionalDetails({ data: details }, undefined, { resolve, reject });\n            });\n        }\n\n        if (this.session) {\n            promise = this.session.submitDetails(details).catch(error => {\n                this.options.onError?.(error);\n                return Promise.reject(error);\n            });\n        }\n\n        if (!promise) {\n            this.options.onError?.(\n                new AdyenCheckoutError(\n                    'IMPLEMENTATION_ERROR',\n                    'It can not submit the details. The callback \"onAdditionalDetails\" or the Session is not setup correctly.'\n                )\n            );\n            return;\n        }\n\n        promise\n            .then(sanitizeResponse)\n            .then(verifyPaymentDidNotFail)\n            .then(this.afterAdditionalDetails)\n            .then((response: PaymentResponseData) => {\n                cleanupFinalResult(response);\n                this.options.onPaymentCompleted?.(response);\n            })\n            .catch((e: PaymentResponseData | Error) => {\n                if (e instanceof CancelError) {\n                    return;\n                }\n\n                cleanupFinalResult(e as PaymentResponseData);\n                this.options.onPaymentFailed?.(e as PaymentResponseData);\n            });\n    }\n\n    private readonly afterAdditionalDetails = (response: PaymentResponseData): Promise<PaymentResponseData | Error> => {\n        /**\n         * After the user is redirected back, a request to `/details` or `/paymentDetails` will be made.\n         * Typically, the response will not include an action object, except for the case of `paybybank_pix` payment method.\n         * In terms of `paybybank_pix`, the action UIElement will be created and passed to the `afterAdditionalDetails` callback, allowing it to be mounted on the page.\n         */\n        if (this.options.afterAdditionalDetails && response?.action) {\n            const actionEle = this.createFromAction(response.action);\n            this.options.afterAdditionalDetails(actionEle);\n            return Promise.reject(new CancelError('Handled by afterAdditionalDetails'));\n        }\n        return Promise.resolve(response);\n    };\n\n    /**\n     * Instantiates a new element component ready to be mounted from an action object\n     *\n     * @param action - action defining the component with the component data\n     * @param options - options that will be merged to the global Checkout props\n     * @returns new UIElement\n     */\n    public createFromAction(action: PaymentAction, options = {}): UIElement {\n        if (!action || !action.type) {\n            if (hasOwnProperty(action, 'action') && hasOwnProperty(action, 'resultCode')) {\n                throw new Error(\n                    'createFromAction::Invalid Action - the passed action object itself has an \"action\" property and ' +\n                        'a \"resultCode\": have you passed in the whole response object by mistake?'\n                );\n            }\n            throw new Error('createFromAction::Invalid Action - the passed action object does not have a \"type\" property');\n        }\n\n        if (action.type) {\n            // 'threeDS2' OR 'qrCode', 'voucher', 'redirect', 'await', 'bankTransfer`\n            const component = action.type === THREEDS2_FULL ? `${action.type}${action.subtype}` : action.paymentMethodType;\n\n            const event = new AnalyticsLogEvent({\n                type: LogEventType.action,\n                subType: AnalyticsLogEvent.getSubtypeFromActionType(action.type),\n                message: `${component} action was handled by the SDK`,\n                component\n            });\n            this.modules.analytics.sendAnalytics(event);\n\n            const props = {\n                ...this.getCorePropsForComponent(),\n                ...options\n            };\n\n            return getComponentForAction(this, registry, action, props);\n        }\n\n        return this.handleCreateError();\n    }\n\n    /**\n     * Updates global configurations, resets the internal state and remounts each element.\n     *\n     * @param props - props to update\n     * @param options - Can be used to avoid remounting the elements\n     * @returns this - the Core instance\n     */\n    public update(props: Partial<CoreConfiguration> = {}, { shouldReinitializeCheckout = true } = {}): Promise<this> {\n        if (shouldReinitializeCheckout) {\n            this.setOptions(props);\n\n            return this.initialize().then(() => {\n                this.components.forEach(component => {\n                    // We update only with the new options that have been received\n                    const newProps: Partial<UIElementProps> = {\n                        ...props,\n                        ...(this.session && { session: this.session })\n                    };\n                    component.update(newProps);\n                });\n                return this;\n            });\n        }\n\n        const { amount, secondaryAmount } = props;\n\n        if (amount || secondaryAmount) {\n            this.triggerAmountUpdate(amount, secondaryAmount);\n        }\n\n        return Promise.resolve(this);\n    }\n\n    /**\n     * Validates and propagates amount updates to all mounted components.\n     *\n     * @param amount - Primary payment amount object (required)\n     * @param secondaryAmount - Optional secondary amount for display purposes (e.g., converted currency)\n     * @internal\n     */\n    private triggerAmountUpdate(amount: PaymentAmount, secondaryAmount?: PaymentAmount): void {\n        if (!isAmountValid(amount)) {\n            console.warn('Core update(): Update canceled. Invalid amount object');\n            return;\n        }\n\n        if (secondaryAmount && !isAmountValid(secondaryAmount)) {\n            console.warn('Core update(): Update canceled. Invalid secondary amount object');\n            return;\n        }\n\n        this.setOptions({\n            amount,\n            ...(secondaryAmount && { secondaryAmount })\n        });\n\n        this.components.forEach(component => {\n            component.updateAmount(amount, secondaryAmount);\n        });\n    }\n\n    /**\n     * Remove the reference of a component\n     * @param component - reference to the component to be removed\n     * @returns this - the element instance\n     * // TODO: Do we need this?\n     */\n    public remove = (component): this => {\n        this.components = this.components.filter(c => c._id !== component._id);\n        component.unmount();\n\n        return this;\n    };\n\n    /**\n     * @internal\n     * Create or update the config object passed when AdyenCheckout is initialised (environment, clientKey, etc...)\n     */\n    private setOptions = (options: CoreConfiguration): void => {\n        this.options = {\n            ...this.options,\n            ...options,\n            locale: options?.locale || this.options?.locale\n        };\n    };\n\n    /**\n     * @internal\n     * @returns props for a new UIElement\n     */\n    public getCorePropsForComponent(): any {\n        const globalOptions = processGlobalOptions(this.options);\n\n        return {\n            ...globalOptions,\n            core: this,\n            i18n: this.modules.i18n,\n            modules: this.modules,\n            session: this.session,\n            loadingContext: this.loadingContext,\n            cdnContext: this.cdnImagesUrl,\n            createFromAction: this.createFromAction\n        };\n    }\n\n    public storeElementReference(element: UIElement) {\n        if (element) {\n            this.components.push(element);\n        }\n    }\n\n    /**\n     * @internal\n     */\n    private handleCreateError(paymentMethod?): never {\n        const paymentMethodName = paymentMethod?.name ?? 'The passed payment method';\n        const errorMessage = paymentMethod\n            ? `${paymentMethodName} is not a valid Checkout Component. What was passed as a txVariant was: ${JSON.stringify(\n                  paymentMethod\n              )}. Check if this payment method is configured in the Backoffice or if the txVariant is a valid one`\n            : 'No Payment Method component was passed';\n\n        throw new Error(errorMessage);\n    }\n\n    private createPaymentMethodsList(paymentMethodsResponse?: PaymentMethods): void {\n        this.paymentMethodsResponse = new PaymentMethods(this.options.paymentMethodsResponse || paymentMethodsResponse, this.options);\n    }\n\n    private async createCoreModules(): Promise<void> {\n        if (this.modules) {\n            if (process.env.NODE_ENV === 'development') {\n                console.warn('Core: Core modules are already created.');\n            }\n            return;\n        }\n\n        const translations = await this.fetchLocaleTranslations();\n\n        this.modules = Object.freeze({\n            risk: new RiskModule(this, { ...this.options, loadingContext: this.loadingContext }),\n            analytics: new Analytics({\n                eventQueue: new AnalyticsEventQueue(),\n                service: new AnalyticsService({\n                    analyticsContext: this.analyticsContext,\n                    clientKey: this.options.clientKey\n                }),\n                enabled: this.options.analytics?.enabled,\n                analyticsData: this.options.analytics?.analyticsData\n            }),\n            resources: new Resources(this.cdnImagesUrl),\n            i18n: new Language({\n                locale: this.options.locale,\n                translations,\n                customTranslations: this.options.translations\n            }),\n            srPanel: new SRPanel(this, { ...this.options.srConfig })\n        });\n    }\n\n    private async requestAnalyticsAttemptId(): Promise<void> {\n        await this.modules.analytics.setUp({\n            locale: this.options.locale,\n            ...(this.session?.id && { sessionId: this.session.id })\n        });\n    }\n}\n\nexport default Core;\n"],"names":["Core","setBundleType","type","metadata","bundleType","register","items","registry","add","getComponent","txVariant","initialize","this","initializeCore","validateCoreConfiguration","createCoreModules","requestAnalyticsAttemptId","session","setupSession","options","then","sessionResponse","amount","shopperLocale","countryCode","paymentMethods","rest","setOptions","_object_spread_props","_object_spread","order","remainingAmount","locale","createPaymentMethodsList","catch","error","onError","Promise","reject","resolve","fetchLocaleTranslations","getTranslations","cdnTranslationsUrl","version","_this_options_onError","_this_options","_this_options_onError1","_this_options1","AdyenCheckoutError","call","cause","paymentMethodsConfiguration","console","warn","IMPLEMENTATION_ERROR","DEFAULT_LOCALE","formatLocale","translations","formatCustomTranslations","submitDetails","details","promise","onAdditionalDetails","data","undefined","sanitizeResponse","verifyPaymentDidNotFail","afterAdditionalDetails","response","_this_options_onPaymentCompleted","cleanupFinalResult","onPaymentCompleted","e","_this_options_onPaymentFailed","CancelError","onPaymentFailed","createFromAction","action","hasOwnProperty","Error","component","THREEDS2_FULL","subtype","paymentMethodType","event","AnalyticsLogEvent","LogEventType","subType","getSubtypeFromActionType","message","modules","analytics","sendAnalytics","props","getCorePropsForComponent","getComponentForAction","handleCreateError","update","shouldReinitializeCheckout","components","forEach","newProps","secondaryAmount","triggerAmountUpdate","isAmountValid","updateAmount","processGlobalOptions","globalOptions","core","i18n","loadingContext","cdnContext","cdnImagesUrl","storeElementReference","element","push","paymentMethod","paymentMethodName","name","_ref","errorMessage","JSON","stringify","paymentMethodsResponse","PaymentMethods","_this_options_analytics","_this_options_analytics1","Object","freeze","risk","RiskModule","Analytics","eventQueue","AnalyticsEventQueue","service","AnalyticsService","analyticsContext","clientKey","enabled","analyticsData","resources","Resources","Language","customTranslations","srPanel","SRPanel","srConfig","_this_session","setUp","id","sessionId","constructor","_this_options_clientKey","_define_property","actionEle","remove","filter","c","_id","unmount","assertConfigurationPropertiesAreValid","bind","defaultProps","apiUrl","analyticsUrl","resolveEnvironments","environment","_environmentUrls","Session","clientKeyType","substring","_this_options__environmentUrls","_this_options_clientKey1","includes","api","debug","exposeLibraryMetadata","window","LIBRARY_VERSION","LIBRARY_BUNDLE_TYPE"],"mappings":"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"}