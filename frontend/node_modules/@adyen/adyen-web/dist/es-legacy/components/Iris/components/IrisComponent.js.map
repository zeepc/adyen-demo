{"version":3,"file":"IrisComponent.js","sources":["../../../../../src/components/Iris/components/IrisComponent.tsx"],"sourcesContent":["import { h } from 'preact';\nimport { PayButtonProps } from '../../internal/PayButton/PayButton';\nimport { IrisMode } from '../types';\nimport { useEffect, useMemo, useRef, useState } from 'preact/hooks';\nimport { IRIS_ALLY_LABELS } from '../constants';\nimport { getIrisSegmentedControlOptions } from '../utils';\nimport { useCoreContext } from '../../../core/Context/CoreProvider';\nimport { SegmentedControl, SegmentedControlRegion } from '../../internal/SegmentedControl';\nimport { ComponentMethodsRef, UIElementStatus } from '../../types';\nimport { IssuerItem } from '../../internal/IssuerList/types';\nimport IrisGenerateQRCode from './IrisGenerateQRCode';\nimport styles from './IrisComponent.module.scss';\nimport { AnalyticsInfoEvent, InfoEventType, UiTarget } from '../../../core/Analytics/events/AnalyticsInfoEvent';\nimport { TxVariants } from '../../tx-variants';\nimport useAnalytics from '../../../core/Analytics/useAnalytics';\n\ninterface IrisComponentProps {\n    defaultMode: IrisMode;\n    showPayButton?: boolean;\n    issuers: IssuerItem[];\n    issuerListUI: h.JSX.Element;\n    onUpdateMode: (mode: IrisMode) => void;\n    payButton: (props: Partial<PayButtonProps>) => h.JSX.Element;\n    setComponentRef: (ref: ComponentMethodsRef) => void;\n}\n\nexport default function IrisComponent(props: Readonly<IrisComponentProps>) {\n    const { i18n } = useCoreContext();\n    const { analytics } = useAnalytics();\n\n    const [mode, setMode] = useState<IrisMode>(props.defaultMode);\n    const [status, setStatus] = useState<UIElementStatus>('ready');\n    const segmentedControlOptions = useMemo(() => getIrisSegmentedControlOptions(i18n, props.defaultMode), [i18n, props.defaultMode]);\n\n    const issuersAvailable = props.issuers.length > 0;\n\n    const handleModeChange = (mode: IrisMode, sendAnalytics = false) => {\n        setMode(mode);\n        props.onUpdateMode(mode);\n        if (sendAnalytics) {\n            const event = new AnalyticsInfoEvent({\n                type: InfoEventType.selected,\n                target: UiTarget.segmentedControl,\n                component: TxVariants.iris,\n                selectedValue: mode\n            });\n            analytics.sendAnalytics(event);\n        }\n    };\n\n    const irisRef = useRef<ComponentMethodsRef>({\n        setStatus: setStatus\n    });\n\n    useEffect(() => {\n        props.setComponentRef(irisRef.current);\n    }, [props.setComponentRef]);\n\n    useEffect(() => {\n        if (issuersAvailable) {\n            const event = new AnalyticsInfoEvent({\n                type: InfoEventType.displayed,\n                target: UiTarget.segmentedControl,\n                component: TxVariants.iris,\n                selectedValue: props.defaultMode\n            });\n            analytics.sendAnalytics(event);\n        }\n    }, []);\n\n    useEffect(() => {\n        if (!issuersAvailable) {\n            handleModeChange(IrisMode.QR_CODE);\n        }\n    }, [issuersAvailable]);\n\n    if (!issuersAvailable) {\n        return <IrisGenerateQRCode showPayButton={props.showPayButton} payButton={props.payButton} status={status} />;\n    }\n\n    return (\n        <div>\n            <SegmentedControl\n                onChange={mode => handleModeChange(mode, true)}\n                selectedValue={mode}\n                disabled={status === 'loading'}\n                options={segmentedControlOptions}\n            />\n            {mode === IrisMode.BANK_LIST && (\n                <SegmentedControlRegion\n                    id={IRIS_ALLY_LABELS.AreaId.BANK_LIST}\n                    ariaLabelledBy={IRIS_ALLY_LABELS.ButtonId.BANK_LIST}\n                    className={styles.bankList}\n                >\n                    {props.issuerListUI}\n                </SegmentedControlRegion>\n            )}\n            {mode === IrisMode.QR_CODE && (\n                <SegmentedControlRegion id={IRIS_ALLY_LABELS.AreaId.QR_CODE} ariaLabelledBy={IRIS_ALLY_LABELS.ButtonId.QR_CODE}>\n                    <IrisGenerateQRCode showPayButton={props.showPayButton} payButton={props.payButton} status={status} />\n                </SegmentedControlRegion>\n            )}\n        </div>\n    );\n}\n"],"names":["IrisComponent","props","i18n","useCoreContext","analytics","useAnalytics","mode","setMode","useState","defaultMode","status","setStatus","segmentedControlOptions","useMemo","getIrisSegmentedControlOptions","issuersAvailable","issuers","length","handleModeChange","sendAnalytics","onUpdateMode","event","AnalyticsInfoEvent","type","InfoEventType","selected","target","UiTarget","segmentedControl","component","TxVariants","iris","selectedValue","irisRef","useRef","useEffect","setComponentRef","current","displayed","IrisMode","QR_CODE","h","div","SegmentedControl","onChange","disabled","options","BANK_LIST","SegmentedControlRegion","id","IRIS_ALLY_LABELS","AreaId","ariaLabelledBy","ButtonId","className","styles","bankList","issuerListUI","IrisGenerateQRCode","showPayButton","payButton"],"mappings":"y4BA0Be,SAASA,EAAcC,GAClC,MAAMC,KAAEA,GAASC,KACXC,UAAEA,GAAcC,KAEfC,EAAMC,GAAWC,EAAmBP,EAAMQ,cAC1CC,EAAQC,GAAaH,EAA0B,SAChDI,EAA0BC,EAAQ,IAAMC,EAA+BZ,EAAMD,EAAMQ,aAAc,CAACP,EAAMD,EAAMQ,cAE9GM,EAAmBd,EAAMe,QAAQC,OAAS,EAE1CC,EAAmB,CAACZ,EAAgBa,GAAgB,KAGtD,GAFAZ,EAAQD,GACRL,EAAMmB,aAAad,GACfa,EAAe,CACf,MAAME,EAAQ,IAAIC,EAAmB,CACjCC,KAAMC,EAAcC,SACpBC,OAAQC,EAASC,iBACjBC,UAAWC,EAAWC,KACtBC,cAAe1B,IAEnBF,EAAUe,cAAcE,EAC5B,GAGEY,EAAUC,EAA4B,CACxCvB,UAAWA,IAyBf,OAtBAwB,EAAU,KACNlC,EAAMmC,gBAAgBH,EAAQI,UAC/B,CAACpC,EAAMmC,kBAEVD,EAAU,KACN,GAAIpB,EAAkB,CAClB,MAAMM,EAAQ,IAAIC,EAAmB,CACjCC,KAAMC,EAAcc,UACpBZ,OAAQC,EAASC,iBACjBC,UAAWC,EAAWC,KACtBC,cAAe/B,EAAMQ,cAEzBL,EAAUe,cAAcE,EAC5B,GACD,IAEHc,EAAU,KACDpB,GACDG,EAAiBqB,EAASC,UAE/B,CAACzB,IAECA,EAKD0B,EAACC,WACGD,EAACE,EAAAA,CACGC,SAAUtC,GAAQY,EAAiBZ,GAAM,GACzC0B,cAAe1B,EACfuC,SAAqB,YAAXnC,EACVoC,QAASlC,IAEZN,IAASiC,EAASQ,WACfN,EAACO,EAAAA,CACGC,GAAIC,EAAiBC,OAAOJ,UAC5BK,eAAgBF,EAAiBG,SAASN,UAC1CO,UAAWC,EAAOC,UAEjBvD,EAAMwD,cAGdnD,IAASiC,EAASC,SACfC,EAACO,EAAAA,CAAuBC,GAAIC,EAAiBC,OAAOX,QAASY,eAAgBF,EAAiBG,SAASb,SACnGC,EAACiB,EAAAA,CAAmBC,cAAe1D,EAAM0D,cAAeC,UAAW3D,EAAM2D,UAAWlD,OAAQA,MAtBjG+B,EAACiB,EAAAA,CAAmBC,cAAe1D,EAAM0D,cAAeC,UAAW3D,EAAM2D,UAAWlD,OAAQA,GA2B3G"}