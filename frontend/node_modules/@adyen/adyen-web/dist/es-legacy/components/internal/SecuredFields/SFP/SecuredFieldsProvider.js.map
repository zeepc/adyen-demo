{"version":3,"file":"SecuredFieldsProvider.js","sources":["../../../../../../src/components/internal/SecuredFields/SFP/SecuredFieldsProvider.ts"],"sourcesContent":["import { Component } from 'preact';\nimport { getErrorObject, getFields, getErrorReducer, validFieldsReducer } from './SFPUtils';\nimport initCSF from '../lib/CSF';\nimport handlers from './SecuredFieldsProviderHandlers';\nimport defaultProps from './defaultProps';\nimport { SFPProps, SFPState, SingleBrandResetObject } from './types';\nimport {\n    StylesObject,\n    CardErrorData,\n    CardFocusData,\n    CardBrandData,\n    CardAllValidData,\n    CardFieldValidData,\n    CardAutoCompleteData,\n    CardConfigSuccessData,\n    CardLoadData,\n    SFKeyPressObj\n} from '../lib/types';\nimport { CSFReturnObject, CSFSetupObject } from '../lib/CSF/types';\nimport { CVC_POLICY_REQUIRED, DATE_POLICY_REQUIRED, DEDICATED_CARD_COMPONENTS, ENCRYPTED_CARD_NUMBER, ENCRYPTED_PWD_FIELD } from '../lib/constants';\nimport { BinLookupResponse } from '../../../Card/types';\nimport AdyenCheckoutError from '../../../../core/Errors/AdyenCheckoutError';\nimport { SFStateErrorObj } from '../../../Card/components/CardInput/types';\nimport { getErrorMessageFromCode } from '../../../../core/Errors/utils';\nimport { SF_ErrorCodes } from '../../../../core/Errors/constants';\nimport { TxVariants } from '../../../tx-variants';\n\n/**\n * SecuredFieldsProvider:\n * Initialises & handles the client-side part of SecuredFields\n */\nclass SecuredFieldsProvider extends Component<SFPProps, SFPState> {\n    private csfLoadFailTimeout: number;\n    private csfLoadFailTimeoutMS: number;\n    private csfConfigFailTimeout: number;\n    private csfConfigFailTimeoutMS: number;\n    private numCharsInField: object;\n    private rootNode;\n    private numDateFields: number;\n    private csf: CSFReturnObject;\n    private handleOnLoad: (obj: CardLoadData) => void;\n    private handleOnConfigSuccess: (obj: CardConfigSuccessData) => void;\n    private handleOnFieldValid: (obj: CardFieldValidData) => void;\n    private handleOnAllValid: (obj: CardAllValidData) => void;\n    private handleOnBrand: (obj: CardBrandData) => void;\n    private handleFocus: (obj: CardFocusData) => void;\n    private handleOnError: (obj: CardErrorData, hasUnsupportedCard?: boolean) => void;\n    private handleOnAutoComplete: (obj: CardAutoCompleteData) => void;\n    private handleOnNoDataRequired: () => void;\n    private handleOnTouchstartIOS: (obj) => void;\n    private handleKeyPressed: (obj: SFKeyPressObj) => void;\n    public state: SFPState;\n    public props;\n    private issuingCountryCode;\n\n    constructor(props: SFPProps) {\n        super(props);\n\n        const stateObj: SFPState = {\n            status: 'loading',\n            brand: props.type,\n            errors: {},\n            valid: {},\n            data: {},\n            cvcPolicy: CVC_POLICY_REQUIRED,\n            expiryDatePolicy: DATE_POLICY_REQUIRED,\n            isSfpValid: false,\n            hasKoreanFields: props.hasKoreanFields\n        };\n        this.state = stateObj;\n\n        this.csfLoadFailTimeout = null;\n        this.csfLoadFailTimeoutMS = 30000;\n\n        this.csfConfigFailTimeout = null;\n        this.csfConfigFailTimeoutMS = 15000;\n\n        this.numCharsInField = {};\n\n        // Handlers\n        this.handleOnLoad = handlers.handleOnLoad.bind(this);\n        this.handleOnConfigSuccess = handlers.handleOnConfigSuccess.bind(this);\n        this.handleOnFieldValid = handlers.handleOnFieldValid.bind(this);\n        this.handleOnAllValid = handlers.handleOnAllValid.bind(this);\n        this.handleOnBrand = handlers.handleOnBrand.bind(this);\n        this.handleFocus = handlers.handleFocus.bind(this);\n        this.handleOnError = handlers.handleOnError.bind(this);\n        this.handleOnNoDataRequired = handlers.handleOnNoDataRequired.bind(this);\n        this.handleOnAutoComplete = handlers.handleOnAutoComplete.bind(this);\n        this.handleOnTouchstartIOS = handlers.handleOnTouchstartIOS.bind(this); // Only called when iOS detected\n        this.handleKeyPressed = handlers.handleKeyPressed.bind(this);\n\n        this.processBinLookupResponse = this.processBinLookupResponse.bind(this);\n\n        // Bindings for functions exposed to users of this component: SecuredFields & CardInput\n        this.setFocusOn = this.setFocusOn.bind(this);\n        this.updateStyles = this.updateStyles.bind(this);\n        this.handleUnsupportedCard = this.handleUnsupportedCard.bind(this);\n        this.showValidation = this.showValidation.bind(this);\n        this.destroy = this.destroy.bind(this);\n    }\n\n    public static defaultProps = defaultProps;\n\n    public componentDidMount(): void {\n        // When SFP instantiated through SecuredFieldsInput c.f. CardInput\n        if (this.props.rootNode) {\n            this.setRootNode(this.props.rootNode);\n        }\n\n        // Find encryptedFields and map them to the values we use to store valid states\n        const fields = getFields(this.rootNode);\n        const valid = fields.reduce(validFieldsReducer, {});\n\n        this.setState({ valid });\n\n        // Populate numCharsInField object\n        fields.forEach(field => {\n            this.numCharsInField[field] = 0;\n        });\n\n        // Store how many dateFields we are dealing with visually\n        this.numDateFields = fields.filter(f => f.match(/Expiry/)).length;\n\n        if (fields.length) {\n            this.destroy();\n            this.initializeCSF(this.rootNode);\n        } else {\n            if (this.props.componentType === TxVariants.customCard) {\n                console.debug(\n                    'You are trying to create a CustomCard component but the element into which you are trying to mount the CustomCard component does not contain any elements with a \"data-cse\" attribute e.g. <div data-cse=\"encryptedCardNumber\"></div>'\n                );\n            }\n            this.handleOnNoDataRequired();\n        }\n    }\n\n    public componentDidUpdate() {\n        this.checkForKCPFields();\n        // Pass all the state data up - Used right now for loading status\n        this.props.onStateUpdate?.(this.state);\n    }\n\n    public componentWillUnmount(): void {\n        this.csf = null;\n        clearTimeout(this.csfLoadFailTimeout);\n        clearTimeout(this.csfConfigFailTimeout);\n    }\n\n    private initializeCSF(root: HTMLElement): void {\n        let loadingContext = this.props.loadingContext;\n\n        // For loading securedFields from local server during development\n        if (process.env.NODE_ENV === 'development' && process.env.__SF_ENV__ !== 'build') {\n            loadingContext = process.env.__SF_ENV__;\n        }\n\n        const csfSetupObj: CSFSetupObject = {\n            rootNode: root,\n            type: this.props.type,\n            componentType: this.props.componentType,\n            clientKey: this.props.clientKey,\n            cardGroupTypes: this.props.brands,\n            autoFocus: this.props.autoFocus,\n            trimTrailingSeparator: this.props.trimTrailingSeparator,\n            loadingContext,\n            keypadFix: this.props.keypadFix,\n            showWarnings: this.props.showWarnings,\n            iframeUIConfig: {\n                sfStyles: this.props.styles\n            },\n            i18n: this.props.i18n,\n            onSubmitAnalytics: this.props.onSubmitAnalytics,\n            callbacks: {\n                onLoad: this.handleOnLoad,\n                onConfigSuccess: this.handleOnConfigSuccess,\n                onFieldValid: this.handleOnFieldValid,\n                onAllValid: this.handleOnAllValid,\n                onBrand: this.handleOnBrand,\n                onError: this.handleOnError,\n                onFocus: this.handleFocus,\n                onBinValue: this.props.onBinValue,\n                onAutoComplete: this.handleOnAutoComplete,\n                onAdditionalSFConfig: this.props.onAdditionalSFConfig,\n                onAdditionalSFRemoved: this.props.onAdditionalSFRemoved,\n                onTouchstartIOS: this.handleOnTouchstartIOS,\n                onKeyPressed: this.handleKeyPressed\n            },\n            isKCP: this.state.hasKoreanFields,\n            legacyInputMode: this.props.legacyInputMode,\n            minimumExpiryDate: this.props.minimumExpiryDate,\n            implementationType: this.props.implementationType || 'components', // to distinguish between 'regular' and 'custom' card component\n            forceCompat: this.props.forceCompat,\n            maskSecurityCode: this.props.maskSecurityCode,\n            exposeExpiryDate: this.props.exposeExpiryDate,\n            shouldDisableIOSArrowKeys: !!this.props.disableIOSArrowKeys, // convert whether function has been defined into a boolean\n            placeholders: this.props.placeholders ?? {},\n            showContextualElement: this.props.showContextualElement\n        };\n\n        this.csf = initCSF(csfSetupObj);\n\n        /**\n         * Expect to at least have had the handleOnLoad callback called within this time\n         * - if this hasn't happened then something has happened to interrupt the loading of the securedFields\n         * So we need to clear the loading spinner to see if the securedFields are reporting anything\n         */\n        // @ts-ignore - timout 'type' is a number\n        this.csfLoadFailTimeout = setTimeout(() => {\n            if (this.state.status !== 'ready') {\n                // Hide the spinner\n                this.setState({ status: 'csfLoadFailure' });\n                // Report the error\n                this.props.onError(new AdyenCheckoutError('ERROR', 'secured field iframes have failed to load'));\n            }\n        }, this.csfLoadFailTimeoutMS);\n    }\n\n    private checkForKCPFields() {\n        let needsKoreanFields = false;\n        if (this.props.koreanAuthenticationRequired) {\n            needsKoreanFields = this.issuingCountryCode ? this.issuingCountryCode === 'kr' : this.props.countryCode === 'kr';\n        }\n\n        // Was korean, now isn't - hide password field\n        if (this.state.hasKoreanFields && !needsKoreanFields) {\n            // Clear any stored data\n            const setRemovedFieldState = prevState => ({\n                data: { ...prevState.data, [ENCRYPTED_PWD_FIELD]: undefined },\n                valid: { ...prevState.valid, [ENCRYPTED_PWD_FIELD]: false },\n                errors: { ...prevState.errors, [ENCRYPTED_PWD_FIELD]: false },\n                hasKoreanFields: false\n            });\n\n            this.setState(setRemovedFieldState, () => {\n                this.props.onChange(this.state);\n            });\n\n            this.csf.removeSecuredField(ENCRYPTED_PWD_FIELD);\n            this.csf.setKCPStatus(false);\n        }\n\n        // Wasn't korean, now is - show password field\n        if (!this.state.hasKoreanFields && needsKoreanFields) {\n            const setAddedFieldState = prevState => ({\n                valid: { ...prevState.valid, [ENCRYPTED_PWD_FIELD]: false },\n                hasKoreanFields: true,\n                isSfpValid: false\n            });\n\n            this.setState(setAddedFieldState, () => {\n                this.props.onChange(this.state);\n            });\n\n            this.csf.addSecuredField(ENCRYPTED_PWD_FIELD);\n            this.csf.setKCPStatus(true);\n        }\n    }\n\n    public getChildContext(): object {\n        return { i18n: this.props.i18n };\n    }\n\n    public handleUnsupportedCard(errObj: CardErrorData): boolean {\n        const hasUnsupportedCard = !!errObj.error;\n\n        // Store the brand(s) we detected and which we don't support\n        if (hasUnsupportedCard) {\n            this.setState({ detectedUnsupportedBrands: errObj.detectedBrands });\n        }\n\n        errObj.rootNode = this.rootNode; // Needed for CustomCard\n        this.handleOnError(errObj, hasUnsupportedCard);\n        // Inform CSF that the number field has an unsupportedCard error (or that it has been cleared)\n        if (this.csf) {\n            this.csf.hasUnsupportedCard(ENCRYPTED_CARD_NUMBER, errObj.error);\n        }\n        return hasUnsupportedCard;\n    }\n\n    public setFocusOn(frame: string): void {\n        if (this.csf) this.csf.setFocusOnFrame(frame);\n    }\n\n    public updateStyles(stylesObj: StylesObject): void {\n        if (this.csf) this.csf.updateStyles(stylesObj);\n    }\n\n    public sfIsOptionalOrHidden(fieldType: string): boolean {\n        return this.csf.sfIsOptionalOrHidden(fieldType);\n    }\n\n    public destroy(): void {\n        if (this.csf) this.csf.destroy();\n    }\n\n    public getRootNode(): HTMLElement {\n        return this.rootNode;\n    }\n\n    public showValidation(): void {\n        const { numDateFields, state }: SecuredFieldsProvider = this;\n\n        Object.keys(state.valid)\n            .reduce(getErrorReducer(numDateFields, state), [])\n            .forEach(field => {\n                // For each detected error pass an error object to the handler (calls error callback & sets state)\n                const errorObj: CardErrorData = getErrorObject(field, this.rootNode, state);\n                this.handleOnError(errorObj, !!state.detectedUnsupportedBrands);\n                // Inform the secured-fields instance of which fields have been found to have errors\n                if (this.csf && this.csf.isValidated) {\n                    this.csf.isValidated(field, errorObj.error);\n                }\n            });\n    }\n\n    /**\n     * Map SF errors to ValidationRuleResult-like objects, for CardInput component\n     */\n    public mapErrorsToValidationRuleResult(): SFStateErrorObj {\n        const fieldNames: string[] = Object.keys(this.state.errors);\n\n        const sfStateErrorsObj = fieldNames.reduce((acc, fieldName) => {\n            const errorCode = this.state.errors[fieldName];\n            if (errorCode) {\n                acc[fieldName] = {\n                    isValid: false,\n                    errorMessage: getErrorMessageFromCode(errorCode, SF_ErrorCodes), // this is the human-readable, untranslated, explanation of the error that will exist on the error object in card.state.errors\n                    // For v5 the object found in state.errors should also contain the additional properties that used to be sent to the onError callback\n                    // namely: translation, errorCode, a ref to rootNode &, in the case of failed binLookup, an array of the detectedBrands\n                    errorI18n: this.props.i18n.get(errorCode),\n                    error: errorCode,\n                    rootNode: this.rootNode,\n                    ...(this.state.detectedUnsupportedBrands && { detectedBrands: this.state.detectedUnsupportedBrands })\n                };\n            } else {\n                acc[fieldName] = null;\n            }\n            return acc;\n        }, {});\n        return sfStateErrorsObj;\n    }\n\n    public processBinLookupResponse(binLookupResponse: BinLookupResponse, resetObject: SingleBrandResetObject): void {\n        // If we were dealing with an unsupported card & now we have a valid /binLookup response (or a response triggering a reset of the UI),\n        // - reset state to clear the error & the stored unsupportedBrands and, in the case of a valid /binLookup response, inform CSF (via handleUnsupportedCard)\n        // (Scenario: from an unsupportedCard state the shopper has pasted another number long enough to trigger a /binLookup)\n        if (this.state.detectedUnsupportedBrands) {\n            this.setState(prevState => ({\n                errors: { ...prevState.errors, [ENCRYPTED_CARD_NUMBER]: false },\n                detectedUnsupportedBrands: null\n            }));\n\n            // If we have some sort of binLookupResponse object then this isn't the reset caused by digits dropping below a threshold\n            // - so call handleUnsupportedCard to clear the error\n            if (this.csf && binLookupResponse) {\n                const errObj: CardErrorData = {\n                    type: 'card',\n                    fieldType: 'encryptedCardNumber',\n                    error: ''\n                };\n                this.handleUnsupportedCard(errObj);\n            }\n        }\n\n        this.issuingCountryCode = binLookupResponse?.issuingCountryCode?.toLowerCase();\n\n        const hasBrandedResetObj = resetObject?.brand;\n\n        /**\n         * Are we dealing with a \"dedicated\" card scenario i.e a card component created as: checkout.create('bcmc') but which can accept multiple brands\n         * - in which case we will need to reset brand and pass on the resetObj to CSF\n         */\n        const mustResetDedicatedBrand = hasBrandedResetObj && DEDICATED_CARD_COMPONENTS.includes(resetObject.brand);\n\n        if (mustResetDedicatedBrand) {\n            // resetObject.brand will be the value of the brand whose logo we want to reshow in the UI\n            this.setState(resetObject, () => {\n                this.props.onChange(this.state);\n            });\n        }\n\n        /**\n         * Scenarios:\n         *\n         * - RESET (binLookupResponse === null): The number of digits in number field has dropped below threshold for BIN lookup\n         * - RESULT (binLookupResponse.supportedBrands.length === 1): binLookup has found a result so inform CSF\n         *\n         * In the RESET scenario, for \"dedicated\" card components we also need to pass on the resetObject since this contains information about\n         * the brand that CSF needs to reset to, internally.\n         */\n        if (this.csf) this.csf.brandsFromBinLookup(binLookupResponse, mustResetDedicatedBrand ? resetObject : null);\n    }\n\n    private setRootNode = (input: HTMLElement): void => {\n        this.rootNode = input;\n    };\n\n    public render(props, state) {\n        return props.render({ setRootNode: this.setRootNode, setFocusOn: this.setFocusOn }, state);\n    }\n}\n\nexport default SecuredFieldsProvider;\n"],"names":["SecuredFieldsProvider","Component","componentDidMount","this","props","rootNode","setRootNode","fields","getFields","valid","reduce","validFieldsReducer","setState","forEach","field","numCharsInField","numDateFields","filter","f","match","length","destroy","initializeCSF","componentType","TxVariants","customCard","console","debug","handleOnNoDataRequired","componentDidUpdate","_this_props_onStateUpdate","_this_props","checkForKCPFields","onStateUpdate","call","state","componentWillUnmount","csf","clearTimeout","csfLoadFailTimeout","csfConfigFailTimeout","root","_this_props_placeholders","loadingContext","csfSetupObj","type","clientKey","cardGroupTypes","brands","autoFocus","trimTrailingSeparator","keypadFix","showWarnings","iframeUIConfig","sfStyles","styles","i18n","onSubmitAnalytics","callbacks","onLoad","handleOnLoad","onConfigSuccess","handleOnConfigSuccess","onFieldValid","handleOnFieldValid","onAllValid","handleOnAllValid","onBrand","handleOnBrand","onError","handleOnError","onFocus","handleFocus","onBinValue","onAutoComplete","handleOnAutoComplete","onAdditionalSFConfig","onAdditionalSFRemoved","onTouchstartIOS","handleOnTouchstartIOS","onKeyPressed","handleKeyPressed","isKCP","hasKoreanFields","legacyInputMode","minimumExpiryDate","implementationType","forceCompat","maskSecurityCode","exposeExpiryDate","shouldDisableIOSArrowKeys","disableIOSArrowKeys","placeholders","showContextualElement","initCSF","setTimeout","status","AdyenCheckoutError","csfLoadFailTimeoutMS","needsKoreanFields","koreanAuthenticationRequired","issuingCountryCode","countryCode","setRemovedFieldState","prevState","data","_object_spread_props","_object_spread","ENCRYPTED_PWD_FIELD","undefined","errors","onChange","removeSecuredField","setKCPStatus","setAddedFieldState","isSfpValid","addSecuredField","getChildContext","handleUnsupportedCard","errObj","hasUnsupportedCard","error","detectedUnsupportedBrands","detectedBrands","ENCRYPTED_CARD_NUMBER","setFocusOn","frame","setFocusOnFrame","updateStyles","stylesObj","sfIsOptionalOrHidden","fieldType","getRootNode","showValidation","Object","keys","getErrorReducer","errorObj","getErrorObject","isValidated","mapErrorsToValidationRuleResult","acc","fieldName","errorCode","isValid","errorMessage","getErrorMessageFromCode","SF_ErrorCodes","errorI18n","get","processBinLookupResponse","binLookupResponse","resetObject","toLowerCase","mustResetDedicatedBrand","brand","DEDICATED_CARD_COMPONENTS","includes","brandsFromBinLookup","render","constructor","super","_define_property","csfConfigFailTimeoutMS","input","stateObj","cvcPolicy","CVC_POLICY_REQUIRED","expiryDatePolicy","DATE_POLICY_REQUIRED","handlers","bind","defaultProps"],"mappings":"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"}