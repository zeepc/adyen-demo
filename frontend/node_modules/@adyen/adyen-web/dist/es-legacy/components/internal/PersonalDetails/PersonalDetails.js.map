{"version":3,"file":"PersonalDetails.js","sources":["../../../../../src/components/internal/PersonalDetails/PersonalDetails.tsx"],"sourcesContent":["import { GenericEventHandler, h } from 'preact';\nimport { useEffect, useMemo, useRef } from 'preact/hooks';\nimport Fieldset from '../FormFields/Fieldset';\nimport Field from '../FormFields/Field';\nimport ReadOnlyPersonalDetails from './ReadOnlyPersonalDetails';\nimport { personalDetailsValidationRules } from './validate';\nimport { useCoreContext } from '../../../core/Context/CoreProvider';\nimport { PersonalDetailsProps } from './types';\nimport { checkDateInputSupport } from '../FormFields/InputDate/utils';\nimport { PersonalDetailsSchema } from '../../../types';\nimport { getFormattedData } from './utils';\nimport useForm from '../../../utils/useForm';\nimport InputText from '../FormFields/InputText';\nimport InputDate from '../FormFields/InputDate';\nimport InputEmail from '../FormFields/InputEmail';\nimport InputTelephone from '../FormFields/InputTelephone';\nimport { getErrorMessage } from '../../../utils/getErrorMessage';\nimport { ComponentMethodsRef } from '../UIElement/types';\nimport { HandleChangeForModeType } from '../../../utils/useForm/types';\nimport './PersonalDetails.scss';\n\nexport const PERSONAL_DETAILS_SCHEMA = ['firstName', 'lastName', 'dateOfBirth', 'shopperEmail', 'telephoneNumber'];\n\nexport default function PersonalDetails(props: Readonly<PersonalDetailsProps>) {\n    const { label = '', namePrefix, placeholders, requiredFields, visibility } = props;\n\n    const { i18n } = useCoreContext();\n\n    const isDateInputSupported = useMemo(checkDateInputSupport, []);\n    const { handleChangeFor, triggerValidation, data, valid, errors, isValid } = useForm<PersonalDetailsSchema>({\n        schema: requiredFields,\n        // Ensure any passed validation rules are merged with the default ones\n        rules: { ...personalDetailsValidationRules, ...props.validationRules },\n        defaultData: props.data\n    });\n\n    const personalDetailsRef = useRef<ComponentMethodsRef>({\n        showValidation: () => {\n            triggerValidation();\n        }\n    });\n\n    useEffect(() => {\n        props.setComponentRef(personalDetailsRef.current);\n    }, [props.setComponentRef]);\n\n    const eventHandler =\n        (mode: HandleChangeForModeType): GenericEventHandler<EventTarget> =>\n        (e: Event): void => {\n            const { name } = e.target as HTMLInputElement;\n            const key = name.split(`${namePrefix}.`).pop();\n\n            handleChangeFor(key, mode)(e);\n        };\n\n    const generateFieldName = (name: string): string => `${namePrefix ? `${namePrefix}.` : ''}${name}`;\n\n    useEffect(() => {\n        const formattedData = getFormattedData(data);\n        props.onChange({ data: formattedData, valid, errors, isValid });\n    }, [data, valid, errors, isValid]);\n\n    if (visibility === 'hidden') return null;\n    if (visibility === 'readOnly') return <ReadOnlyPersonalDetails {...props} data={data} />;\n\n    return (\n        <Fieldset classNameModifiers={['personalDetails']} label={label}>\n            {requiredFields.includes('firstName') && (\n                <Field\n                    label={i18n.get('firstName')}\n                    classNameModifiers={['col-50', 'firstName']}\n                    errorMessage={getErrorMessage(i18n, errors.firstName, i18n.get('firstName'))}\n                    name={'firstName'}\n                    i18n={i18n}\n                >\n                    <InputText\n                        name={generateFieldName('firstName')}\n                        value={data.firstName}\n                        classNameModifiers={['firstName']}\n                        onInput={eventHandler('input')}\n                        onBlur={eventHandler('blur')}\n                        placeholder={placeholders.firstName}\n                        spellcheck={false}\n                        required={true}\n                    />\n                </Field>\n            )}\n\n            {requiredFields.includes('lastName') && (\n                <Field\n                    label={i18n.get('lastName')}\n                    classNameModifiers={['col-50', 'lastName']}\n                    errorMessage={getErrorMessage(i18n, errors.lastName, i18n.get('lastName'))}\n                    name={'lastName'}\n                    i18n={i18n}\n                >\n                    <InputText\n                        name={generateFieldName('lastName')}\n                        value={data.lastName}\n                        classNameModifiers={['lastName']}\n                        onInput={eventHandler('input')}\n                        onBlur={eventHandler('blur')}\n                        placeholder={placeholders.lastName}\n                        spellcheck={false}\n                        required={true}\n                    />\n                </Field>\n            )}\n\n            {requiredFields.includes('dateOfBirth') && (\n                <Field\n                    label={i18n.get('dateOfBirth')}\n                    classNameModifiers={['col-50', 'dateOfBirth']}\n                    errorMessage={getErrorMessage(i18n, errors.dateOfBirth, i18n.get('dateOfBirth'))}\n                    helper={isDateInputSupported ? null : i18n.get('dateOfBirth.format')}\n                    name={'dateOfBirth'}\n                    i18n={i18n}\n                >\n                    <InputDate\n                        name={generateFieldName('dateOfBirth')}\n                        value={data.dateOfBirth}\n                        classNameModifiers={['dateOfBirth']}\n                        onInput={eventHandler('input')}\n                        onBlur={eventHandler('blur')}\n                        placeholder={placeholders.dateOfBirth}\n                        required={true}\n                    />\n                </Field>\n            )}\n\n            {requiredFields.includes('shopperEmail') && (\n                <Field\n                    label={i18n.get('shopperEmail')}\n                    classNameModifiers={['shopperEmail']}\n                    errorMessage={getErrorMessage(i18n, errors.shopperEmail, i18n.get('shopperEmail'))}\n                    dir={'ltr'}\n                    name={'emailAddress'}\n                    i18n={i18n}\n                >\n                    <InputEmail\n                        name={generateFieldName('shopperEmail')}\n                        value={data.shopperEmail}\n                        classNameModifiers={['shopperEmail']}\n                        onInput={eventHandler('input')}\n                        onBlur={eventHandler('blur')}\n                        placeholder={placeholders.shopperEmail}\n                        required={true}\n                    />\n                </Field>\n            )}\n\n            {requiredFields.includes('telephoneNumber') && (\n                <Field\n                    label={i18n.get('telephoneNumber')}\n                    classNameModifiers={['telephoneNumber']}\n                    errorMessage={getErrorMessage(i18n, errors.telephoneNumber, i18n.get('telephoneNumber'))}\n                    dir={'ltr'}\n                    name={'telephoneNumber'}\n                    i18n={i18n}\n                >\n                    <InputTelephone\n                        name={generateFieldName('telephoneNumber')}\n                        value={data.telephoneNumber}\n                        classNameModifiers={['telephoneNumber']}\n                        onInput={eventHandler('input')}\n                        onBlur={eventHandler('blur')}\n                        placeholder={placeholders.telephoneNumber}\n                        required={true}\n                    />\n                </Field>\n            )}\n        </Fieldset>\n    );\n}\n\nPersonalDetails.defaultProps = {\n    data: {},\n    onChange: () => {},\n    placeholders: {},\n    requiredFields: PERSONAL_DETAILS_SCHEMA,\n    validationRules: personalDetailsValidationRules,\n    visibility: 'editable'\n};\n"],"names":["PERSONAL_DETAILS_SCHEMA","PersonalDetails","props","label","namePrefix","placeholders","requiredFields","visibility","i18n","useCoreContext","isDateInputSupported","useMemo","checkDateInputSupport","handleChangeFor","triggerValidation","data","valid","errors","isValid","useForm","schema","rules","_object_spread","personalDetailsValidationRules","validationRules","defaultData","personalDetailsRef","useRef","showValidation","useEffect","setComponentRef","current","eventHandler","mode","e","name","target","key","split","pop","generateFieldName","formattedData","getFormattedData","onChange","h","ReadOnlyPersonalDetails","Fieldset","classNameModifiers","includes","Field","get","errorMessage","getErrorMessage","firstName","InputText","value","onInput","onBlur","placeholder","spellcheck","required","lastName","dateOfBirth","helper","InputDate","shopperEmail","dir","InputEmail","telephoneNumber","InputTelephone","defaultProps"],"mappings":"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"}