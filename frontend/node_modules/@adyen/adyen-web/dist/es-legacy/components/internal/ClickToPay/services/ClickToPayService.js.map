{"version":3,"file":"ClickToPayService.js","sources":["../../../../../../src/components/internal/ClickToPay/services/ClickToPayService.ts"],"sourcesContent":["import { ISrcInitiator } from './sdks/AbstractSrcInitiator';\nimport {\n    CallbackStateSubscriber,\n    IClickToPayService,\n    IdentityLookupParams,\n    ClickToPayCheckoutPayload,\n    SrcProfileWithScheme,\n    SchemesConfiguration,\n    IdentityValidationData\n} from './types';\nimport { ISrcSdkLoader } from './sdks/SrcSdkLoader';\nimport { createCheckoutPayloadBasedOnScheme, createShopperCardsList, CTP_IFRAME_NAME } from './utils';\nimport { SrciIdentityLookupResponse, SrciIsRecognizedResponse, SrcProfile } from './sdks/types';\nimport SrciError from './sdks/SrciError';\nimport { SchemeNames } from './sdks/utils';\nimport ShopperCard from '../models/ShopperCard';\nimport uuidv4 from '../../../../utils/uuid';\nimport AdyenCheckoutError from '../../../../core/Errors/AdyenCheckoutError';\nimport { isFulfilled, isRejected } from '../../../../utils/promise-util';\nimport TimeoutError from '../errors/TimeoutError';\nimport { executeWithTimeout } from './execute-with-timeout';\nimport type { IAnalytics } from '../../../../core/Analytics/Analytics';\n\nexport enum CtpState {\n    Idle = 'Idle',\n    Loading = 'Loading',\n    ShopperIdentified = 'ShopperIdentified',\n    OneTimePassword = 'OneTimePassword',\n    Ready = 'Ready',\n    Login = 'Login',\n    NotAvailable = 'NotAvailable'\n}\n\nclass ClickToPayService implements IClickToPayService {\n    private readonly sdkLoader: ISrcSdkLoader;\n    private readonly schemesConfig: SchemesConfiguration;\n    private readonly shopperIdentity?: IdentityLookupParams;\n    private readonly environment: string;\n    private readonly analytics: IAnalytics;\n\n    private readonly onTimeout?: (error: TimeoutError) => void;\n\n    /**\n     * Mandatory unique ID passed to all the networks (Click to Pay systems), used to track user journey\n     */\n    private readonly srciTransactionId: string = uuidv4();\n\n    private sdks: ISrcInitiator[];\n    private validationSchemeSdk: ISrcInitiator = null;\n    private stateSubscriber: CallbackStateSubscriber;\n\n    public state: CtpState = CtpState.Idle;\n    public shopperCards: ShopperCard[] = null;\n    public identityValidationData: IdentityValidationData = null;\n\n    /**\n     * Indicates if the shopper opted for saving cookies during the transaction\n     */\n    public storeCookies = false;\n\n    constructor(\n        schemesConfig: SchemesConfiguration,\n        sdkLoader: ISrcSdkLoader,\n        environment: string,\n        analytics: IAnalytics,\n        shopperIdentity?: IdentityLookupParams,\n        onTimeout?: (error: TimeoutError) => void\n    ) {\n        this.sdkLoader = sdkLoader;\n        this.schemesConfig = schemesConfig;\n        this.shopperIdentity = shopperIdentity;\n        this.environment = environment;\n        this.onTimeout = onTimeout;\n        this.analytics = analytics;\n    }\n\n    public get shopperAccountFound(): boolean {\n        return [CtpState.Ready, CtpState.ShopperIdentified].includes(this.state);\n    }\n\n    public get schemes(): string[] {\n        return this.sdkLoader.schemes;\n    }\n\n    public updateStoreCookiesConsent(shouldStore: boolean) {\n        this.storeCookies = shouldStore;\n    }\n\n    public async initialize(): Promise<void> {\n        this.setState(CtpState.Loading);\n\n        try {\n            this.sdks = await this.sdkLoader.load(this.environment, this.analytics);\n            await this.initiateSdks();\n\n            const { recognized = false, idTokens = null } = await this.verifyIfShopperIsRecognized();\n\n            if (recognized) {\n                await this.getShopperProfile(idTokens);\n                this.setState(CtpState.Ready);\n                return;\n            }\n\n            if (!this.shopperIdentity) {\n                this.setState(CtpState.NotAvailable);\n                return;\n            }\n\n            const { isEnrolled } = await this.verifyIfShopperIsEnrolled(this.shopperIdentity);\n            if (isEnrolled) {\n                this.setState(CtpState.ShopperIdentified);\n                return;\n            }\n\n            this.setState(CtpState.NotAvailable);\n        } catch (error) {\n            if ((error instanceof SrciError && error?.reason === 'REQUEST_TIMEOUT') || error instanceof TimeoutError) {\n                this.handleTimeout(error);\n            } else if (error instanceof SrciError) {\n                console.warn(`Error at ClickToPayService # init: ${error.toString()}`);\n            } else {\n                console.warn(error);\n            }\n\n            this.setState(CtpState.NotAvailable);\n        }\n    }\n\n    /**\n     * Set the callback for notifying when the CtPState changes\n     */\n    public subscribeOnStateChange(callback: CallbackStateSubscriber): void {\n        this.stateSubscriber = callback;\n    }\n\n    /**\n     * Initiates Consumer Identity validation with one Click to Pay System.\n     * The Click to Pay System sends a one-time-password (OTP) to the registered email address or mobile number.\n     **/\n    public async startIdentityValidation(): Promise<void> {\n        if (!this.validationSchemeSdk) {\n            throw Error('startIdentityValidation: No ValidationSDK set for the validation process');\n        }\n        try {\n            const { maskedValidationChannel } = await this.validationSchemeSdk.initiateIdentityValidation();\n\n            this.identityValidationData = {\n                maskedShopperContact: maskedValidationChannel.replace(/\\*/g, 'â€¢'),\n                selectedNetwork: SchemeNames[this.validationSchemeSdk.schemeName]\n            };\n\n            this.setState(CtpState.OneTimePassword);\n        } catch (error: unknown) {\n            // If there is an error when 'startIdentityValidation' (Ex: account is blocked), we reset the scheme chosen to perform this step\n            this.validationSchemeSdk = null;\n            throw error;\n        }\n    }\n\n    /**\n     * Completes the  validation of the Shopper by evaluating the supplied OTP.\n     */\n    public async finishIdentityValidation(otpCode: string): Promise<void> {\n        if (!this.validationSchemeSdk) {\n            throw Error('finishIdentityValidation: No ValidationSDK set for the validation process');\n        }\n\n        const validationToken = await this.validationSchemeSdk.completeIdentityValidation(otpCode);\n        await this.getShopperProfile([validationToken.idToken]);\n        this.setState(CtpState.Ready);\n        this.validationSchemeSdk = null;\n    }\n\n    /**\n     * This method performs checkout using the selected card\n     */\n    public async checkout(card: ShopperCard): Promise<ClickToPayCheckoutPayload> {\n        if (!card) {\n            throw Error('ClickToPayService # checkout: Missing card data');\n        }\n\n        const checkoutSdk = this.sdks.find(sdk => sdk.schemeName === card.scheme);\n\n        const checkoutResponse = await checkoutSdk.checkout({\n            srcDigitalCardId: card.srcDigitalCardId,\n            srcCorrelationId: card.srcCorrelationId,\n            ...(card.isDcfPopupEmbedded && { windowRef: window.frames[CTP_IFRAME_NAME] }),\n            ...(this.storeCookies && { complianceSettings: { complianceResources: [{ complianceType: 'REMEMBER_ME', uri: '' }] } })\n        });\n\n        if (checkoutResponse.dcfActionCode !== 'COMPLETE') {\n            throw new AdyenCheckoutError(\n                'ERROR',\n                `Checkout through Scheme DCF did not complete. DCF Action code received: ${checkoutResponse.dcfActionCode}`\n            );\n        }\n\n        return createCheckoutPayloadBasedOnScheme(card, checkoutResponse, this.environment);\n    }\n\n    /**\n     * Call the 'unbindAppInstance()' method of each SRC SDK in order to remove the shopper cookies.\n     * Besides, it deletes all information stored about the shopper.\n     */\n    public async logout(): Promise<void> {\n        if (!this.sdks) {\n            throw new AdyenCheckoutError('ERROR', 'ClickToPayService is not initialized');\n        }\n\n        try {\n            const logoutPromises = this.sdks.map(sdk => sdk.unbindAppInstance());\n            await Promise.all(logoutPromises);\n        } catch (error) {\n            if (error instanceof SrciError) console.warn(`Error at ClickToPayService # logout: ${error.toString()}`);\n            else console.warn(error);\n        }\n\n        this.shopperCards = null;\n        this.identityValidationData = null;\n        this.validationSchemeSdk = null;\n\n        this.setState(CtpState.Login);\n    }\n\n    /**\n     * Call the 'identityLookup()' method of each SRC SDK in order to verify if the shopper has an account.\n     *\n     * Based on the responses from the Click to Pay Systems, we should do the validation process using the SDK that\n     * that responds faster with 'consumerPresent=true'\n     */\n    public verifyIfShopperIsEnrolled(shopperIdentity: IdentityLookupParams): Promise<{ isEnrolled: boolean }> {\n        const { shopperEmail } = shopperIdentity;\n\n        return new Promise((resolve, reject) => {\n            const lookupPromises = this.sdks.map(sdk => {\n                const identityLookupPromise = executeWithTimeout<SrciIdentityLookupResponse>(\n                    () => sdk.identityLookup({ identityValue: shopperEmail, type: 'email' }),\n                    5000,\n                    new TimeoutError({\n                        source: 'identityLookup',\n                        scheme: sdk.schemeName,\n                        isTimeoutTriggeredBySchemeSdk: false\n                    })\n                );\n\n                return identityLookupPromise\n                    .then(response => {\n                        if (response.consumerPresent && !this.validationSchemeSdk) {\n                            this.setSdkForPerformingShopperIdentityValidation(sdk);\n                            resolve({ isEnrolled: true });\n                        }\n                    })\n                    .catch(error => {\n                        reject(error);\n                    });\n            });\n\n            void Promise.allSettled(lookupPromises).then(() => {\n                resolve({ isEnrolled: false });\n            });\n        });\n    }\n\n    private setState(state: CtpState): void {\n        this.state = state;\n        this.stateSubscriber?.(this.state);\n    }\n\n    private setSdkForPerformingShopperIdentityValidation(sdk: ISrcInitiator) {\n        this.validationSchemeSdk = sdk;\n    }\n\n    private handleTimeout(error: SrciError | TimeoutError) {\n        // If the timeout error was thrown directly by the scheme SDK, we convert it to TimeoutError\n        // If the timeout error was thrown by our internal timeout mechanism, we don't do anything\n        const timeoutError =\n            error instanceof SrciError\n                ? new TimeoutError({ source: error.source, scheme: error.scheme, isTimeoutTriggeredBySchemeSdk: true })\n                : error;\n\n        if (timeoutError.scheme === 'visa') {\n            timeoutError.setCorrelationId(window.VISA_SDK?.correlationId);\n\n            // Visa srciDpaId must be passed when there is no correlation ID available\n            if (window.VISA_SDK?.correlationId) window.VISA_SDK?.buildClientProfile?.();\n            else window.VISA_SDK?.buildClientProfile?.(this.schemesConfig.visa.srciDpaId);\n        }\n        this.onTimeout?.(timeoutError);\n    }\n\n    /**\n     * Based on the given 'idToken', this method goes through each SRCi SDK and fetches the shopper\n     * profile with his cards.\n     */\n    private async getShopperProfile(idTokens: string[]): Promise<void> {\n        return new Promise((resolve, reject) => {\n            const srcProfilesPromises = this.sdks.map(sdk => sdk.getSrcProfile(idTokens));\n\n            void Promise.allSettled(srcProfilesPromises).then(srcProfilesResponses => {\n                if (srcProfilesResponses.every(isRejected)) {\n                    reject(srcProfilesResponses[0].reason);\n                }\n\n                const createProfileWithScheme = (promiseResult: PromiseSettledResult<SrcProfile>, index) =>\n                    isFulfilled(promiseResult) && { ...promiseResult.value, scheme: this.sdks[index].schemeName };\n\n                const profilesWithScheme: SrcProfileWithScheme[] = srcProfilesResponses.map(createProfileWithScheme).filter(profile => !!profile);\n\n                this.shopperCards = createShopperCardsList(profilesWithScheme);\n                resolve();\n            });\n        });\n    }\n\n    /**\n     * Calls the 'isRecognized()' method of each SRC SDK in order to verify if the shopper is\n     * recognized on the device. The shopper is recognized if he/she has the Cookies stored\n     * on their browser\n     */\n    private verifyIfShopperIsRecognized(): Promise<SrciIsRecognizedResponse> {\n        return new Promise((resolve, reject) => {\n            const promises = this.sdks.map(sdk => {\n                const isRecognizedPromise = executeWithTimeout<SrciIsRecognizedResponse>(\n                    () => sdk.isRecognized(),\n                    5000,\n                    new TimeoutError({\n                        source: 'isRecognized',\n                        scheme: sdk.schemeName,\n                        isTimeoutTriggeredBySchemeSdk: false\n                    })\n                );\n\n                return isRecognizedPromise\n                    .then(response => {\n                        if (response.recognized) resolve(response);\n                    })\n                    .catch(error => {\n                        reject(error);\n                    });\n            });\n\n            // If the 'resolve' didn't happen until this point, then shopper is not recognized\n            void Promise.allSettled(promises).then(() => {\n                resolve({ recognized: false });\n            });\n        });\n    }\n\n    private initiateSdks(): Promise<void[]> {\n        const initPromises = this.sdks.map(sdk => {\n            const cfg = this.schemesConfig[sdk.schemeName];\n\n            return executeWithTimeout<void>(\n                () => sdk.init(cfg, this.srciTransactionId),\n                5000,\n                new TimeoutError({\n                    source: 'init',\n                    scheme: sdk.schemeName,\n                    isTimeoutTriggeredBySchemeSdk: false\n                })\n            );\n        });\n\n        return Promise.all(initPromises);\n    }\n}\n\nexport default ClickToPayService;\n"],"names":["CtpState","ClickToPayService","shopperAccountFound","includes","this","state","schemes","sdkLoader","updateStoreCookiesConsent","shouldStore","storeCookies","initialize","setState","sdks","load","environment","analytics","initiateSdks","recognized","idTokens","verifyIfShopperIsRecognized","getShopperProfile","shopperIdentity","isEnrolled","verifyIfShopperIsEnrolled","error","SrciError","reason","TimeoutError","handleTimeout","console","warn","toString","subscribeOnStateChange","callback","stateSubscriber","startIdentityValidation","validationSchemeSdk","Error","maskedValidationChannel","initiateIdentityValidation","identityValidationData","maskedShopperContact","replace","selectedNetwork","SchemeNames","schemeName","finishIdentityValidation","otpCode","validationToken","completeIdentityValidation","idToken","checkout","card","checkoutSdk","find","sdk","scheme","checkoutResponse","_object_spread","srcDigitalCardId","srcCorrelationId","isDcfPopupEmbedded","windowRef","window","frames","CTP_IFRAME_NAME","complianceSettings","complianceResources","complianceType","uri","dcfActionCode","AdyenCheckoutError","createCheckoutPayloadBasedOnScheme","logout","logoutPromises","map","unbindAppInstance","Promise","all","shopperCards","shopperEmail","resolve","reject","lookupPromises","executeWithTimeout","identityLookup","identityValue","type","source","isTimeoutTriggeredBySchemeSdk","then","response","consumerPresent","setSdkForPerformingShopperIdentityValidation","catch","allSettled","_this_stateSubscriber","call","_this_onTimeout","timeoutError","setCorrelationId","VISA_SDK","correlationId","buildClientProfile","schemesConfig","visa","srciDpaId","onTimeout","srcProfilesPromises","getSrcProfile","srcProfilesResponses","every","isRejected","profilesWithScheme","promiseResult","index","isFulfilled","_object_spread_props","value","filter","profile","createShopperCardsList","promises","isRecognized","initPromises","cfg","init","srciTransactionId","constructor","_define_property","uuidv4"],"mappings":"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"}