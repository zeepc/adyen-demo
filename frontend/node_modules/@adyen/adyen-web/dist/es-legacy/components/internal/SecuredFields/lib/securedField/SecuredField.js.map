{"version":3,"file":"SecuredField.js","sources":["../../../../../../../src/components/internal/SecuredFields/lib/securedField/SecuredField.ts"],"sourcesContent":["import * as logger from '../utilities/logger';\nimport createIframe from './utils/createIframe';\nimport { removeAllChildren, selectOne } from '../utilities/dom';\nimport { off, on } from '../../../../../utils/listenerUtils';\nimport postMessageToIframe from '../CSF/utils/iframes/postMessageToIframe';\nimport { isChromeVoxPostMsg, isWebpackPostMsg, originCheckPassed } from '../CSF/utils/iframes/postMessageValidation';\nimport {\n    CVC_POLICY_HIDDEN,\n    CVC_POLICY_OPTIONAL,\n    DATE_POLICY_HIDDEN,\n    DATE_POLICY_OPTIONAL,\n    ENCRYPTED_EXPIRY_DATE,\n    ENCRYPTED_EXPIRY_MONTH,\n    ENCRYPTED_EXPIRY_YEAR,\n    ENCRYPTED_SECURITY_CODE\n} from '../constants';\nimport { generateRandomNumber } from '../utilities/commonUtils';\nimport { CVCPolicyType, DatePolicyType, RtnType_callbackFn, RtnType_noParamVoidFn, RtnType_postMessageListener, SFFeedbackObj } from '../types';\nimport AbstractSecuredField from './AbstractSecuredField';\nimport { AriaConfig, IframeConfigObject, SecuredFieldSetupObject, SecuredFieldCommonProps } from '../types';\nimport { reject } from '../../../../../utils/commonUtils';\nimport { processAriaConfig } from './utils/processAriaConfig';\nimport { processPlaceholders } from './utils/processPlaceholders';\nimport Language from '../../../../../language/Language';\nimport { hasOwnProperty } from '../../../../../utils/hasOwnProperty';\nimport { Placeholders } from '../../SFP/types';\nimport './SecuredField.scss';\nimport { AnalyticsErrorEvent, ErrorEventCode, ErrorEventType } from '../../../../../core/Analytics/events/AnalyticsErrorEvent';\n\nconst logPostMsg = false;\nconst doLog = false;\n\nclass SecuredField extends AbstractSecuredField {\n    constructor(pSetupObj: SecuredFieldSetupObject, i18n: Language) {\n        super();\n\n        /**\n         * List of props to exclude from being set on this.sfConfig.\n         * These props are only required for internal purposes. They do not get sent to the iframe\n         */\n        const deltaPropsArr: string[] = ['loadingContext', 'holderEl', 'iframeSrc', 'showContextualElement', 'placeholders'];\n\n        /**\n         * List of props from setup object that will be set on this.sfConfig\n         * These props will all end up being sent to the iframe\n         */\n        const configVarsFromSetUpObj = reject(deltaPropsArr).from(pSetupObj);\n\n        // Copy passed setup object values to this.sfConfig\n        this.sfConfig = {\n            // ...this.sfConfig, // Do we need to do this? Pretty sure we don't\n            ...configVarsFromSetUpObj,\n            // Break references on iframeUIConfig object so we can overwrite its properties in each securedField instance\n            iframeUIConfig: { ...configVarsFromSetUpObj.iframeUIConfig }\n        } as SecuredFieldCommonProps;\n\n        /**\n         * Extract values only needed for init\n         */\n        const { iframeSrc, placeholders, showContextualElement } = pSetupObj;\n\n        /**\n         * Store those passed setup object values that are needed in multiple functions\n         */\n        this.loadingContext = pSetupObj.loadingContext;\n        this.holderEl = pSetupObj.holderEl;\n        this.submitAnalytics = pSetupObj.submitAnalytics;\n        this.componentType = pSetupObj.componentType;\n\n        /**\n         * Initiate other values on 'this' through setters\n         */\n        this.isValid = false;\n        this.iframeContentWindow = null;\n        this.numKey = generateRandomNumber();\n        this.isEncrypted = false;\n        this.hasError = false;\n        this.errorType = '';\n        this.cvcPolicy = pSetupObj.cvcPolicy;\n        this.expiryDatePolicy = pSetupObj.expiryDatePolicy;\n\n        if (process.env.NODE_ENV === 'development' && doLog) {\n            logger.log(\n                '### SecuredField::constructor:: this.sfConfig.fieldType=',\n                this.sfConfig.fieldType,\n                'isValid=',\n                this._isValid,\n                'numKey=',\n                this.numKey\n            );\n            logger.log('\\n');\n        }\n\n        return this.init(i18n, iframeSrc, placeholders, showContextualElement);\n    }\n\n    init(i18n: Language, iframeSrc: string, placeholders: Placeholders, showContextualElement: boolean): SecuredField {\n        /**\n         * Ensure all fields have a related ariaConfig object containing, at minimum, an iframeTitle property and a (translated) errors object\n         */\n        const processedAriaConfig: AriaConfig = processAriaConfig(this.sfConfig.txVariant, this.sfConfig.fieldType, i18n, showContextualElement);\n        // Set result back onto config object\n        this.sfConfig.iframeUIConfig.ariaConfig = processedAriaConfig;\n\n        // Set result back onto config object\n        this.sfConfig.iframeUIConfig.placeholders = processPlaceholders(this.sfConfig.txVariant, this.sfConfig.fieldType, placeholders);\n\n        /**\n         * Configure, create & reference iframe and add load listener\n         */\n        const iframeConfig = {\n            src: iframeSrc,\n            title: processedAriaConfig[this.sfConfig.fieldType].iframeTitle,\n            policy: 'origin'\n        };\n\n        const iframeEl: HTMLIFrameElement = createIframe(iframeConfig);\n\n        // Place the iframe into the holder\n        this.holderEl.appendChild(iframeEl);\n\n        // Now examine the holder to get an actual DOM node\n        const iframe: HTMLIFrameElement = selectOne(this.holderEl, '.js-iframe');\n\n        if (iframe) {\n            if (!iframe.contentWindow) {\n                // Warn the dev\n                console.error(\n                    'ERROR: Trying to initialise a securedField iframe, but the iframe.contentWindow is undefined. Are you sure the element into which the Card component is being mounted already exists in the DOM *before* the Card component is mounted?'\n                );\n                // Log the error\n                const event = new AnalyticsErrorEvent({\n                    component: this.componentType,\n                    code: ErrorEventCode.SECURED_FIELDS_IFRAME_CONTENT_WINDOW_NOT_FOUND,\n                    errorType: ErrorEventType.implementation,\n                    message: `Trying to initialise an iframe for ${this.sfConfig.fieldType}, but the iframe.contentWindow is undefined`\n                });\n\n                this.submitAnalytics?.(event);\n            }\n\n            this.iframeContentWindow = iframe.contentWindow;\n\n            // Create reference to bound fn (see getters/setters for binding)\n            this.iframeOnLoadListener = this.iframeOnLoadListenerFn;\n\n            on(iframe, 'load', this.iframeOnLoadListener, false);\n        }\n\n        this.iframeRef = iframe;\n\n        return this;\n    }\n\n    iframeOnLoadListenerFn(): void {\n        // Create reference to bound fn (see getters/setters for binding)\n        this.postMessageListener = this.postMessageListenerFn;\n\n        // Add general listener for 'message' EVENT - the event that 'powers' postMessage\n        on(window, 'message', this.postMessageListener, false);\n\n        // Create and send config object to iframe\n        const configObj: IframeConfigObject = {\n            ...this.sfConfig,\n            numKey: this.numKey\n        };\n\n        if (window._b$dl) console.log('### SecuredField:::: onIframeLoaded:: created configObj=', configObj);\n\n        postMessageToIframe(configObj, this.iframeContentWindow, this.loadingContext);\n        //--\n\n        // Callback to say iframe loaded\n        this.onIframeLoadedCallback();\n    }\n\n    postMessageListenerFn(event: MessageEvent): void {\n        // Check message is from expected domain\n        if (!originCheckPassed(event, this.loadingContext, this.sfConfig.showWarnings)) {\n            return;\n        }\n\n        // TODO - for debugging purposes this would always be useful to see\n        //        logger.log('\\n',this.sfConfig.fieldType,'### CSF SecuredField::postMessageListener:: event.data=',event.data);\n\n        if (process.env.NODE_ENV === 'development' && logPostMsg) {\n            logger.log(\n                '\\n###CSF SecuredField::postMessageListener:: DOMAIN & ORIGIN MATCH, NO WEBPACK WEIRDNESS fieldType=',\n                this.sfConfig.fieldType,\n                'txVariant=',\n                this.sfConfig.txVariant,\n                'this.numKey=',\n                this.numKey\n            );\n        }\n\n        // PARSE DATA OBJECT (thus testing if it is a JSON string) - OR TRY & WORK OUT WHY THE PARSING FAILED\n        let feedbackObj: SFFeedbackObj;\n\n        try {\n            feedbackObj = JSON.parse(event.data);\n        } catch (e) {\n            // Was the message generated by webpack?\n            if (isWebpackPostMsg(event)) {\n                if (this.sfConfig.showWarnings) logger.log('### SecuredField::postMessageListenerFn:: PARSE FAIL - WEBPACK');\n                return;\n            }\n\n            // Was the message generated by ChromeVox?\n            if (isChromeVoxPostMsg(event)) {\n                if (this.sfConfig.showWarnings) logger.log('### SecuredField::postMessageListenerFn:: PARSE FAIL - CHROMEVOX');\n                return;\n            }\n\n            if (this.sfConfig.showWarnings)\n                logger.log('### SecuredField::postMessageListenerFn:: PARSE FAIL - UNKNOWN REASON: event.data=', event.data);\n            return;\n        }\n\n        // CHECK FOR EXPECTED PROPS\n        const hasMainProps: boolean = hasOwnProperty(feedbackObj, 'action') && hasOwnProperty(feedbackObj, 'numKey');\n\n        if (!hasMainProps) {\n            if (this.sfConfig.showWarnings) logger.warn('WARNING SecuredField :: postMessage listener for iframe :: data mismatch!');\n            return;\n        }\n\n        if (process.env.NODE_ENV === 'development' && logPostMsg) {\n            logger.log('### SecuredField::postMessageListener:: feedbackObj.numKey=', feedbackObj.numKey);\n        }\n\n        if (this.numKey !== feedbackObj.numKey) {\n            if (this.sfConfig.showWarnings) {\n                logger.warn(\n                    'WARNING SecuredField :: postMessage listener for iframe :: data mismatch! (Probably a message from an unrelated securedField)'\n                );\n            }\n            return;\n        }\n\n        // VALIDATION CHECKS PASSED - DECIDE ON COURSE OF ACTION\n        if (process.env.NODE_ENV === 'development' && logPostMsg) {\n            logger.log(\n                '### SecuredField::postMessageListener:: numkeys match PROCEED WITH POST MESSAGE PROCESSING fieldType=',\n                this.sfConfig.fieldType,\n                'txVariant=',\n                this.sfConfig.txVariant\n            );\n        }\n\n        switch (feedbackObj.action) {\n            case 'encryption':\n                this.isValid = true;\n                this.onEncryptionCallback(feedbackObj);\n                break;\n\n            case 'config':\n                if (window._b$dl)\n                    console.log('### SecuredField::postMessageListenerFn:: configured - calling onConfigCallback', feedbackObj.fieldType);\n                this.onConfigCallback(feedbackObj);\n                break;\n\n            case 'focus':\n                this.onFocusCallback(feedbackObj);\n                break;\n\n            case 'binValue':\n                this.onBinValueCallback(feedbackObj);\n                break;\n\n            // iOS ONLY - RE. iOS BUGS AROUND BLUR AND FOCUS EVENTS\n            case 'touch':\n                this.onTouchstartCallback(feedbackObj);\n                break;\n\n            // Only happens for Firefox & IE <= 11\n            case 'shifttab':\n                this.onShiftTabCallback(feedbackObj);\n                break;\n\n            case 'autoComplete':\n                this.onAutoCompleteCallback(feedbackObj);\n                break;\n\n            case 'enterKeyPressed':\n                this.onKeyPressedCallback(feedbackObj);\n                break;\n\n            case 'encryptionError': {\n                const event = new AnalyticsErrorEvent({\n                    component: this.componentType,\n                    code: feedbackObj.code,\n                    errorType: ErrorEventType.internal,\n                    message: `${feedbackObj.error}. Field= ${this.sfConfig.fieldType}`\n                });\n\n                this.submitAnalytics?.(event);\n                break;\n            }\n\n            /**\n             * Validate, because action =\n             *\n             *  'brand'\n             *  'delete'\n             *  'luhnCheck'\n             *  'incomplete field' (an error that follows from a focus (blur) event)\n             *  'incorrectly filled field' (an error that follows from a focus (blur) event)\n             *  'numberKeyPressed' (or date-, month-, year-, cvc-, pin-, or iban- KeyPressed)\n             *    - since we have no \"error\" action \"...KeyPressed\" is the action type on most error events (other than \"incomplete field, 'incorrectly filled field' or \"luhnCheck\")\n             *    and often these error events representing the clearing of an existing error\n             */\n            default:\n                // If we're validation handling (& not encryption handling) field must be invalid\n                this.isValid = false;\n                this.onValidationCallback(feedbackObj);\n        }\n    }\n\n    destroy(): void {\n        off(window, 'message', this.postMessageListener, false);\n        off(this.iframeRef, 'load', this.iframeOnLoadListener, false);\n        this.iframeContentWindow = null;\n        removeAllChildren(this.holderEl);\n    }\n\n    /**\n     * Returns whether the securedField is hidden OR whether it is optional and not in error\n     */\n    isOptionalOrHidden(): boolean {\n        if (\n            this.sfConfig.fieldType === ENCRYPTED_EXPIRY_DATE ||\n            this.sfConfig.fieldType === ENCRYPTED_EXPIRY_MONTH ||\n            this.sfConfig.fieldType === ENCRYPTED_EXPIRY_YEAR\n        ) {\n            switch (this.expiryDatePolicy) {\n                case DATE_POLICY_HIDDEN:\n                    return true;\n                case DATE_POLICY_OPTIONAL:\n                    return !this.hasError;\n                default:\n                    return false;\n            }\n        }\n\n        if (this.sfConfig.fieldType === ENCRYPTED_SECURITY_CODE) {\n            switch (this.cvcPolicy) {\n                case CVC_POLICY_HIDDEN:\n                    return true;\n                case CVC_POLICY_OPTIONAL:\n                    return !this.hasError;\n                default:\n                    return false;\n            }\n        }\n\n        // Any other type of securedField is not optional & can't be hidden\n        return false;\n    }\n\n    // /////// ALLOCATE CALLBACKS /////////\n    onIframeLoaded(callbackFn: RtnType_noParamVoidFn): SecuredField {\n        this.onIframeLoadedCallback = callbackFn;\n        return this;\n    }\n\n    onEncryption(callbackFn: RtnType_callbackFn): SecuredField {\n        this.onEncryptionCallback = callbackFn;\n        return this;\n    }\n\n    onValidation(callbackFn: RtnType_callbackFn): SecuredField {\n        this.onValidationCallback = callbackFn;\n        return this;\n    }\n\n    onConfig(callbackFn: RtnType_callbackFn): SecuredField {\n        this.onConfigCallback = callbackFn;\n        return this;\n    }\n\n    onFocus(callbackFn: RtnType_callbackFn): SecuredField {\n        this.onFocusCallback = callbackFn;\n        return this;\n    }\n\n    onBinValue(callbackFn: RtnType_callbackFn): SecuredField {\n        this.onBinValueCallback = callbackFn;\n        return this;\n    }\n\n    onTouchstart(callbackFn: RtnType_callbackFn): SecuredField {\n        this.onTouchstartCallback = callbackFn;\n        return this;\n    }\n\n    onShiftTab(callbackFn: RtnType_callbackFn): SecuredField {\n        this.onShiftTabCallback = callbackFn;\n        return this;\n    }\n\n    onAutoComplete(callbackFn: RtnType_callbackFn): SecuredField {\n        this.onAutoCompleteCallback = callbackFn;\n        return this;\n    }\n\n    onKeyPressed(callbackFn: RtnType_callbackFn): SecuredField {\n        this.onKeyPressedCallback = callbackFn;\n        return this;\n    }\n    //------------------------------------\n\n    // ///////////// GETTERS/SETTERS //////////////\n\n    get errorType(): string {\n        return this._errorType;\n    }\n    set errorType(value: string) {\n        this._errorType = value;\n    }\n\n    get hasError(): boolean {\n        return this._hasError;\n    }\n    set hasError(value: boolean) {\n        this._hasError = value;\n    }\n\n    get isValid(): boolean {\n        if (this.sfConfig.fieldType === ENCRYPTED_SECURITY_CODE) {\n            switch (this.cvcPolicy) {\n                case CVC_POLICY_HIDDEN:\n                    // If cvc is hidden then the field is always valid\n                    return true;\n                case CVC_POLICY_OPTIONAL:\n                    // If cvc is optional then the field is always valid UNLESS it has an error\n                    return !this.hasError;\n                default:\n                    return this._isValid;\n            }\n        }\n\n        if (\n            this.sfConfig.fieldType === ENCRYPTED_EXPIRY_DATE ||\n            this.sfConfig.fieldType === ENCRYPTED_EXPIRY_MONTH ||\n            this.sfConfig.fieldType === ENCRYPTED_EXPIRY_YEAR\n        ) {\n            switch (this.expiryDatePolicy) {\n                case DATE_POLICY_HIDDEN:\n                    // If date is hidden then the field is always valid\n                    return true;\n                case DATE_POLICY_OPTIONAL:\n                    // If date is optional then the field is always valid UNLESS it has an error\n                    return !this.hasError;\n                default:\n                    return this._isValid;\n            }\n        }\n\n        return this._isValid;\n    }\n    set isValid(value: boolean) {\n        this._isValid = value;\n    }\n\n    get cvcPolicy(): CVCPolicyType {\n        return this._cvcPolicy;\n    }\n\n    set cvcPolicy(value: CVCPolicyType) {\n        // Only set if this is a CVC field\n        if (this.sfConfig.fieldType !== ENCRYPTED_SECURITY_CODE) return;\n\n        // Only set if value has changed\n        if (value === this.cvcPolicy) return;\n\n        if (process.env.NODE_ENV === 'development' && doLog) logger.log(this.sfConfig.fieldType, '### SecuredField::cvcPolicy:: value=', value);\n\n        this._cvcPolicy = value;\n\n        // If the field has changed status (required <--> not required) AND it's error state was due to an isValidated call\n        // NOTE: fixes issue in Components where you first validate and then start typing a maestro number\n        // - w/o this and the fix in CSF the maestro PM will never register as valid\n        if (this.hasError && this.errorType === 'isValidated') {\n            this.hasError = false;\n        }\n    }\n\n    get expiryDatePolicy(): DatePolicyType {\n        return this._expiryDatePolicy;\n    }\n\n    set expiryDatePolicy(value: DatePolicyType) {\n        // Only set if this is a date field type of securedField\n        if (\n            this.sfConfig.fieldType !== ENCRYPTED_EXPIRY_DATE &&\n            this.sfConfig.fieldType !== ENCRYPTED_EXPIRY_MONTH &&\n            this.sfConfig.fieldType !== ENCRYPTED_EXPIRY_YEAR\n        )\n            return;\n\n        // Only set if value has changed\n        if (value === this.expiryDatePolicy) return;\n\n        if (process.env.NODE_ENV === 'development' && doLog) logger.log(this.sfConfig.fieldType, '### SecuredField:expiryDatePolicy:: value=', value);\n\n        this._expiryDatePolicy = value;\n\n        // If the field has changed status (required <--> not required) AND it's error state was due to an isValidated call\n        if (this.hasError && this.errorType === 'isValidated') {\n            this.hasError = false;\n        }\n    }\n\n    get iframeContentWindow(): Window {\n        return this._iframeContentWindow;\n    }\n    set iframeContentWindow(value: Window) {\n        this._iframeContentWindow = value;\n    }\n\n    get isEncrypted(): boolean {\n        return this._isEncrypted;\n    }\n    set isEncrypted(value: boolean) {\n        this._isEncrypted = value;\n    }\n\n    get numKey(): number {\n        return this._numKey;\n    }\n    set numKey(value: number) {\n        this._numKey = value;\n    }\n\n    // Internal use - way to create listener refs that we can add/remove\n    get iframeOnLoadListener(): RtnType_noParamVoidFn {\n        return this._iframeOnLoadListener;\n    }\n    set iframeOnLoadListener(value: RtnType_noParamVoidFn) {\n        this._iframeOnLoadListener = value.bind(this);\n    }\n\n    get postMessageListener(): RtnType_postMessageListener {\n        return this._postMessageListener;\n    }\n    set postMessageListener(value: RtnType_postMessageListener) {\n        this._postMessageListener = value.bind(this);\n    }\n}\n\nexport default SecuredField;\n"],"names":["SecuredField","AbstractSecuredField","init","i18n","iframeSrc","placeholders","showContextualElement","processedAriaConfig","processAriaConfig","this","sfConfig","txVariant","fieldType","iframeUIConfig","ariaConfig","processPlaceholders","iframeConfig","src","title","iframeTitle","policy","iframeEl","createIframe","holderEl","appendChild","iframe","selectOne","contentWindow","_this_submitAnalytics","console","error","event","AnalyticsErrorEvent","component","componentType","code","ErrorEventCode","SECURED_FIELDS_IFRAME_CONTENT_WINDOW_NOT_FOUND","errorType","ErrorEventType","implementation","message","submitAnalytics","iframeContentWindow","iframeOnLoadListener","iframeOnLoadListenerFn","on","iframeRef","postMessageListener","postMessageListenerFn","window","configObj","_object_spread_props","_object_spread","numKey","_b$dl","log","postMessageToIframe","loadingContext","onIframeLoadedCallback","originCheckPassed","showWarnings","feedbackObj","JSON","parse","data","e","isWebpackPostMsg","logger","isChromeVoxPostMsg","hasOwnProperty","action","isValid","onEncryptionCallback","onConfigCallback","onFocusCallback","onBinValueCallback","onTouchstartCallback","onShiftTabCallback","onAutoCompleteCallback","onKeyPressedCallback","internal","onValidationCallback","destroy","off","removeAllChildren","isOptionalOrHidden","ENCRYPTED_EXPIRY_DATE","ENCRYPTED_EXPIRY_MONTH","ENCRYPTED_EXPIRY_YEAR","expiryDatePolicy","DATE_POLICY_HIDDEN","DATE_POLICY_OPTIONAL","hasError","ENCRYPTED_SECURITY_CODE","cvcPolicy","CVC_POLICY_HIDDEN","CVC_POLICY_OPTIONAL","onIframeLoaded","callbackFn","onEncryption","onValidation","onConfig","onFocus","onBinValue","onTouchstart","onShiftTab","onAutoComplete","onKeyPressed","_errorType","value","_hasError","_isValid","_cvcPolicy","_expiryDatePolicy","_iframeContentWindow","isEncrypted","_isEncrypted","_numKey","_iframeOnLoadListener","bind","_postMessageListener","constructor","pSetupObj","super","configVarsFromSetUpObj","reject","from","generateRandomNumber"],"mappings":"47DAgCA,MAAMA,UAAqBC,EAgEvBC,IAAAA,CAAKC,EAAgBC,EAAmBC,EAA4BC,GAIhE,MAAMC,EAAkCC,EAAkBC,KAAKC,SAASC,UAAWF,KAAKC,SAASE,UAAWT,EAAMG,GAElHG,KAAKC,SAASG,eAAeC,WAAaP,EAG1CE,KAAKC,SAASG,eAAeR,aAAeU,EAAoBN,KAAKC,SAASC,UAAWF,KAAKC,SAASE,UAAWP,GAKlH,MAAMW,EAAe,CACjBC,IAAKb,EACLc,MAAOX,EAAoBE,KAAKC,SAASE,WAAWO,YACpDC,OAAQ,UAGNC,EAA8BC,EAAaN,GAGjDP,KAAKc,SAASC,YAAYH,GAG1B,MAAMI,EAA4BC,EAAUjB,KAAKc,SAAU,cAE3D,GAAIE,EAAQ,CACR,IAAKA,EAAOE,cAAe,KAavBC,EAXAC,QAAQC,MACJ,2OAGJ,MAAMC,EAAQ,IAAIC,EAAoB,CAClCC,UAAWxB,KAAKyB,cAChBC,KAAMC,EAAeC,+CACrBC,UAAWC,EAAeC,eAC1BC,QAAS,sCAAsChC,KAAKC,SAASE,yDAG7C,QAApBgB,EAAAnB,KAAKiC,uBAAL,IAAAd,GAAAA,OAAAnB,KAAuBsB,EAC3B,CAEAtB,KAAKkC,oBAAsBlB,EAAOE,cAGlClB,KAAKmC,qBAAuBnC,KAAKoC,uBAEjCC,EAAGrB,EAAQ,OAAQhB,KAAKmC,sBAAsB,EAClD,CAIA,OAFAnC,KAAKsC,UAAYtB,EAEVhB,IACX,CAEAoC,sBAAAA,GAEIpC,KAAKuC,oBAAsBvC,KAAKwC,sBAGhCH,EAAGI,OAAQ,UAAWzC,KAAKuC,qBAAqB,GAGhD,MAAMG,EAAgCC,EAAAC,EAAA,CAAA,EAC/B5C,KAAKC,UAAQ,CAChB4C,OAAQ7C,KAAK6C,SAGbJ,OAAOK,OAAO1B,QAAQ2B,IAAI,2DAA4DL,GAE1FM,EAAoBN,EAAW1C,KAAKkC,oBAAqBlC,KAAKiD,gBAI9DjD,KAAKkD,wBACT,CAEAV,qBAAAA,CAAsBlB,GAElB,IAAK6B,EAAkB7B,EAAOtB,KAAKiD,eAAgBjD,KAAKC,SAASmD,cAC7D,OAkBJ,IAAIC,EAEJ,IACIA,EAAcC,KAAKC,MAAMjC,EAAMkC,KACnC,CAAE,MAAOC,GAEL,OAAIC,EAAiBpC,QACbtB,KAAKC,SAASmD,cAAcO,EAAW,mEAK3CC,EAAmBtC,QACftB,KAAKC,SAASmD,cAAcO,EAAW,0EAI3C3D,KAAKC,SAASmD,cACdO,EAAW,qFAAsFrC,EAAMkC,MAE/G,CAKA,GAF8BK,EAAeR,EAAa,WAAaQ,EAAeR,EAAa,UAWnG,GAAIrD,KAAK6C,SAAWQ,EAAYR,OAmBhC,OAAQQ,EAAYS,QAChB,IAAK,aACD9D,KAAK+D,SAAU,EACf/D,KAAKgE,qBAAqBX,GAC1B,MAEJ,IAAK,SACGZ,OAAOK,OACP1B,QAAQ2B,IAAI,kFAAmFM,EAAYlD,WAC/GH,KAAKiE,iBAAiBZ,GACtB,MAEJ,IAAK,QACDrD,KAAKkE,gBAAgBb,GACrB,MAEJ,IAAK,WACDrD,KAAKmE,mBAAmBd,GACxB,MAGJ,IAAK,QACDrD,KAAKoE,qBAAqBf,GAC1B,MAGJ,IAAK,WACDrD,KAAKqE,mBAAmBhB,GACxB,MAEJ,IAAK,eACDrD,KAAKsE,uBAAuBjB,GAC5B,MAEJ,IAAK,kBACDrD,KAAKuE,qBAAqBlB,GAC1B,MAEJ,IAAK,kBAAmB,KAQpBlC,EAPA,MAAMG,EAAQ,IAAIC,EAAoB,CAClCC,UAAWxB,KAAKyB,cAChBC,KAAM2B,EAAY3B,KAClBG,UAAWC,EAAe0C,SAC1BxC,QAAS,GAAGqB,EAAYhC,iBAAiBrB,KAAKC,SAASE,cAGvC,QAApBgB,EAAAnB,KAAKiC,uBAAL,IAAAd,GAAAA,OAAAnB,KAAuBsB,GACvB,KACJ,CAcA,QAEItB,KAAK+D,SAAU,EACf/D,KAAKyE,qBAAqBpB,QAnF1BrD,KAAKC,SAASmD,cACdO,EACI,sIAXJ3D,KAAKC,SAASmD,cAAcO,EAAY,4EA8FpD,CAEAe,OAAAA,GACIC,EAAIlC,OAAQ,UAAWzC,KAAKuC,qBAAqB,GACjDoC,EAAI3E,KAAKsC,UAAW,OAAQtC,KAAKmC,sBAAsB,GACvDnC,KAAKkC,oBAAsB,KAC3B0C,EAAkB5E,KAAKc,SAC3B,CAKA+D,kBAAAA,GACI,GACI7E,KAAKC,SAASE,YAAc2E,GAC5B9E,KAAKC,SAASE,YAAc4E,GAC5B/E,KAAKC,SAASE,YAAc6E,EAE5B,OAAQhF,KAAKiF,kBACT,KAAKC,EACD,OAAO,EACX,KAAKC,EACD,OAAQnF,KAAKoF,SACjB,QACI,OAAO,EAInB,GAAIpF,KAAKC,SAASE,YAAckF,EAC5B,OAAQrF,KAAKsF,WACT,KAAKC,EACD,OAAO,EACX,KAAKC,EACD,OAAQxF,KAAKoF,SACjB,QACI,OAAO,EAKnB,OAAO,CACX,CAGAK,cAAAA,CAAeC,GAEX,OADA1F,KAAKkD,uBAAyBwC,EACvB1F,IACX,CAEA2F,YAAAA,CAAaD,GAET,OADA1F,KAAKgE,qBAAuB0B,EACrB1F,IACX,CAEA4F,YAAAA,CAAaF,GAET,OADA1F,KAAKyE,qBAAuBiB,EACrB1F,IACX,CAEA6F,QAAAA,CAASH,GAEL,OADA1F,KAAKiE,iBAAmByB,EACjB1F,IACX,CAEA8F,OAAAA,CAAQJ,GAEJ,OADA1F,KAAKkE,gBAAkBwB,EAChB1F,IACX,CAEA+F,UAAAA,CAAWL,GAEP,OADA1F,KAAKmE,mBAAqBuB,EACnB1F,IACX,CAEAgG,YAAAA,CAAaN,GAET,OADA1F,KAAKoE,qBAAuBsB,EACrB1F,IACX,CAEAiG,UAAAA,CAAWP,GAEP,OADA1F,KAAKqE,mBAAqBqB,EACnB1F,IACX,CAEAkG,cAAAA,CAAeR,GAEX,OADA1F,KAAKsE,uBAAyBoB,EACvB1F,IACX,CAEAmG,YAAAA,CAAaT,GAET,OADA1F,KAAKuE,qBAAuBmB,EACrB1F,IACX,CAKA,aAAI6B,GACA,OAAO7B,KAAKoG,UAChB,CACA,aAAIvE,CAAUwE,GACVrG,KAAKoG,WAAaC,CACtB,CAEA,YAAIjB,GACA,OAAOpF,KAAKsG,SAChB,CACA,YAAIlB,CAASiB,GACTrG,KAAKsG,UAAYD,CACrB,CAEA,WAAItC,GACA,GAAI/D,KAAKC,SAASE,YAAckF,EAC5B,OAAQrF,KAAKsF,WACT,KAAKC,EAED,OAAO,EACX,KAAKC,EAED,OAAQxF,KAAKoF,SACjB,QACI,OAAOpF,KAAKuG,SAIxB,GACIvG,KAAKC,SAASE,YAAc2E,GAC5B9E,KAAKC,SAASE,YAAc4E,GAC5B/E,KAAKC,SAASE,YAAc6E,EAE5B,OAAQhF,KAAKiF,kBACT,KAAKC,EAED,OAAO,EACX,KAAKC,EAED,OAAQnF,KAAKoF,SACjB,QACI,OAAOpF,KAAKuG,SAIxB,OAAOvG,KAAKuG,QAChB,CACA,WAAIxC,CAAQsC,GACRrG,KAAKuG,SAAWF,CACpB,CAEA,aAAIf,GACA,OAAOtF,KAAKwG,UAChB,CAEA,aAAIlB,CAAUe,GAENrG,KAAKC,SAASE,YAAckF,GAG5BgB,IAAUrG,KAAKsF,YAInBtF,KAAKwG,WAAaH,EAKdrG,KAAKoF,UAA+B,gBAAnBpF,KAAK6B,YACtB7B,KAAKoF,UAAW,GAExB,CAEA,oBAAIH,GACA,OAAOjF,KAAKyG,iBAChB,CAEA,oBAAIxB,CAAiBoB,GAGbrG,KAAKC,SAASE,YAAc2E,GAC5B9E,KAAKC,SAASE,YAAc4E,GAC5B/E,KAAKC,SAASE,YAAc6E,GAK5BqB,IAAUrG,KAAKiF,mBAInBjF,KAAKyG,kBAAoBJ,EAGrBrG,KAAKoF,UAA+B,gBAAnBpF,KAAK6B,YACtB7B,KAAKoF,UAAW,GAExB,CAEA,uBAAIlD,GACA,OAAOlC,KAAK0G,oBAChB,CACA,uBAAIxE,CAAoBmE,GACpBrG,KAAK0G,qBAAuBL,CAChC,CAEA,eAAIM,GACA,OAAO3G,KAAK4G,YAChB,CACA,eAAID,CAAYN,GACZrG,KAAK4G,aAAeP,CACxB,CAEA,UAAIxD,GACA,OAAO7C,KAAK6G,OAChB,CACA,UAAIhE,CAAOwD,GACPrG,KAAK6G,QAAUR,CACnB,CAGA,wBAAIlE,GACA,OAAOnC,KAAK8G,qBAChB,CACA,wBAAI3E,CAAqBkE,GACrBrG,KAAK8G,sBAAwBT,EAAMU,KAAK/G,KAC5C,CAEA,uBAAIuC,GACA,OAAOvC,KAAKgH,oBAChB,CACA,uBAAIzE,CAAoB8D,GACpBrG,KAAKgH,qBAAuBX,EAAMU,KAAK/G,KAC3C,CAngBA,WAAAiH,CAAYC,EAAoCxH,GAC5CyH,QAMA,MAMMC,EAAyBC,EANC,CAAC,iBAAkB,WAAY,YAAa,wBAAyB,iBAMhDC,KAAKJ,GAG1DlH,KAAKC,SAAW0C,EAAAC,EAAA,CAAA,EAETwE,GAAAA,CAEHhH,eAAgBwC,EAAA,GAAKwE,EAAuBhH,kBAMhD,MAAMT,UAAEA,EAASC,aAAEA,EAAYC,sBAAEA,GAA0BqH,EAkC3D,OA7BAlH,KAAKiD,eAAiBiE,EAAUjE,eAChCjD,KAAKc,SAAWoG,EAAUpG,SAC1Bd,KAAKiC,gBAAkBiF,EAAUjF,gBACjCjC,KAAKyB,cAAgByF,EAAUzF,cAK/BzB,KAAK+D,SAAU,EACf/D,KAAKkC,oBAAsB,KAC3BlC,KAAK6C,OAAS0E,IACdvH,KAAK2G,aAAc,EACnB3G,KAAKoF,UAAW,EAChBpF,KAAK6B,UAAY,GACjB7B,KAAKsF,UAAY4B,EAAU5B,UAC3BtF,KAAKiF,iBAAmBiC,EAAUjC,iBAc3BjF,KAAKP,KAAKC,EAAMC,EAAWC,EAAcC,EACpD"}