import{createElement as t,Fragment as e}from"../../../../../external/preact/dist/preact.js";import{useState as o,useEffect as r,useCallback as s}from"../../../../../external/preact/hooks/dist/hooks.js";import n from"../../context/useClickToPayContext.js";import a from"./CtPSingleCard/CtPSingleCard.js";import i from"../../../PayButton/PayButton.js";import{amountLabel as c}from"../../../PayButton/utils.js";import l from"./CtPCardsList/CtPCardsList.js";import m from"../../services/sdks/SrciError.js";import u from"../CtPSection/CtPSection.js";import{CTP_IFRAME_NAME as d}from"../../services/utils.js";import p from"../../../IFrame/Iframe.js";import f from"../../../../../core/Context/useImage.js";import{useCoreContext as C}from"../../../../../core/Context/CoreProvider.js";import g from"../../../../../utils/isMobile.js";import h from"../../../../../core/Errors/AdyenCheckoutError.js";import{PREFIX as y}from"../../../Icon/constants.js";import{useAmount as P}from"../../../../../core/Context/AmountProvider.js";function j(t,e){if(!t)return null;const o=e.get(`ctp.errors.${t}`);return o.includes("ctp.errors")?e.get("ctp.errors.UNKNOWN_ERROR"):o}function k(t,e,o){return o?g()?null:t.get("payButton.with",{values:{value:c(t,e),maskedData:`•••• ${null==o?void 0:o.panLastFour}`}}):t.get("payButton")}const v=({onDisplayCardComponent:c})=>{const{i18n:g}=C(),v=f(),{cards:E,checkout:S,isCtpPrimaryPaymentMethod:x,status:b,onSubmit:R,onSetStatus:$,onError:w}=n(),[B,M]=o(E.find(t=>!t.isExpired)||E[0]),[N,D]=o(null),F=E.every(t=>t.isExpired),[I,_]=o(!1),{amount:L}=P();r(()=>{(0===E.length||F)&&(null==c||c())},[c,F,E]);const O=s(async()=>{if(B)try{_(!0),D(null),$("loading");const t=await S(B);R(t)}catch(t){t instanceof m&&(D(null==t?void 0:t.reason),console.warn(`CtP - Checkout: Reason: ${null==t?void 0:t.reason} / Source: ${null==t?void 0:t.source} / Scheme: ${null==t?void 0:t.scheme}`)),_(!1),w(t instanceof h?t:new h("ERROR","Error during ClickToPay checkout",{cause:t}))}},[S,B]),T=s(t=>{M(t)},[]),A=I&&"loading"===b&&(null==B?void 0:B.isDcfPopupEmbedded),K="loading"!==b||!A,U=s(t=>{"Enter"===t.key&&O()},[O]);return t(e,null,t(p,{name:d,height:"380",width:"100%",classNameModifiers:[A?"":"hidden"]}),K&&t(e,null,t(u.Title,null,g.get("ctp.cards.title")),0===E.length&&t("div",{className:"adyen-checkout-ctp__empty-cards"},g.get("ctp.emptyProfile.message")),1===E.length&&t(a,{card:E[0],errorMessage:j(N,g)}),E.length>1&&t(l,{cardSelected:B,cards:E,onChangeCard:T,errorMessage:j(N,g)}),t(i,{disabled:F,label:k(g,L,B),status:b,variant:x?"primary":"secondary",icon:0!==E.length&&v({imageFolder:"components/"})(x?`${y}lock`:`${y}lock_black`),onClick:O,onKeyDown:U})))};export{v as default};
//# sourceMappingURL=CtPCards.js.map
