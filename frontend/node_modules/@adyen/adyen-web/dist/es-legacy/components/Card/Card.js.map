{"version":3,"file":"Card.js","sources":["../../../../src/components/Card/Card.tsx"],"sourcesContent":["import { h } from 'preact';\nimport CardInput from './components/CardInput';\nimport collectBrowserInfo from '../../utils/browserInfo';\nimport { BinLookupResponse, CardElementData, CardConfiguration } from './types';\nimport triggerBinLookUp from '../internal/SecuredFields/binLookup/triggerBinLookUp';\nimport { CardBinLookupData, CardConfigSuccessData, CardFocusData } from '../internal/SecuredFields/lib/types';\nimport { fieldTypeToSnakeCase } from '../internal/SecuredFields/utils';\nimport { reject } from '../../utils/commonUtils';\nimport { shouldIncludeInstallmentsInPaymentData } from './components/CardInput/utils';\nimport createClickToPayService from '../internal/ClickToPay/services/create-clicktopay-service';\nimport { ClickToPayCheckoutPayload, IClickToPayService } from '../internal/ClickToPay/services/types';\nimport ClickToPayWrapper from './components/ClickToPayWrapper';\nimport { ComponentFocusObject } from '../../types/global-types';\nimport { TxVariants } from '../tx-variants';\nimport type { UIElementStatus } from '../internal/UIElement/types';\nimport UIElement from '../internal/UIElement';\nimport PayButton from '../internal/PayButton';\nimport type { ICore } from '../../core/types';\nimport { ALL_SECURED_FIELDS } from '../internal/SecuredFields/lib/constants';\nimport AdyenCheckoutError, { IMPLEMENTATION_ERROR } from '../../core/Errors/AdyenCheckoutError';\nimport CardInputDefaultProps from './components/CardInput/defaultProps';\nimport { PayButtonProps } from '../internal/PayButton/PayButton';\nimport { AnalyticsInfoEvent, InfoEventType, UiTarget } from '../../core/Analytics/events/AnalyticsInfoEvent';\n\nexport class CardElement extends UIElement<CardConfiguration> {\n    public static type = TxVariants.scheme;\n\n    private readonly clickToPayService: IClickToPayService | null;\n\n    /**\n     * Reference to the 'ClickToPayComponent'\n     */\n    private clickToPayRef = null;\n\n    constructor(checkout: ICore, props?: CardConfiguration) {\n        super(checkout, props);\n\n        if (props && !props._disableClickToPay && this.props.fundingSource !== 'prepaid') {\n            this.clickToPayService = createClickToPayService(\n                this.props.configuration,\n                this.props.clickToPayConfiguration,\n                this.props.environment,\n                this.analytics\n            );\n\n            void this.clickToPayService?.initialize();\n        }\n    }\n\n    protected static defaultProps = {\n        showFormInstruction: true,\n        _disableClickToPay: false,\n        doBinLookup: true,\n        // Merge most of CardInput's defaultProps\n        ...reject(['type', 'setComponentRef']).from(CardInputDefaultProps)\n    };\n\n    public setStatus(status: UIElementStatus, props?): this {\n        if (this.componentRef?.setStatus) {\n            this.componentRef.setStatus(status, props);\n        }\n        if (this.clickToPayRef?.setStatus) {\n            this.clickToPayRef.setStatus(status, props);\n        }\n        return this;\n    }\n\n    private setClickToPayRef = ref => {\n        this.clickToPayRef = ref;\n    };\n\n    formatProps(props: CardConfiguration): CardConfiguration {\n        // The value from a session should be used, before falling back to the merchant configuration\n        const enableStoreDetails = props.session?.configuration?.enableStoreDetails ?? props.enableStoreDetails;\n\n        const isZeroAuth = props.amount?.value === 0;\n        const showStoreDetailsCheckbox = isZeroAuth ? false : enableStoreDetails;\n\n        const storedCardID = props.storedPaymentMethodId || props.id; // check if we've been passed a (checkout) processed storedCard or one that merchant has pulled from the PMs response\n        const isEcommerceStoredCard = storedCardID && props?.supportedShopperInteractions?.includes('Ecommerce'); // If we have a storedCard does it support Ecommerce (it might not if the merchant has pulled it from the PMs response)\n\n        // If we have a storedPM but it doesn't support Ecommerce - we can't make a storedCard component from it\n        if (storedCardID && !isEcommerceStoredCard) {\n            // TODO - Decide if an error is too severe? Would a console.warning suffice?\n            throw new AdyenCheckoutError(\n                IMPLEMENTATION_ERROR,\n                'You are trying to create a storedCard from a stored PM that does not support Ecommerce interactions'\n            );\n        }\n\n        return {\n            ...props,\n            // Mismatch between hasHolderName & holderNameRequired which can mean card can never be valid\n            holderNameRequired: !props.hasHolderName ? false : props.holderNameRequired,\n            // False for *stored* BCMC cards & if merchant explicitly wants to hide the CVC field\n            hasCVC: !((props.brand && props.brand === 'bcmc') || props.hideCVC),\n            // billingAddressRequired only available for non-stored cards\n            billingAddressRequired: props.storedPaymentMethodId ? false : props.billingAddressRequired,\n            // edge case where merchant has defined both an onAddressLookup callback AND set billingAddressMode: 'partial' - which leads to some strange behaviour in the address UI\n            billingAddressMode: props.onAddressLookup ? CardInputDefaultProps.billingAddressMode : props.billingAddressMode,\n            /** props.brand will be specified in the case of a StoredCard or a Bancontact component, for a regular Card we default it to 'card' */\n            brand: props.brand ?? TxVariants.card,\n            countryCode: props.countryCode ? props.countryCode.toLowerCase() : null,\n            // Required for transition period (until configuration object becomes the norm)\n            // - if merchant has defined value directly in props, use this instead\n            configuration: {\n                ...props.configuration,\n                socialSecurityNumberMode: props.configuration?.socialSecurityNumberMode ?? 'auto'\n            },\n            brandsConfiguration: props.brandsConfiguration || props.configuration?.brandsConfiguration || {},\n            icon: props.icon || props.configuration?.icon,\n            // installmentOptions of a session should be used before falling back to the merchant configuration\n            installmentOptions: props.session?.configuration?.installmentOptions || props.installmentOptions,\n            enableStoreDetails,\n            showStoreDetailsCheckbox,\n            /**\n             * Click to Pay configuration\n             * - If email is set explicitly in the configuration, then it can override the one used in the session creation\n             */\n            clickToPayConfiguration: {\n                ...props.clickToPayConfiguration,\n                disableOtpAutoFocus: props.clickToPayConfiguration?.disableOtpAutoFocus || false,\n                shopperEmail: props.clickToPayConfiguration?.shopperEmail || this.core.options?.session?.shopperEmail,\n                telephoneNumber: props.clickToPayConfiguration?.telephoneNumber || this.core.options?.session?.telephoneNumber,\n                locale: props.clickToPayConfiguration?.locale || props.i18n?.locale?.replace('-', '_')\n            },\n            ...(storedCardID && { storedPaymentMethodId: storedCardID })\n        };\n    }\n\n    /**\n     * Formats the component data output\n     */\n    formatData(): CardElementData {\n        /**\n         *  this.state.selectedBrandValue will be set when:\n         *  - /binLookup detects a single brand,\n         *  - when /binLookup detects a dual-branded card and the shopper makes a brand selection\n         *  - or, in the case of a storedCard\n         */\n        const cardBrand = this.state.selectedBrandValue;\n\n        return {\n            paymentMethod: {\n                type: CardElement.type,\n                ...this.state.data,\n                ...(this.props.storedPaymentMethodId && {\n                    storedPaymentMethodId: this.props.storedPaymentMethodId,\n                    holderName: this.props.holderName ?? ''\n                }),\n                ...(cardBrand && { brand: cardBrand }),\n                ...(this.props.fundingSource && { fundingSource: this.props.fundingSource }),\n                ...(this.state.fastlaneData && { fastlaneData: btoa(JSON.stringify(this.state.fastlaneData)) })\n            },\n            ...(this.state.billingAddress && { billingAddress: this.state.billingAddress }),\n            ...(this.state.socialSecurityNumber && { socialSecurityNumber: this.state.socialSecurityNumber }),\n            ...this.storePaymentMethodPayload,\n            ...(shouldIncludeInstallmentsInPaymentData(this.state.installments) && { installments: this.state.installments }),\n            browserInfo: this.browserInfo,\n            origin: !!window && window.location.origin\n        };\n    }\n\n    protected override beforeRender(configSetByMerchant?: CardConfiguration): void {\n        // We don't send 'rendered' events when rendering actions\n        if (configSetByMerchant?.originalAction) {\n            return;\n        }\n\n        const event = new AnalyticsInfoEvent({\n            type: InfoEventType.rendered,\n            component: this.type,\n            configData: { ...configSetByMerchant, showPayButton: this.props.showPayButton },\n            ...(configSetByMerchant?.oneClick && {\n                isStoredPaymentMethod: true,\n                brand: configSetByMerchant.brand\n            })\n        });\n\n        this.analytics.sendAnalytics(event);\n    }\n\n    updateStyles(stylesObj) {\n        if (this.componentRef?.updateStyles) this.componentRef.updateStyles(stylesObj);\n        return this;\n    }\n\n    setFocusOn(fieldName) {\n        if (this.componentRef?.setFocusOn) this.componentRef.setFocusOn(fieldName);\n        return this;\n    }\n\n    public onBrand = event => {\n        this.props.onBrand?.(event);\n    };\n\n    processBinLookupResponse(binLookupResponse: BinLookupResponse, isReset = false) {\n        if (this.componentRef?.processBinLookupResponse) this.componentRef.processBinLookupResponse(binLookupResponse, isReset);\n        return this;\n    }\n\n    handleUnsupportedCard(errObj) {\n        if (this.componentRef?.handleUnsupportedCard) this.componentRef.handleUnsupportedCard(errObj);\n        return this;\n    }\n\n    private handleClickToPaySubmit = (payload: ClickToPayCheckoutPayload) => {\n        this.setState({ data: { ...payload }, valid: {}, errors: {}, isValid: true });\n        this.submit();\n    };\n\n    onBinLookup(obj: CardBinLookupData) {\n        // Handler for regular card comp doesn't need this 'raw' data or to know about 'resets'\n        if (!obj.isReset) {\n            const nuObj = reject('supportedBrandsRaw').from(obj);\n            this.props.onBinLookup?.(nuObj);\n        }\n    }\n\n    private onConfigSuccess = (obj: CardConfigSuccessData) => {\n        const event = new AnalyticsInfoEvent({ component: this.type, type: InfoEventType.configured });\n        this.submitAnalytics(event);\n\n        this.props.onConfigSuccess?.(obj);\n    };\n\n    private onFocus = (obj: ComponentFocusObject) => {\n        const event = new AnalyticsInfoEvent({\n            component: this.type,\n            type: InfoEventType.focus,\n            target: fieldTypeToSnakeCase(obj.fieldType) as UiTarget\n        });\n        this.submitAnalytics(event);\n\n        // Call merchant defined callback\n        if (ALL_SECURED_FIELDS.includes(obj.fieldType)) {\n            this.props.onFocus?.(obj.event as CardFocusData);\n        } else {\n            this.props.onFocus?.(obj);\n        }\n    };\n\n    private onBlur = (obj: ComponentFocusObject) => {\n        const event = new AnalyticsInfoEvent({\n            component: this.type,\n            type: InfoEventType.unfocus,\n            target: fieldTypeToSnakeCase(obj.fieldType) as UiTarget\n        });\n        this.submitAnalytics(event);\n\n        // Call merchant defined callback\n        if (ALL_SECURED_FIELDS.includes(obj.fieldType)) {\n            this.props.onBlur?.(obj.event as CardFocusData);\n        } else {\n            this.props.onBlur?.(obj);\n        }\n    };\n\n    public onBinValue = triggerBinLookUp(this);\n\n    get storePaymentMethodPayload() {\n        const isStoredCard = this.props.storedPaymentMethodId?.length > 0;\n        if (isStoredCard) {\n            return {};\n        }\n\n        /**\n         * For regular card, zero auth payments, we store the payment method, *if* the configuration says we should:\n         *  - For sessions, this means if the session has been created with storePaymentMethodMode: 'askForConsent'\n         *  - For the advanced flow, this means if the merchant has still set enableStoreDetails: true\n         *\n         * What we are doing is.. if for a normal payment we would show the \"Save for my next payment\" checkbox,\n         * for a zero-auth payment we effectively click the checkbox on behalf of the shopper.\n         */\n        const isZeroAuth = this.props.amount?.value === 0;\n        if (isZeroAuth) {\n            return this.props.enableStoreDetails ? { storePaymentMethod: true } : {};\n        }\n\n        // For regular card, non-zero auth payments, we store the payment method based on the checkbox value.\n        const includeStorePaymentMethod = this.props.showStoreDetailsCheckbox && typeof this.state.storePaymentMethod !== 'undefined';\n        return includeStorePaymentMethod ? { storePaymentMethod: Boolean(this.state.storePaymentMethod) } : {};\n    }\n\n    get isValid() {\n        return !!this.state.isValid;\n    }\n\n    get icon() {\n        return this.props.icon ?? this.resources.getImage()(this.props.brand);\n    }\n\n    get brands(): { icon: any; name: string }[] {\n        const { brands, brandsConfiguration } = this.props;\n        if (brands) {\n            return brands.map(brand => {\n                const brandIcon = brandsConfiguration[brand]?.icon ?? this.props.modules.resources.getImage()(brand);\n                return { icon: brandIcon, name: brand };\n            });\n        }\n\n        return [];\n    }\n\n    get displayName(): string {\n        if (this.props.storedPaymentMethodId) {\n            return `•••• ${this.props.lastFour}`;\n        }\n\n        return this.props.name || CardElement.type;\n    }\n\n    get accessibleName(): string {\n        // Use display name, unless it's a stored payment method, there inform user\n        return (\n            (this.props.name || CardElement.type) +\n            (this.props.storedPaymentMethodId\n                ? ' ' + this.props.i18n.get('creditCard.storedCard.description.ariaLabel').replace('%@', this.props.lastFour)\n                : '')\n        );\n    }\n\n    get browserInfo() {\n        return collectBrowserInfo();\n    }\n\n    protected override payButton = (props: PayButtonProps): h.JSX.Element => {\n        const isZeroAuth = this.props.amount?.value === 0;\n        const isStoredCard = this.props.storedPaymentMethodId?.length > 0;\n        return <PayButton {...props} label={isZeroAuth && !isStoredCard ? this.props.i18n.get('payButton.saveDetails') : ''} onClick={this.submit} />;\n    };\n\n    private renderCardInput(isCardPrimaryInput = true): h.JSX.Element {\n        return (\n            <CardInput\n                setComponentRef={this.setComponentRef}\n                {...this.props}\n                {...this.state}\n                onSubmitAnalytics={this.submitAnalytics}\n                onChange={this.setState}\n                onSubmit={this.submit}\n                handleKeyPress={this.handleKeyPress}\n                payButton={this.payButton}\n                onBrand={this.onBrand}\n                onBinValue={this.onBinValue}\n                brand={this.props.brand}\n                brandsIcons={this.brands}\n                isPayButtonPrimaryVariant={isCardPrimaryInput}\n                resources={this.resources}\n                onFocus={this.onFocus}\n                onBlur={this.onBlur}\n                onConfigSuccess={this.onConfigSuccess}\n            />\n        );\n    }\n\n    protected override componentToRender(): h.JSX.Element {\n        return (\n            <ClickToPayWrapper\n                configuration={this.props.clickToPayConfiguration}\n                clickToPayService={this.clickToPayService}\n                isStandaloneComponent={false}\n                setClickToPayRef={this.setClickToPayRef}\n                onSetStatus={this.setElementStatus}\n                onSubmit={this.handleClickToPaySubmit}\n                onError={this.handleError}\n            >\n                {isCardPrimaryInput => this.renderCardInput(isCardPrimaryInput)}\n            </ClickToPayWrapper>\n        );\n    }\n}\n\nexport default CardElement;\n"],"names":["CardElement","UIElement","setStatus","status","props","_this_componentRef","_this_clickToPayRef","this","componentRef","clickToPayRef","formatProps","_this_core_options_session","_this_core_options","_this_core_options_session1","_this_core_options1","enableStoreDetails","session","configuration","_ref","showStoreDetailsCheckbox","amount","value","storedCardID","storedPaymentMethodId","id","isEcommerceStoredCard","supportedShopperInteractions","includes","AdyenCheckoutError","IMPLEMENTATION_ERROR","_object_spread","_object_spread_props","holderNameRequired","hasHolderName","hasCVC","brand","hideCVC","billingAddressRequired","billingAddressMode","onAddressLookup","CardInputDefaultProps","TxVariants","card","countryCode","toLowerCase","socialSecurityNumberMode","_ref1","brandsConfiguration","icon","installmentOptions","clickToPayConfiguration","disableOtpAutoFocus","shopperEmail","core","options","telephoneNumber","locale","i18n","replace","formatData","_this_props_holderName","cardBrand","state","selectedBrandValue","paymentMethod","type","data","holderName","fundingSource","fastlaneData","btoa","JSON","stringify","billingAddress","socialSecurityNumber","storePaymentMethodPayload","shouldIncludeInstallmentsInPaymentData","installments","browserInfo","origin","window","location","beforeRender","configSetByMerchant","originalAction","event","AnalyticsInfoEvent","InfoEventType","rendered","component","configData","showPayButton","oneClick","isStoredPaymentMethod","analytics","sendAnalytics","updateStyles","stylesObj","setFocusOn","fieldName","processBinLookupResponse","binLookupResponse","isReset","handleUnsupportedCard","errObj","onBinLookup","obj","_this_props_onBinLookup","_this_props","nuObj","reject","from","call","_this_props_storedPaymentMethodId","_this_props_amount","length","storePaymentMethod","Boolean","isValid","_this_props_icon","resources","getImage","brands","map","modules","name","displayName","lastFour","accessibleName","get","collectBrowserInfo","renderCardInput","isCardPrimaryInput","h","CardInput","setComponentRef","onSubmitAnalytics","submitAnalytics","onChange","setState","onSubmit","submit","handleKeyPress","payButton","onBrand","onBinValue","brandsIcons","isPayButtonPrimaryVariant","onFocus","onBlur","onConfigSuccess","componentToRender","ClickToPayWrapper","clickToPayService","isStandaloneComponent","setClickToPayRef","onSetStatus","setElementStatus","handleClickToPaySubmit","onError","handleError","constructor","checkout","_this_clickToPayService","super","_define_property","ref","_this_props_onBrand","payload","valid","errors","_this_props_onConfigSuccess","configured","focus","target","fieldTypeToSnakeCase","fieldType","_this_props_onFocus","_this_props_onFocus1","_this_props1","ALL_SECURED_FIELDS","unfocus","_this_props_onBlur","_this_props_onBlur1","triggerBinLookUp","isZeroAuth","isStoredCard","PayButton","label","onClick","_disableClickToPay","createClickToPayService","environment","initialize","scheme","defaultProps","showFormInstruction","doBinLookup"],"mappings":"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"}