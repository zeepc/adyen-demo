{"version":3,"file":"CardInput.js","sources":["../../../../../../src/components/Card/components/CardInput/CardInput.tsx"],"sourcesContent":["import { h, Fragment } from 'preact';\nimport { useState, useEffect, useRef, useMemo, useCallback } from 'preact/hooks';\nimport SecuredFieldsProvider from '../../../internal/SecuredFields/SFP/SecuredFieldsProvider';\nimport { OnChangeEventDetails, SFPState } from '../../../internal/SecuredFields/SFP/types';\nimport defaultProps from './defaultProps';\nimport './CardInput.scss';\nimport { AddressModeOptions, CardInputDataState, CardInputErrorState, CardInputProps, CardInputRef, CardInputValidState } from './types';\nimport { CVC_POLICY_REQUIRED, DATE_POLICY_REQUIRED, ENCRYPTED_CARD_NUMBER } from '../../../internal/SecuredFields/lib/constants';\nimport { BinLookupResponse } from '../../types';\nimport { cardInputFormatters, cardInputValidationRules, getRuleByNameAndMode } from './validate';\nimport CIExtensions from '../../../internal/SecuredFields/binLookup/extensions';\nimport useForm from '../../../../utils/useForm';\nimport { SortedErrorObject } from '../../../../core/Errors/types';\nimport { handlePartialAddressMode, extractPropsForCardFields, extractPropsForSFP, getLayout } from './utils';\nimport Specifications from '../../../internal/Address/Specifications';\nimport { StoredCardFieldsWrapper } from './components/StoredCardFieldsWrapper';\nimport { CardFieldsWrapper } from './components/CardFieldsWrapper';\nimport { getAddressHandler, getAutoJumpHandler, getFocusHandler } from './handlers';\nimport { InstallmentsState } from './components/Installments/Installments';\nimport { TouchStartEventObj } from './components/types';\nimport classNames from 'classnames';\nimport { getPartialAddressValidationRules } from '../../../internal/Address/validate';\nimport useImage from '../../../../core/Context/useImage';\nimport { getArrayDifferences } from '../../../../utils/arrayUtils';\nimport FormInstruction from '../../../internal/FormInstruction';\nimport { AddressData } from '../../../../types/global-types';\nimport { CardBrandData, CardFocusData } from '../../../internal/SecuredFields/lib/types';\nimport { PREFIX } from '../../../internal/Icon/constants';\nimport useSRPanelForCardInputErrors from './useSRPanelForCardInputErrors';\nimport FastlaneSignup from '../Fastlane/FastlaneSignup';\nimport { fieldTypeToSnakeCase } from '../../../internal/SecuredFields/utils';\nimport { getErrorMessageFromCode } from '../../../../core/Errors/utils';\nimport { SF_ErrorCodes } from '../../../../core/Errors/constants';\nimport { usePrevious } from '../../../../utils/hookUtils';\nimport { AnalyticsInfoEvent, InfoEventType, UiTarget } from '../../../../core/Analytics/events/AnalyticsInfoEvent';\n\nconst CardInput = (props: CardInputProps) => {\n    const sfp = useRef<SecuredFieldsProvider>(null);\n    const isValidating = useRef(false);\n    const getImage = useImage();\n\n    const billingAddressRef = useRef(null);\n    const setAddressRef = ref => {\n        billingAddressRef.current = ref;\n    };\n\n    const cardInputRef = useRef<CardInputRef>({});\n    // Just call once to create the object by which we expose the members expected by the parent Card comp\n    if (!Object.keys(cardInputRef.current).length) {\n        props.setComponentRef(cardInputRef.current);\n    }\n\n    const hasPanLengthRef = useRef(0);\n    const isAutoJumping = useRef(false);\n\n    const specifications = useMemo(() => new Specifications(props.specifications), [props.specifications]);\n\n    // Store ref to sfp (useful for 'deep' debugging)\n    cardInputRef.current.sfp = sfp;\n\n    /**\n     * STATE HOOKS\n     */\n    const [status, setStatus] = useState('ready');\n\n    const [errors, setErrors] = useState<CardInputErrorState>({});\n    const [valid, setValid] = useState<CardInputValidState>({\n        ...(props.holderNameRequired && { holderName: false })\n    });\n    const [data, setData] = useState<CardInputDataState>({\n        ...(props.hasHolderName && { holderName: props.data.holderName ?? '' })\n    });\n\n    const [focusedElement, setFocusedElement] = useState('');\n    const [isSfpValid, setIsSfpValid] = useState(false);\n    const [expiryDatePolicy, setExpiryDatePolicy] = useState(DATE_POLICY_REQUIRED);\n    const [cvcPolicy, setCvcPolicy] = useState(CVC_POLICY_REQUIRED);\n    const [issuingCountryCode, setIssuingCountryCode] = useState<string>(null);\n\n    const [dualBrandSelectElements, setDualBrandSelectElements] = useState([]);\n    const [selectedBrandValue, setSelectedBrandValue] = useState(props.storedPaymentMethodId ? props.brand : ''); // If this is a storedCard comp initialise state with the storedCard's brand\n\n    const showBillingAddress = props.billingAddressMode !== AddressModeOptions.none && props.billingAddressRequired;\n\n    const partialAddressSchema = handlePartialAddressMode(props.billingAddressMode);\n    // Keeps the value of the country set initially by the merchant, before the Address Component mutates it\n    const partialAddressCountry = useRef<string>(partialAddressSchema && props.data?.billingAddress?.country);\n\n    const [storePaymentMethod, setStorePaymentMethod] = useState(false);\n    const [billingAddress, setBillingAddress] = useState<AddressData>(showBillingAddress ? props.data.billingAddress : null);\n    const [showSocialSecurityNumber, setShowSocialSecurityNumber] = useState(false);\n    const [socialSecurityNumber, setSocialSecurityNumber] = useState('');\n    const [installments, setInstallments] = useState<InstallmentsState>({ value: null });\n\n    // re. Disable arrows for iOS: The name of the element calling for other elements to be disabled\n    // - either a securedField type (like 'encryptedCardNumber') when call is coming from SF\n    // or else the name of an internal, Adyen-web, element (like 'holderName')\n    const [iOSFocusedField, setIOSFocusedField] = useState(null);\n\n    /**\n     * This stores the brand as detected by the internal regEx.\n     * It eventually gets overwritten by the brand as detected by the /binLookup, but will revert back to the regEx detection\n     * if the PAN length drops below the /binLookup digit threshold.\n     * Default value, 'card', indicates no brand detected\n     */\n    const [internallyDetectedBrand, setInternallyDetectedBrand] = useState('card');\n\n    /**\n     * Used tho show and hide the pay button and instructions text\n     * Should mimic the same logic as CardInput loading wrapper\n     */\n    const [showCardUIElements, setShowCardUIElements] = useState(false);\n\n    /**\n     * LOCAL VARS\n     */\n    const {\n        handleChangeFor,\n        triggerValidation,\n        data: formData,\n        valid: formValid,\n        errors: formErrors,\n        setSchema,\n        setData: setFormData,\n        setValid: setFormValid,\n        setErrors: setFormErrors\n    } = useForm<CardInputDataState>({\n        schema: [],\n        defaultData: props.data,\n        formatters: cardInputFormatters,\n        rules: cardInputValidationRules\n    });\n\n    const hasInstallments = !!Object.keys(props.installmentOptions).length && (!props.fundingSource || props.fundingSource === 'credit');\n    const showAmountsInInstallments = props.showInstallmentAmounts ?? true;\n\n    const cardCountryCode: string = issuingCountryCode ?? props.countryCode;\n    const isKorea = cardCountryCode === 'kr'; // If issuingCountryCode or the merchant defined countryCode is set to 'kr'\n    const showKCP = props.configuration.koreanAuthenticationRequired && isKorea;\n\n    const showBrazilianSSN: boolean =\n        (showSocialSecurityNumber && props.configuration.socialSecurityNumberMode === 'auto') ||\n        props.configuration.socialSecurityNumberMode === 'show';\n\n    /**\n     * HANDLERS\n     */\n    // Handlers for focus & blur on all fields. Can be renamed to onFieldFocus once the onFocusField is renamed in Field.tsx\n    const onFieldFocusAnalytics = (who: string, e: Event | CardFocusData) => {\n        props.onFocus({ fieldType: who, event: e });\n    };\n    const onFieldBlurAnalytics = (who: string, e: Event | CardFocusData) => {\n        props.onBlur({ fieldType: who, event: e });\n    };\n\n    const onBrand = useCallback((obj: CardBrandData) => {\n        setInternallyDetectedBrand(obj.brand);\n        props.onBrand(obj);\n    }, []);\n\n    // Make SecuredFields aware of the focus & blur handlers\n    const handleFocus = getFocusHandler(setFocusedElement, onFieldFocusAnalytics, onFieldBlurAnalytics);\n\n    const retrieveLayout = (): string[] => {\n        return getLayout({\n            props,\n            showKCP,\n            showBrazilianSSN,\n            ...(props.billingAddressRequired && {\n                countrySpecificSchemas: specifications.getAddressSchemaForCountry(billingAddress?.country),\n                billingAddressRequiredFields: props.billingAddressRequiredFields\n            })\n        });\n    };\n\n    /**\n     * re. Disabling arrow keys in iOS:\n     * Only by disabling all fields in the Card PM except for the active securedField input can we force the iOS soft keyboard arrow keys to disable\n     *\n     * NOTE: only called if ua.__IS_IOS = true && this.config.disableIOSArrowKeys = true (as referenced in CSF)\n     *\n     * @param obj - has fieldType prop saying whether this function is being called in response to an securedFields click ('encryptedCardNumber' etc)\n     * - in which case we should disable all non-SF fields\n     * or,\n     * due to an internal action ('webInternalElement') - in which case we can enable all non-SF fields\n     */\n    const handleTouchstartIOS = useCallback((obj: TouchStartEventObj) => {\n        const elementType = obj.fieldType !== 'webInternalElement' ? obj.fieldType : obj.name;\n        setIOSFocusedField(elementType);\n    }, []);\n\n    const handleAddress = getAddressHandler(setFormData, setFormValid, setFormErrors);\n\n    const doPanAutoJump = getAutoJumpHandler(isAutoJumping, sfp, retrieveLayout());\n\n    const handleSecuredFieldsChange = (sfState: SFPState, eventDetails?: OnChangeEventDetails): void => {\n        /**\n         * Handling auto complete value for holderName (but only if the component is using a holderName field)\n         */\n        if (sfState.autoCompleteName) {\n            if (!props.hasHolderName) return;\n            const holderNameValidationFn = getRuleByNameAndMode('holderName', 'blur');\n            const acHolderName = holderNameValidationFn(sfState.autoCompleteName) ? sfState.autoCompleteName : null;\n            if (acHolderName) {\n                setFormData('holderName', acHolderName);\n                setFormValid('holderName', true); // only if holderName is valid does this fny get called - so we know it's valid and w/o error\n                setFormErrors('holderName', null);\n            }\n            return;\n        }\n\n        /**\n         * Decide if we can shift focus to the expiryDate field.\n         *\n         * We can if... the config prop, autoFocus, is true AND we have a panLength value from binLookup\n         * AND we are responding to a handleOnFieldValid message about the PAN that says it is valid\n         */\n        if (\n            props.autoFocus &&\n            hasPanLengthRef.current > 0 &&\n            eventDetails?.event === 'handleOnFieldValid' &&\n            eventDetails?.fieldType === ENCRYPTED_CARD_NUMBER &&\n            sfState.valid.encryptedCardNumber\n        ) {\n            doPanAutoJump();\n        }\n\n        /**\n         * Process SFP state\n         */\n        setData({ ...data, ...sfState.data });\n        setErrors({ ...errors, ...sfState.errors });\n        setValid({ ...valid, ...sfState.valid });\n\n        setIsSfpValid(sfState.isSfpValid);\n\n        // Values relating to /binLookup response\n        setCvcPolicy(sfState.cvcPolicy);\n        setShowSocialSecurityNumber(sfState.showSocialSecurityNumber);\n        setExpiryDatePolicy(sfState.expiryDatePolicy);\n    };\n\n    /**\n     * Listen to the full SecureFieldsProvider state and handle actions\n     * Used right now to mimic the loading status changes, this can only be done this way\n     * Trying to do it via onConfiguSuccess or onChange has side effects\n     */\n    const handleSFPStateUpdate = useCallback(\n        sfpState => {\n            mimicLoadingStatusChange(sfpState);\n        },\n        [showCardUIElements, setShowCardUIElements]\n    );\n\n    /**\n     * This function implements the same logic that LoadingProvider uses to show and hide elements\n     * We want to mimic this behavior so we can hide and show the pay button or the instructions text\n     * Deciding to do it this way since we garante there's no DOM changes to merchants\n     * We can break this in the next major version (v7)\n     */\n    const mimicLoadingStatusChange = sfpState => {\n        if (!sfpState.status) return;\n        if (sfpState.status == 'loading') {\n            setShowCardUIElements(false);\n        } else {\n            setShowCardUIElements(true);\n        }\n    };\n\n    // Farm the handlers for binLookup related functionality out to another 'extensions' file\n    const extensions = useMemo(\n        () =>\n            CIExtensions(\n                props,\n                { sfp },\n                {\n                    dualBrandSelectElements,\n                    setDualBrandSelectElements,\n                    setSelectedBrandValue,\n                    issuingCountryCode,\n                    setIssuingCountryCode\n                },\n                hasPanLengthRef\n            ),\n        [dualBrandSelectElements, issuingCountryCode]\n    );\n\n    /**\n     * EXPOSE METHODS expected by Card.tsx\n     */\n    cardInputRef.current.showValidation = () => {\n        // set flag\n        isValidating.current = true;\n\n        /**\n         * Clear errors prior to validating so that the screenreader will read them *all* again, and in the right order\n         * - only using aria-atomic on the error panel will read them in the wrong order\n         */\n        clearSRPanel?.(); // TODO - recheck if this is still true\n\n        // Validate SecuredFields\n        sfp.current.showValidation();\n\n        // Validate holderName & SSN & KCP (taxNumber) but *not* billingAddress\n        triggerValidation(['holderName', 'socialSecurityNumber', 'taxNumber']);\n\n        // Validate Address\n        if (billingAddressRef?.current) billingAddressRef.current.showValidation();\n    };\n\n    cardInputRef.current.processBinLookupResponse = (binLookupResponse: BinLookupResponse, isReset: boolean) => {\n        extensions.processBinLookup(binLookupResponse, isReset);\n    };\n\n    cardInputRef.current.setStatus = setStatus;\n\n    /**\n     * EFFECT HOOKS\n     */\n    useEffect(() => {\n        // componentDidMount - expose more methods expected by Card.tsx\n        cardInputRef.current.setFocusOn = sfp.current.setFocusOn;\n        cardInputRef.current.updateStyles = sfp.current.updateStyles;\n        cardInputRef.current.handleUnsupportedCard = sfp.current.handleUnsupportedCard;\n\n        // componentWillUnmount\n        return () => {\n            sfp.current.destroy();\n        };\n    }, []);\n\n    /**\n     * Handle form schema updates\n     */\n    useEffect(() => {\n        const newSchema = [\n            ...(props.hasHolderName ? ['holderName'] : []),\n            ...(showBrazilianSSN ? ['socialSecurityNumber'] : []),\n            ...(showKCP ? ['taxNumber'] : []),\n            ...(showBillingAddress ? ['billingAddress'] : [])\n        ];\n        setSchema(newSchema);\n    }, [props.hasHolderName, showBrazilianSSN, showKCP]);\n\n    /**\n     * Handle updates from useForm\n     */\n    useEffect(() => {\n        setData({ ...data, holderName: formData.holderName ?? '', taxNumber: formData.taxNumber });\n\n        setSocialSecurityNumber(formData.socialSecurityNumber);\n\n        if (showBillingAddress) setBillingAddress({ ...formData.billingAddress });\n\n        setValid({\n            ...valid,\n            holderName: props.holderNameRequired ? formValid.holderName : true,\n            // Setting value to false if it's falsy keeps in line with existing, expected behaviour\n            // - but there is an argument to allow 'undefined' as a value to indicate the non-presence of the field\n            socialSecurityNumber: formValid.socialSecurityNumber ? formValid.socialSecurityNumber : false,\n            taxNumber: formValid.taxNumber ? formValid.taxNumber : false,\n            billingAddress: formValid.billingAddress ? formValid.billingAddress : false\n        });\n\n        // Check if billingAddress errors object has any properties that aren't null or undefined\n        const addressHasErrors = formErrors.billingAddress\n            ? Object.entries(formErrors.billingAddress).reduce((acc, [, error]) => acc || error != null, false)\n            : false;\n\n        // Errors\n        setErrors({\n            ...errors,\n            holderName: props.holderNameRequired && !!formErrors.holderName ? formErrors.holderName : null,\n            socialSecurityNumber: showBrazilianSSN && !!formErrors.socialSecurityNumber ? formErrors.socialSecurityNumber : null,\n            taxNumber: showKCP && !!formErrors.taxNumber ? formErrors.taxNumber : null,\n            billingAddress: showBillingAddress && addressHasErrors ? formErrors.billingAddress : null\n        });\n    }, [formData, formValid, formErrors]);\n\n    // Use the custom hook to set (or clear) errors in the SRPanel\n    const {\n        sortedErrorList: currentErrorsSortedByLayout,\n        previousSortedErrors,\n        clearSRPanel\n    } = useSRPanelForCardInputErrors({\n        errors,\n        props,\n        isValidating,\n        retrieveLayout,\n        specifications,\n        billingAddress,\n        sfp\n    });\n\n    // Analytics: ValidationErrors\n    useEffect(() => {\n        if (currentErrorsSortedByLayout) {\n            const newErrors = getArrayDifferences<SortedErrorObject, string>(currentErrorsSortedByLayout, previousSortedErrors, 'field');\n\n            newErrors?.forEach(errorItem => {\n                const event = new AnalyticsInfoEvent({\n                    component: props.type,\n                    type: InfoEventType.validationError,\n                    target: fieldTypeToSnakeCase(errorItem.field) as UiTarget,\n                    validationErrorCode: errorItem.errorCode,\n                    validationErrorMessage: getErrorMessageFromCode(errorItem.errorCode, SF_ErrorCodes)\n                });\n                props.onSubmitAnalytics(event);\n            });\n        }\n    }, [currentErrorsSortedByLayout]);\n\n    /**\n     * Main 'componentDidUpdate' handler\n     */\n    useEffect(() => {\n        const holderNameValid: boolean = valid.holderName;\n\n        const sfpValid: boolean = isSfpValid;\n        const addressValid: boolean = showBillingAddress ? valid.billingAddress : true;\n\n        const koreanAuthentication: boolean = showKCP ? !!valid.taxNumber && !!valid.encryptedPassword : true;\n\n        const socialSecurityNumberValid: boolean = showBrazilianSSN ? !!valid.socialSecurityNumber : true;\n\n        const isValid: boolean = sfpValid && holderNameValid && addressValid && koreanAuthentication && socialSecurityNumberValid;\n\n        const sfStateErrorsObj = sfp.current.mapErrorsToValidationRuleResult();\n        const mergedErrors = { ...errors, ...sfStateErrorsObj }; // maps sfErrors AND solves race condition problems for sfp from showValidation\n\n        props.onChange({\n            data,\n            valid,\n            errors: mergedErrors,\n            isValid,\n            billingAddress,\n            selectedBrandValue,\n            storePaymentMethod,\n            socialSecurityNumber,\n            installments\n        });\n    }, [data, valid, errors, selectedBrandValue, storePaymentMethod, installments]);\n\n    /**\n     * \"Update\" handler related to dual brand buttons being initially displayed\n     */\n    useEffect(() => {\n        if (dualBrandSelectElements.length > 0 && dualBrandSelectElements) {\n            const dualBrandsArr = dualBrandSelectElements.map(item => item.id);\n            const brand = dualBrandsArr[0]; // initially selected brand\n            const dualBrands = dualBrandsArr.toString();\n\n            const event = new AnalyticsInfoEvent({\n                component: props.type,\n                type: InfoEventType.displayed,\n                target: UiTarget.dualBrandButton,\n                brand,\n                configData: { dualBrands }\n            });\n\n            props.onSubmitAnalytics(event);\n        }\n    }, [dualBrandSelectElements]);\n\n    const previousSelectedBrandValue = usePrevious(selectedBrandValue);\n\n    /**\n     * \"Update\" handler related to a dual brand button being selected\n     */\n    useEffect(() => {\n        if (previousSelectedBrandValue?.length && selectedBrandValue?.length) {\n            const event = new AnalyticsInfoEvent({\n                component: props.type,\n                type: InfoEventType.selected,\n                target: UiTarget.dualBrandButton,\n                brand: selectedBrandValue\n            });\n\n            props.onSubmitAnalytics(event);\n        }\n    }, [selectedBrandValue]);\n\n    /**\n     * RENDER\n     */\n    const FieldToRender = props.storedPaymentMethodId ? StoredCardFieldsWrapper : CardFieldsWrapper;\n\n    return (\n        <Fragment>\n            <SecuredFieldsProvider\n                ref={sfp}\n                {...extractPropsForSFP(props)}\n                styles={{ ...props.styles }}\n                koreanAuthenticationRequired={props.configuration.koreanAuthenticationRequired}\n                hasKoreanFields={!!(props.configuration.koreanAuthenticationRequired && props.countryCode === 'kr')}\n                onSubmitAnalytics={props.onSubmitAnalytics}\n                onChange={handleSecuredFieldsChange}\n                onBrand={onBrand}\n                onFocus={handleFocus}\n                onStateUpdate={handleSFPStateUpdate}\n                type={props.brand}\n                componentType={props.type}\n                disableIOSArrowKeys={props.disableIOSArrowKeys ? handleTouchstartIOS : null}\n                render={({ setRootNode, setFocusOn }, sfpState) => (\n                    <div\n                        ref={setRootNode}\n                        className={classNames({\n                            'adyen-checkout__card-input': true,\n                            'adyen-checkout-card-input__wrapper': true,\n                            [`adyen-checkout__card-input--${props.fundingSource ?? 'credit'}`]: true,\n                            'adyen-checkout__card-input--loading': status === 'loading'\n                        })}\n                        role={'form'}\n                    >\n                        {showCardUIElements && <FormInstruction />}\n\n                        <FieldToRender\n                            // Extract exact props that we need to pass down\n                            {...extractPropsForCardFields(props)}\n                            // Pass on vars created in CardInput:\n                            // Base (shared w. StoredCard)\n                            data={data}\n                            valid={valid}\n                            errors={errors}\n                            handleChangeFor={handleChangeFor}\n                            focusedElement={focusedElement}\n                            setFocusOn={setFocusOn}\n                            sfpState={sfpState}\n                            cvcPolicy={cvcPolicy}\n                            hasInstallments={hasInstallments}\n                            showAmountsInInstallments={showAmountsInInstallments}\n                            handleInstallments={setInstallments}\n                            // For Card\n                            brandsIcons={props.brandsIcons}\n                            formData={formData}\n                            formErrors={formErrors}\n                            formValid={formValid}\n                            expiryDatePolicy={expiryDatePolicy}\n                            dualBrandSelectElements={dualBrandSelectElements}\n                            extensions={extensions}\n                            selectedBrandValue={selectedBrandValue}\n                            // For KCP\n                            showKCP={showKCP}\n                            // For SSN\n                            showBrazilianSSN={showBrazilianSSN}\n                            socialSecurityNumber={socialSecurityNumber}\n                            // For Store details\n                            handleOnStoreDetails={setStorePaymentMethod}\n                            // For Address\n                            setAddressRef={setAddressRef}\n                            billingAddress={billingAddress}\n                            billingAddressValidationRules={partialAddressSchema && getPartialAddressValidationRules(partialAddressCountry.current)}\n                            partialAddressSchema={partialAddressSchema}\n                            handleAddress={handleAddress}\n                            onAddressLookup={props.onAddressLookup}\n                            onAddressSelected={props.onAddressSelected}\n                            addressSearchDebounceMs={props.addressSearchDebounceMs}\n                            //\n                            iOSFocusedField={iOSFocusedField}\n                            //\n                            onFieldFocusAnalytics={onFieldFocusAnalytics}\n                            onFieldBlurAnalytics={onFieldBlurAnalytics}\n                        />\n                    </div>\n                )}\n            />\n\n            {props.fastlaneConfiguration && (\n                <FastlaneSignup\n                    {...props.fastlaneConfiguration}\n                    currentDetectedBrand={internallyDetectedBrand}\n                    onChange={props.onChange}\n                    onSubmitAnalytics={props.onSubmitAnalytics}\n                    type={props.type}\n                />\n            )}\n\n            {showCardUIElements &&\n                props.showPayButton &&\n                props.payButton({\n                    status,\n                    variant: props.isPayButtonPrimaryVariant ? 'primary' : 'secondary',\n                    icon: getImage({ imageFolder: 'components/' })(`${PREFIX}lock`)\n                })}\n        </Fragment>\n    );\n};\n\nCardInput.defaultProps = defaultProps;\n\nexport default CardInput;\n"],"names":["CardInput","props","sfp","useRef","isValidating","getImage","useImage","billingAddressRef","setAddressRef","ref","current","cardInputRef","Object","keys","length","setComponentRef","hasPanLengthRef","isAutoJumping","specifications","useMemo","Specifications","status","setStatus","useState","errors","setErrors","valid","setValid","_object_spread","holderNameRequired","holderName","data","setData","hasHolderName","focusedElement","setFocusedElement","isSfpValid","setIsSfpValid","expiryDatePolicy","setExpiryDatePolicy","DATE_POLICY_REQUIRED","cvcPolicy","setCvcPolicy","CVC_POLICY_REQUIRED","issuingCountryCode","setIssuingCountryCode","dualBrandSelectElements","setDualBrandSelectElements","selectedBrandValue","setSelectedBrandValue","storedPaymentMethodId","brand","showBillingAddress","billingAddressMode","AddressModeOptions","none","billingAddressRequired","partialAddressSchema","handlePartialAddressMode","partialAddressCountry","billingAddress","country","storePaymentMethod","setStorePaymentMethod","setBillingAddress","showSocialSecurityNumber","setShowSocialSecurityNumber","socialSecurityNumber","setSocialSecurityNumber","installments","setInstallments","value","iOSFocusedField","setIOSFocusedField","internallyDetectedBrand","setInternallyDetectedBrand","showCardUIElements","setShowCardUIElements","handleChangeFor","triggerValidation","formData","formValid","formErrors","setSchema","setFormData","setFormValid","setFormErrors","useForm","schema","defaultData","formatters","cardInputFormatters","rules","cardInputValidationRules","hasInstallments","installmentOptions","fundingSource","showAmountsInInstallments","showInstallmentAmounts","isKorea","countryCode","showKCP","configuration","koreanAuthenticationRequired","showBrazilianSSN","socialSecurityNumberMode","onFieldFocusAnalytics","who","e","onFocus","fieldType","event","onFieldBlurAnalytics","onBlur","onBrand","useCallback","obj","handleFocus","getFocusHandler","retrieveLayout","getLayout","countrySpecificSchemas","getAddressSchemaForCountry","billingAddressRequiredFields","handleTouchstartIOS","elementType","name","handleAddress","getAddressHandler","doPanAutoJump","getAutoJumpHandler","handleSFPStateUpdate","sfpState","mimicLoadingStatusChange","extensions","CIExtensions","showValidation","clearSRPanel","processBinLookupResponse","binLookupResponse","isReset","processBinLookup","useEffect","setFocusOn","updateStyles","handleUnsupportedCard","destroy","newSchema","_object_spread_props","taxNumber","addressHasErrors","entries","reduce","acc","error","sortedErrorList","currentErrorsSortedByLayout","previousSortedErrors","useSRPanelForCardInputErrors","newErrors","getArrayDifferences","forEach","errorItem","AnalyticsInfoEvent","component","type","InfoEventType","validationError","target","fieldTypeToSnakeCase","field","validationErrorCode","errorCode","validationErrorMessage","getErrorMessageFromCode","SF_ErrorCodes","onSubmitAnalytics","holderNameValid","sfpValid","addressValid","koreanAuthentication","encryptedPassword","socialSecurityNumberValid","isValid","sfStateErrorsObj","mapErrorsToValidationRuleResult","mergedErrors","onChange","dualBrandsArr","map","item","id","dualBrands","toString","displayed","UiTarget","dualBrandButton","configData","previousSelectedBrandValue","usePrevious","selected","FieldToRender","StoredCardFieldsWrapper","CardFieldsWrapper","h","Fragment","SecuredFieldsProvider","extractPropsForSFP","styles","hasKoreanFields","sfState","eventDetails","autoCompleteName","acHolderName","getRuleByNameAndMode","holderNameValidationFn","autoFocus","ENCRYPTED_CARD_NUMBER","encryptedCardNumber","onStateUpdate","componentType","disableIOSArrowKeys","render","setRootNode","div","className","classNames","role","FormInstruction","extractPropsForCardFields","handleInstallments","brandsIcons","handleOnStoreDetails","billingAddressValidationRules","getPartialAddressValidationRules","onAddressLookup","onAddressSelected","addressSearchDebounceMs","fastlaneConfiguration","FastlaneSignup","currentDetectedBrand","showPayButton","payButton","variant","isPayButtonPrimaryVariant","icon","imageFolder","PREFIX","defaultProps"],"mappings":"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"}