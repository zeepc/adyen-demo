{"version":3,"file":"callSubmit3DS2Fingerprint.js","sources":["../../../../src/components/ThreeDS2/callSubmit3DS2Fingerprint.ts"],"sourcesContent":["import { httpPost } from '../../core/Services/http';\nimport { pick } from '../../utils/commonUtils';\nimport { ThreeDS2FingerprintResponse } from './types';\nimport AdyenCheckoutError from '../../core/Errors/AdyenCheckoutError';\nimport { THREEDS2_FINGERPRINT_SUBMIT } from './constants';\nimport { API_ERROR_CODE } from '../../core/Services/sessions/constants';\nimport { AbstractAnalyticsEvent } from '../../core/Analytics/events/AbstractAnalyticsEvent';\nimport { AnalyticsErrorEvent, ErrorEventCode, ErrorEventType } from '../../core/Analytics/events/AnalyticsErrorEvent';\n\n/**\n * ThreeDS2DeviceFingerprint, onComplete, calls a new, internal, endpoint which\n * behaves like the /details endpoint but doesn't require the same credentials\n */\nexport default function callSubmit3DS2Fingerprint({ data }): void {\n    httpPost<ThreeDS2FingerprintResponse>(\n        {\n            path: `v1/submitThreeDS2Fingerprint?token=${this.props.clientKey}`,\n            loadingContext: this.props.loadingContext,\n            errorLevel: 'fatal',\n            errorCode: API_ERROR_CODE.submitThreeDS2Fingerprint\n        },\n        {\n            ...data\n        }\n    )\n        .then(resData => {\n            let event: AbstractAnalyticsEvent;\n\n            /**\n             * Frictionless (no challenge) flow OR \"refused\" flow\n             */\n            if (resData.type === 'completed') {\n                const { details } = resData;\n\n                if (!resData.details) {\n                    console.debug(\n                        'Handled Error::callSubmit3DS2Fingerprint::FAILED:: no details object in a response indicating either a \"frictionless\" flow, or a \"refused\" response. resData=',\n                        resData\n                    );\n\n                    event = new AnalyticsErrorEvent({\n                        component: 'threeDS2Fingerprint',\n                        code: ErrorEventCode.THREEDS2_NO_DETAILS_FOR_FRICTIONLESS_OR_REFUSED,\n                        errorType: ErrorEventType.threeDS2,\n                        message: `${THREEDS2_FINGERPRINT_SUBMIT}: no details object in a response indicating either a \"frictionless\" flow, or a \"refused\" response`\n                    });\n\n                    this.submitAnalytics(event);\n\n                    return;\n                }\n\n                return this.onComplete({ data: { details } });\n            }\n\n            /**\n             * If we don't have a type: \"completed\", then we expect an action, because we must be in a Challenge or Redirect flow\n             */\n            if (!resData.action) {\n                console.debug(\n                    'Handled Error::callSubmit3DS2Fingerprint::FAILED:: no action object in a response indicating a \"challenge\". resData=',\n                    resData\n                );\n\n                event = new AnalyticsErrorEvent({\n                    component: 'threeDS2Fingerprint',\n                    code: ErrorEventCode.THREEDS2_NO_ACTION_FOR_CHALLENGE,\n                    errorType: ErrorEventType.threeDS2,\n                    message: `${THREEDS2_FINGERPRINT_SUBMIT}: no action object in a response indicating a \"challenge\" flow`\n                });\n                this.submitAnalytics(event);\n\n                return;\n            }\n\n            // elementRef exists when the fingerprint component is created from the Dropin\n            const actionHandler = this.props.elementRef ?? this;\n\n            /**\n             * We have an action but do we have a way to handle it?\n             * TODO - check logs: do we ever *not* have an actionHandler?\n             */\n            if (!actionHandler) {\n                console.debug('Handled Error::callSubmit3DS2Fingerprint::FAILED:: no actionHandler');\n\n                event = new AnalyticsErrorEvent({\n                    component: 'threeDS2Fingerprint',\n                    code: ErrorEventCode.THREEDS2_NO_COMPONENT_FOR_ACTION,\n                    errorType: ErrorEventType.threeDS2,\n                    message: `${THREEDS2_FINGERPRINT_SUBMIT}: no component defined to handle the action response`\n                });\n\n                this.submitAnalytics(event);\n\n                return;\n            }\n\n            /**\n             * Challenge flow\n             */\n            if (resData.action?.type === 'threeDS2') {\n                // Ensure challengeWindowSize is propagated if there was a (merchant defined) handleAction call proceeding this one that had it set as an option\n                return actionHandler.handleAction(resData.action, pick('challengeWindowSize').from(this.props));\n            }\n\n            /**\n             * Redirect flow (usecase: we thought we could do 3DS2 but it turns out we can't)\n             * TODO - check logs: does this ever happen, anymore?\n             */\n            if (resData.action?.type === 'redirect') {\n                return actionHandler.handleAction(resData.action);\n            }\n        })\n        .catch((error: AdyenCheckoutError) => {\n            this.handleError(error);\n        });\n}\n"],"names":["callSubmit3DS2Fingerprint","data","httpPost","path","this","props","clientKey","loadingContext","errorLevel","errorCode","API_ERROR_CODE","submitThreeDS2Fingerprint","_object_spread","then","resData","_this_props_elementRef","event","type","details","onComplete","console","debug","AnalyticsErrorEvent","component","code","ErrorEventCode","THREEDS2_NO_DETAILS_FOR_FRICTIONLESS_OR_REFUSED","errorType","ErrorEventType","threeDS2","message","THREEDS2_FINGERPRINT_SUBMIT","submitAnalytics","action","THREEDS2_NO_ACTION_FOR_CHALLENGE","actionHandler","elementRef","handleAction","pick","from","THREEDS2_NO_COMPONENT_FOR_ACTION","catch","error","handleError"],"mappings":"0eAae,SAASA,GAA0BC,KAAEA,IAChDC,EACI,CACIC,KAAM,sCAAsCC,KAAKC,MAAMC,YACvDC,eAAgBH,KAAKC,MAAME,eAC3BC,WAAY,QACZC,UAAWC,EAAeC,6VAE9BC,CAAA,CAAA,EACOX,IAGNY,KAAKC,IAmDoB,IAAAC,EAwBlBD,EASAA,EAnFJ,IAAIE,EAKJ,GAAqB,cAAjBF,EAAQG,KAAsB,CAC9B,MAAMC,QAAEA,GAAYJ,EAEpB,OAAKA,EAAQI,QAkBNd,KAAKe,WAAW,CAAElB,KAAM,CAAEiB,cAjB7BE,QAAQC,MACJ,gKACAP,GAGJE,EAAQ,IAAIM,EAAoB,CAC5BC,UAAW,sBACXC,KAAMC,EAAeC,gDACrBC,UAAWC,EAAeC,SAC1BC,QAAS,GAAGC,6GAGhB3B,KAAK4B,gBAAgBhB,GAM7B,CAKA,IAAKF,EAAQmB,OAcT,OAbAb,QAAQC,MACJ,uHACAP,GAGJE,EAAQ,IAAIM,EAAoB,CAC5BC,UAAW,sBACXC,KAAMC,EAAeS,iCACrBP,UAAWC,EAAeC,SAC1BC,QAAS,GAAGC,yEAEhB3B,KAAK4B,gBAAgBhB,GAMzB,MAAMmB,EAAqC,QAArBpB,EAAAX,KAAKC,MAAM+B,sBAAXrB,EAAAA,EAAyBX,KAM/C,OAAK+B,EAkBwB,sBAAzBrB,EAAAA,EAAQmB,cAARnB,IAAAA,OAAAA,EAAAA,EAAgBG,MAETkB,EAAcE,aAAavB,EAAQmB,OAAQK,EAAK,uBAAuBC,KAAKnC,KAAKC,QAO/D,sBAAzBS,EAAAA,EAAQmB,cAARnB,IAAAA,OAAAA,EAAAA,EAAgBG,MACTkB,EAAcE,aAAavB,EAAQmB,aAD9C,GA1BIb,QAAQC,MAAM,uEAEdL,EAAQ,IAAIM,EAAoB,CAC5BC,UAAW,sBACXC,KAAMC,EAAee,iCACrBb,UAAWC,EAAeC,SAC1BC,QAAS,GAAGC,+DAGhB3B,KAAK4B,gBAAgBhB,MAqB5ByB,MAAOC,IACJtC,KAAKuC,YAAYD,IAE7B"}