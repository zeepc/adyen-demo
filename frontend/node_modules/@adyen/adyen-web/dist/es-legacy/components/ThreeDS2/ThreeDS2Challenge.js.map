{"version":3,"file":"ThreeDS2Challenge.js","sources":["../../../../src/components/ThreeDS2/ThreeDS2Challenge.tsx"],"sourcesContent":["import { h } from 'preact';\nimport UIElement from '../internal/UIElement/UIElement';\nimport PrepareChallenge from './components/Challenge';\nimport { DEFAULT_CHALLENGE_WINDOW_SIZE, THREEDS2_CHALLENGE, THREEDS2_CHALLENGE_ERROR } from './constants';\nimport { existy } from '../../utils/commonUtils';\nimport { hasOwnProperty } from '../../utils/hasOwnProperty';\nimport { TxVariants } from '../tx-variants';\nimport { ChallengeResolveData, LegacyChallengeResolveData, ThreeDS2ChallengeConfiguration } from './types';\nimport AdyenCheckoutError, { API_ERROR } from '../../core/Errors/AdyenCheckoutError';\nimport { ActionHandledReturnObject } from '../../types/global-types';\nimport { AnalyticsLogEvent, LogEventSubtype, LogEventType } from '../../core/Analytics/events/AnalyticsLogEvent';\nimport { AnalyticsErrorEvent, ErrorEventCode, ErrorEventType } from '../../core/Analytics/events/AnalyticsErrorEvent';\n\nclass ThreeDS2Challenge extends UIElement<ThreeDS2ChallengeConfiguration> {\n    public static type = TxVariants.threeDS2Challenge;\n\n    public static defaultProps = {\n        dataKey: 'threeDSResult',\n        size: DEFAULT_CHALLENGE_WINDOW_SIZE,\n        type: THREEDS2_CHALLENGE\n    };\n\n    protected override beforeRender() {\n        /* Do not send rendered events for ThreeDS2Challenge - it will have the same timestamp as the \"creq sent\" event */\n    }\n\n    protected onActionHandled = (rtnObj: ActionHandledReturnObject) => {\n        const event = new AnalyticsLogEvent({\n            component: this.type,\n            type: LogEventType.threeDS2,\n            subType: LogEventSubtype.challengeIframeLoaded,\n            message: rtnObj.actionDescription\n        });\n\n        this.submitAnalytics(event);\n\n        super.onActionHandled(rtnObj);\n    };\n\n    onComplete(state: LegacyChallengeResolveData | ChallengeResolveData) {\n        /**\n         * Equals a call to onAdditionalDetails (as set in actionTypes.ts) for the regular, \"native\" flow.\n         * However, if the action to create this component came from the 3DS2InMDFlow process it will instead equal a call to the onComplete callback\n         * (as defined in the 3DS2InMDFlow and passed in as a config prop).\n         */\n        if (this.props.onComplete) {\n            this.props.onComplete(state, this.elementRef);\n        } else {\n            super.onComplete(state);\n        }\n\n        this.unmount(); // re. fixing issue around back to back challenge calls\n    }\n\n    protected override componentToRender(): h.JSX.Element {\n        // existy used because threeds2InMDFlow will send empty string for paymentData and we should be allowed to proceed with this\n        if (!existy(this.props.paymentData)) {\n            /**\n             *   The presence of props.isMDFlow indicates the action to create this component came from the threeds2InMDFlow process which passes (an empty) paymentsData.\n             *   The regular, \"native\" flow uses the authorisationToken from the 3DS2 action, which actionTypes.ts assigns to a property called paymentData\n             */\n            const dataTypeForError = hasOwnProperty(this.props, 'isMDFlow') ? 'paymentData' : 'authorisationToken';\n\n            this.props.onError(new AdyenCheckoutError(API_ERROR, `No ${dataTypeForError} received. 3DS2 Challenge cannot proceed`));\n\n            const event = new AnalyticsErrorEvent({\n                component: this.type,\n                code: ErrorEventCode.THREEDS2_ACTION_IS_MISSING_PAYMENT_DATA,\n                errorType: ErrorEventType.threeDS2,\n                message: `${THREEDS2_CHALLENGE_ERROR}: Missing 'paymentData' property from threeDS2 action`\n            });\n\n            this.submitAnalytics(event);\n\n            return null;\n        }\n\n        return (\n            <PrepareChallenge\n                {...this.props}\n                onComplete={this.onComplete}\n                onSubmitAnalytics={this.submitAnalytics}\n                isMDFlow={this.props.paymentData.length < 15}\n                onActionHandled={this.onActionHandled}\n            />\n        );\n    }\n}\n\nexport default ThreeDS2Challenge;\n"],"names":["ThreeDS2Challenge","UIElement","beforeRender","onComplete","state","this","props","elementRef","super","unmount","componentToRender","existy","paymentData","dataTypeForError","hasOwnProperty","onError","AdyenCheckoutError","API_ERROR","event","AnalyticsErrorEvent","component","type","code","ErrorEventCode","THREEDS2_ACTION_IS_MISSING_PAYMENT_DATA","errorType","ErrorEventType","threeDS2","message","THREEDS2_CHALLENGE_ERROR","submitAnalytics","h","PrepareChallenge","onSubmitAnalytics","isMDFlow","length","onActionHandled","args","_define_property","rtnObj","AnalyticsLogEvent","LogEventType","subType","LogEventSubtype","challengeIframeLoaded","actionDescription","TxVariants","threeDS2Challenge","defaultProps","dataKey","size","DEFAULT_CHALLENGE_WINDOW_SIZE","THREEDS2_CHALLENGE"],"mappings":"kwCAaA,MAAMA,UAA0BC,EASTC,YAAAA,GAEnB,CAeAC,UAAAA,CAAWC,GAMHC,KAAKC,MAAMH,WACXE,KAAKC,MAAMH,WAAWC,EAAOC,KAAKE,YAElCC,MAAML,WAAWC,GAGrBC,KAAKI,SACT,CAEmBC,iBAAAA,GAEf,IAAKC,EAAON,KAAKC,MAAMM,aAAc,CAKjC,MAAMC,EAAmBC,EAAeT,KAAKC,MAAO,YAAc,cAAgB,qBAElFD,KAAKC,MAAMS,QAAQ,IAAIC,EAAmBC,EAAW,MAAMJ,8CAE3D,MAAMK,EAAQ,IAAIC,EAAoB,CAClCC,UAAWf,KAAKgB,KAChBC,KAAMC,EAAeC,wCACrBC,UAAWC,EAAeC,SAC1BC,QAAS,GAAGC,2DAKhB,OAFAxB,KAAKyB,gBAAgBZ,GAEd,IACX,CAEA,OACIa,EAACC,EAAAA,oUAAAA,CAAAA,GACO3B,KAAKC,OAAK,CACdH,WAAYE,KAAKF,WACjB8B,kBAAmB5B,KAAKyB,gBACxBI,SAAU7B,KAAKC,MAAMM,YAAYuB,OAAS,GAC1CC,gBAAiB/B,KAAK+B,kBAGlC,mBAzEJ5B,SAAA6B,GAaIC,EAAAjC,KAAU+B,kBAAmBG,IACzB,MAAMrB,EAAQ,IAAIsB,EAAkB,CAChCpB,UAAWf,KAAKgB,KAChBA,KAAMoB,EAAad,SACnBe,QAASC,EAAgBC,sBACzBhB,QAASW,EAAOM,oBAGpBxC,KAAKyB,gBAAgBZ,GAErBV,MAAM4B,gBAAgBG,MAtB1BD,EADEtC,EACYqB,OAAOyB,EAAWC,mBAEhCT,EAHEtC,EAGYgD,eAAe,CACzBC,QAAS,gBACTC,KAAMC,EACN9B,KAAM+B"}