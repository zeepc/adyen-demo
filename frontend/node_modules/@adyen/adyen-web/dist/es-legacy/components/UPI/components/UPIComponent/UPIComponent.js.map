{"version":3,"file":"UPIComponent.js","sources":["../../../../../../src/components/UPI/components/UPIComponent/UPIComponent.tsx"],"sourcesContent":["import { Fragment, h, RefObject } from 'preact';\nimport { useCallback, useEffect, useState } from 'preact/hooks';\nimport { UIElementStatus } from '../../../types';\nimport { App, UpiMode } from '../../types';\nimport useImage from '../../../../core/Context/useImage';\nimport { A11Y, UPI_MODE } from '../../constants';\nimport './UPIComponent.scss';\nimport { SegmentedControlRegion } from '../../../internal/SegmentedControl';\nimport UPIIntentAppList from '../UPIIntentAppList';\nimport { useCoreContext } from '../../../../core/Context/CoreProvider';\nimport Alert from '../../../internal/Alert';\nimport UPIMandate, { Mandate } from '../UPIMandate/UPIMandate';\nimport { PayButtonProps } from '../../../internal/PayButton/PayButton';\nimport { useAmount } from '../../../../core/Context/AmountProvider';\n\ntype UpiData = { app?: App };\n\ntype OnChangeProps = { data: UpiData; valid?: { [key: string]: boolean }; errors?: { [key: string]: any }; isValid: boolean };\n\ninterface UPIComponentProps {\n    mode: UpiMode;\n    showPayButton: boolean;\n    apps?: Array<App>;\n    mandate?: Mandate;\n    ref?(ref: RefObject<typeof UPIComponent>): void;\n    payButton(props: PayButtonProps): h.JSX.Element;\n    onChange({ data, valid, errors, isValid }: OnChangeProps): void;\n}\n\nexport default function UPIComponent({ mode, onChange, payButton, showPayButton, mandate, apps = [] }: Readonly<UPIComponentProps>): h.JSX.Element {\n    const { i18n } = useCoreContext();\n    const getImage = useImage();\n    const [status, setStatus] = useState<UIElementStatus>('ready');\n    const [selectedApp, setSelectedApp] = useState<App>(null);\n    const { amount } = useAmount();\n    const [isValid, setIsValid] = useState<boolean>(mode === UPI_MODE.QR_CODE);\n    const mandateComponent = mandate && <UPIMandate mandate={mandate} amount={amount} />;\n\n    this.setStatus = (status: UIElementStatus) => {\n        setStatus(status);\n    };\n\n    this.showValidation = () => {\n        if (mode === UPI_MODE.INTENT) {\n            validateIntentApp();\n        }\n    };\n\n    const handleAppSelect = useCallback(\n        (app: App) => {\n            if (app?.id === selectedApp?.id) return;\n\n            setSelectedApp(app);\n            setIsValid(true);\n            setStatus('ready');\n        },\n        [selectedApp]\n    );\n\n    const validateIntentApp = useCallback(() => {\n        if (!selectedApp) {\n            setStatus('error');\n            setIsValid(false);\n        } else {\n            setStatus('ready');\n            setIsValid(true);\n        }\n    }, [selectedApp]);\n\n    useEffect(() => {\n        if (mode === UPI_MODE.QR_CODE) {\n            /**\n             * When selecting QR code mode, we need to clear the state data and trigger the 'onChange'.\n             */\n            onChange({ data: {}, valid: {}, errors: {}, isValid: true });\n            return;\n        }\n        onChange({\n            data: { ...(selectedApp && { app: selectedApp }) },\n            isValid\n        });\n    }, [selectedApp, isValid, mode, onChange]);\n\n    return (\n        <Fragment>\n            {mode === UPI_MODE.INTENT && (\n                <SegmentedControlRegion id={A11Y.AreaId.INTENT} ariaLabelledBy={A11Y.ButtonId.INTENT} className=\"adyen-checkout-upi-area-intent\">\n                    <span className=\"adyen-checkout-upi-instruction-label\">{i18n.get('upi.intent.instruction')}</span>\n                    {status === 'error' && <Alert icon={'cross'}>{i18n.get('upi.error.noAppSelected')}</Alert>}\n                    <UPIIntentAppList disabled={status === 'loading'} apps={apps} selectedAppId={selectedApp?.id} onAppSelect={handleAppSelect} />\n                    {mandateComponent}\n                    {showPayButton &&\n                        payButton({\n                            label: i18n.get('continue'),\n                            status\n                        })}\n                </SegmentedControlRegion>\n            )}\n            {mode === UPI_MODE.QR_CODE && (\n                <SegmentedControlRegion id={A11Y.AreaId.QR} ariaLabelledBy={A11Y.ButtonId.QR} className=\"adyen-checkout-upi-area-qr-code\">\n                    <span className=\"adyen-checkout-upi-instruction-label\">{i18n.get('upi.qrCode.instruction')}</span>\n                    {mandateComponent}\n                    {showPayButton &&\n                        payButton({\n                            label: i18n.get('generateQRCode'),\n                            icon: getImage({ imageFolder: 'components/' })('qr'),\n                            status\n                        })}\n                </SegmentedControlRegion>\n            )}\n        </Fragment>\n    );\n}\n"],"names":["UPIComponent","mode","onChange","payButton","showPayButton","mandate","apps","i18n","useCoreContext","getImage","useImage","status","setStatus","useState","selectedApp","setSelectedApp","amount","useAmount","isValid","setIsValid","UPI_MODE","QR_CODE","mandateComponent","h","UPIMandate","this","showValidation","INTENT","validateIntentApp","handleAppSelect","useCallback","app","id","useEffect","data","_object_spread","valid","errors","Fragment","SegmentedControlRegion","A11Y","AreaId","ariaLabelledBy","ButtonId","className","span","get","Alert","icon","UPIIntentAppList","disabled","selectedAppId","onAppSelect","label","QR","imageFolder"],"mappings":"2pCA6Be,SAASA,GAAaC,KAAEA,EAAIC,SAAEA,EAAQC,UAAEA,EAASC,cAAEA,EAAaC,QAAEA,EAAOC,KAAEA,EAAO,KAC7F,MAAMC,KAAEA,GAASC,IACXC,EAAWC,KACVC,EAAQC,GAAaC,EAA0B,UAC/CC,EAAaC,GAAkBF,EAAc,OAC9CG,OAAEA,GAAWC,KACZC,EAASC,GAAcN,EAAkBZ,IAASmB,EAASC,SAC5DC,EAAmBjB,GAAWkB,EAACC,EAAAA,CAAWnB,QAASA,EAASW,OAAQA,IAE1ES,KAAKb,UAAaD,IACdC,EAAUD,IAGdc,KAAKC,eAAiB,KACdzB,IAASmB,EAASO,QAClBC,KAIR,MAAMC,EAAkBC,EACnBC,KACOA,aAAAA,EAAAA,EAAKC,OAAOlB,aAAAA,EAAAA,EAAakB,MAE7BjB,EAAegB,GACfZ,GAAW,GACXP,EAAU,WAEd,CAACE,IAGCc,EAAoBE,EAAY,KAC7BhB,GAIDF,EAAU,SACVO,GAAW,KAJXP,EAAU,SACVO,GAAW,KAKhB,CAACL,IAgBJ,OAdAmB,EAAU,KACFhC,IAASmB,EAASC,QAOtBnB,EAAS,CACLgC,KAAMC,KAAMrB,GAAe,CAAEiB,IAAKjB,IAClCI,YALAhB,EAAS,CAAEgC,KAAM,CAAA,EAAIE,MAAO,CAAA,EAAIC,OAAQ,CAAA,EAAInB,SAAS,KAO1D,CAACJ,EAAaI,EAASjB,EAAMC,IAG5BqB,EAACe,EAAAA,KACIrC,IAASmB,EAASO,QACfJ,EAACgB,EAAAA,CAAuBP,GAAIQ,EAAKC,OAAOd,OAAQe,eAAgBF,EAAKG,SAAShB,OAAQiB,UAAU,kCAC5FrB,EAACsB,OAAAA,CAAKD,UAAU,wCAAwCrC,EAAKuC,IAAI,2BACrD,UAAXnC,GAAsBY,EAACwB,EAAAA,CAAMC,KAAM,SAAUzC,EAAKuC,IAAI,4BACvDvB,EAAC0B,EAAAA,CAAiBC,SAAqB,YAAXvC,EAAsBL,KAAMA,EAAM6C,cAAerC,aAAAA,EAAAA,EAAakB,GAAIoB,YAAavB,IAC1GP,EACAlB,GACGD,EAAU,CACNkD,MAAO9C,EAAKuC,IAAI,YAChBnC,YAIfV,IAASmB,EAASC,SACfE,EAACgB,EAAAA,CAAuBP,GAAIQ,EAAKC,OAAOa,GAAIZ,eAAgBF,EAAKG,SAASW,GAAIV,UAAU,mCACpFrB,EAACsB,OAAAA,CAAKD,UAAU,wCAAwCrC,EAAKuC,IAAI,2BAChExB,EACAlB,GACGD,EAAU,CACNkD,MAAO9C,EAAKuC,IAAI,kBAChBE,KAAMvC,EAAS,CAAE8C,YAAa,eAAxB9C,CAAyC,MAC/CE,YAM5B"}