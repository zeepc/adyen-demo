{"version":3,"file":"UPI.js","sources":["../../../../src/components/UPI/UPI.tsx"],"sourcesContent":["import { h, RefObject } from 'preact';\nimport UIElement from '../internal/UIElement/UIElement';\nimport UPIComponent from './components/UPIComponent';\nimport { Await } from '../internal/Await';\nimport { QRLoader } from '../internal/QRLoader';\nimport { UPIConfiguration, UpiMode, UpiPaymentData, UpiType } from './types';\nimport { TxVariants } from '../tx-variants';\nimport isMobile from '../../utils/isMobile';\nimport { UPI_MODE } from './constants';\nimport { ICore } from '../../types';\n\n/**\n * For mobile:\n * We should show upi_intent depending on if `apps` are returned in /paymentMethods response.\n *\n * For non-mobile:\n * We should never show the upi_intent (ignore `apps` in /paymentMethods response)\n * Show upi_qr as default\n */\n\nclass UPI extends UIElement<UPIConfiguration> {\n    public static type = TxVariants.upi;\n    public static readonly txVariants = [TxVariants.upi, TxVariants.upi_qr, TxVariants.upi_intent];\n    private mode: UpiMode;\n    constructor(checkout: ICore, props: UPIConfiguration) {\n        super(checkout, props);\n        // @ts-ignore: Accessing deprecated prop to provide migration warning\n        const { defaultMode: deprecatedDefaultMode } = props;\n        if (deprecatedDefaultMode) {\n            console.warn('[Adyen Checkout] UPI configuration property \"defaultMode\" is deprecated and will be removed in a future version.');\n        }\n        this.mode = isMobile() ? UPI_MODE.INTENT : UPI_MODE.QR_CODE;\n    }\n\n    formatProps(props: UPIConfiguration): UPIConfiguration {\n        const { apps = [] } = props;\n        const hasIntentApps = apps.length > 0;\n        if (isMobile() && hasIntentApps) {\n            // Mobile with UPI apps\n            return {\n                ...super.formatProps(props),\n                apps\n            };\n        }\n\n        this.mode = UPI_MODE.QR_CODE;\n        return {\n            ...super.formatProps(props),\n            apps: []\n        };\n    }\n\n    public get isValid(): boolean {\n        return this.state.isValid;\n    }\n\n    public formatData(): UpiPaymentData {\n        const { app } = this.state.data || {};\n\n        return {\n            paymentMethod: {\n                type: this.paymentType,\n                ...(this.paymentType === TxVariants.upi_intent && app?.id && { appId: app.id })\n            }\n        };\n    }\n\n    get paymentType(): UpiType {\n        if (this.mode === UPI_MODE.QR_CODE) {\n            return TxVariants.upi_qr;\n        }\n        return TxVariants.upi_intent;\n    }\n\n    protected override componentToRender(): h.JSX.Element {\n        const { type, url, paymentMethodType } = this.props;\n\n        const isAutoPay = !!this.props.mandate;\n\n        switch (type) {\n            case 'qrCode':\n                return (\n                    <QRLoader\n                        {...this.props}\n                        qrCodeData={this.props.qrCodeData ? encodeURIComponent(this.props.qrCodeData) : null}\n                        type={TxVariants.upi_qr}\n                        brandLogo={this.props.brandLogo || this.icon}\n                        onComplete={this.onComplete}\n                        introduction={this.props.i18n.get('upi.qrCodeWaitingMessage')}\n                        countdownTime={this.props.countdownTime ?? 5}\n                        onActionHandled={this.onActionHandled}\n                        showAmount={!isAutoPay}\n                    />\n                );\n            case 'await':\n                return (\n                    <Await\n                        url={url}\n                        type={paymentMethodType}\n                        showCountdownTimer\n                        shouldRedirectAutomatically\n                        showAmount={!isAutoPay}\n                        countdownTime={this.props.countdownTime ?? 5}\n                        clientKey={this.props.clientKey}\n                        paymentData={this.props.paymentData}\n                        onActionHandled={this.onActionHandled}\n                        onError={this.props.onError}\n                        messageText={this.props.i18n.get('upi.vpaWaitingMessage')}\n                        awaitText={this.props.i18n.get('await.waitForConfirmation')}\n                        onComplete={this.onComplete}\n                        brandLogo={this.icon}\n                    />\n                );\n            default:\n                return (\n                    <UPIComponent\n                        ref={(ref: RefObject<typeof UPIComponent>) => {\n                            this.componentRef = ref;\n                        }}\n                        payButton={this.payButton}\n                        onChange={this.setState}\n                        apps={this.props.apps}\n                        mode={this.mode}\n                        showPayButton={this.props.showPayButton}\n                        mandate={this.props.mandate}\n                    />\n                );\n        }\n    }\n}\n\nexport default UPI;\n"],"names":["UPI","UIElement","formatProps","props","apps","hasIntentApps","length","isMobile","_object_spread_props","_object_spread","super","this","mode","UPI_MODE","QR_CODE","isValid","state","formatData","app","data","paymentMethod","type","paymentType","TxVariants","upi_intent","id","appId","upi_qr","componentToRender","url","paymentMethodType","isAutoPay","mandate","_this_props_countdownTime","h","QRLoader","qrCodeData","encodeURIComponent","brandLogo","icon","onComplete","introduction","i18n","get","countdownTime","onActionHandled","showAmount","_this_props_countdownTime1","Await","showCountdownTimer","shouldRedirectAutomatically","clientKey","paymentData","onError","messageText","awaitText","UPIComponent","ref","componentRef","payButton","onChange","setState","showPayButton","constructor","checkout","_define_property","defaultMode","deprecatedDefaultMode","console","warn","INTENT","upi","txVariants"],"mappings":"2+CAoBA,MAAMA,UAAYC,EAcdC,WAAAA,CAAYC,GACR,MAAMC,KAAEA,EAAO,IAAOD,EAChBE,EAAgBD,EAAKE,OAAS,EACpC,OAAIC,KAAcF,EAEPG,EAAAC,EAAA,CAAA,EACAC,MAAMR,YAAYC,IAAAA,CACrBC,UAIRO,KAAKC,KAAOC,EAASC,QACdN,EAAAC,EAAA,CAAA,EACAC,MAAMR,YAAYC,IAAAA,CACrBC,KAAM,KAEd,CAEA,WAAWW,GACP,OAAOJ,KAAKK,MAAMD,OACtB,CAEOE,UAAAA,GACH,MAAMC,IAAEA,GAAQP,KAAKK,MAAMG,MAAQ,CAAA,EAEnC,MAAO,CACHC,cAAeX,EAAA,CACXY,KAAMV,KAAKW,aACPX,KAAKW,cAAgBC,EAAWC,aAAcN,aAAAA,EAAAA,EAAKO,KAAM,CAAEC,MAAOR,EAAIO,KAGtF,CAEA,eAAIH,GACA,OAAIX,KAAKC,OAASC,EAASC,QAChBS,EAAWI,OAEfJ,EAAWC,UACtB,CAEmBI,iBAAAA,GACf,MAAMP,KAAEA,EAAIQ,IAAEA,EAAGC,kBAAEA,GAAsBnB,KAAKR,MAExC4B,IAAcpB,KAAKR,MAAM6B,QAE/B,OAAQX,GACJ,IAAK,SASsB,IAAAY,EARvB,OACIC,EAACC,EAAAA,EAAAA,EAAAA,GACOxB,KAAKR,OAAK,CACdiC,WAAYzB,KAAKR,MAAMiC,WAAaC,mBAAmB1B,KAAKR,MAAMiC,YAAc,KAChFf,KAAME,EAAWI,OACjBW,UAAW3B,KAAKR,MAAMmC,WAAa3B,KAAK4B,KACxCC,WAAY7B,KAAK6B,WACjBC,aAAc9B,KAAKR,MAAMuC,KAAKC,IAAI,4BAClCC,cAAuC,QAAxBX,EAAAtB,KAAKR,MAAMyC,yBAAXX,EAAAA,EAA4B,EAC3CY,gBAAiBlC,KAAKkC,gBACtBC,YAAaf,KAGzB,IAAK,QAQsB,IAAAgB,EAPvB,OACIb,EAACc,EAAAA,CACGnB,IAAKA,EACLR,KAAMS,EACNmB,oBAAAA,EACAC,6BAAAA,EACAJ,YAAaf,EACba,cAAuC,QAAxBG,EAAApC,KAAKR,MAAMyC,yBAAXG,EAAAA,EAA4B,EAC3CI,UAAWxC,KAAKR,MAAMgD,UACtBC,YAAazC,KAAKR,MAAMiD,YACxBP,gBAAiBlC,KAAKkC,gBACtBQ,QAAS1C,KAAKR,MAAMkD,QACpBC,YAAa3C,KAAKR,MAAMuC,KAAKC,IAAI,yBACjCY,UAAW5C,KAAKR,MAAMuC,KAAKC,IAAI,6BAC/BH,WAAY7B,KAAK6B,WACjBF,UAAW3B,KAAK4B,OAG5B,QACI,OACIL,EAACsB,EAAAA,CACGC,IAAMA,IACF9C,KAAK+C,aAAeD,GAExBE,UAAWhD,KAAKgD,UAChBC,SAAUjD,KAAKkD,SACfzD,KAAMO,KAAKR,MAAMC,KACjBQ,KAAMD,KAAKC,KACXkD,cAAenD,KAAKR,MAAM2D,cAC1B9B,QAASrB,KAAKR,MAAM6B,UAIxC,CAxGA,WAAA+B,CAAYC,EAAiB7D,GACzBO,MAAMsD,EAAU7D,GAFpB8D,EAAAtD,KAAQC,eAIJ,MAAQsD,YAAaC,GAA0BhE,EAC3CgE,GACAC,QAAQC,KAAK,oHAEjB1D,KAAKC,KAAOL,IAAaM,EAASyD,OAASzD,EAASC,OACxD,EAXAmD,EADEjE,EACYqB,OAAOE,EAAWgD,KAChCN,EAFEjE,EAEqBwE,aAAa,CAACjD,EAAWgD,IAAKhD,EAAWI,OAAQJ,EAAWC"}