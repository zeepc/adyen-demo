{"version":3,"file":"AmazonPay.js","sources":["../../../../src/components/AmazonPay/AmazonPay.tsx"],"sourcesContent":["import { h } from 'preact';\nimport UIElement from '../internal/UIElement/UIElement';\nimport collectBrowserInfo from '../../utils/browserInfo';\nimport AmazonPayComponent from './components/AmazonPayComponent';\nimport { AmazonPayElementData, AmazonPayConfiguration, CheckoutDetailsRequest } from './types';\nimport defaultProps from './defaultProps';\nimport { getCheckoutDetails } from './services';\nimport './AmazonPay.scss';\nimport { TxVariants } from '../tx-variants';\nimport { sanitizeResponse, verifyPaymentDidNotFail } from '../internal/UIElement/utils';\nimport { AnalyticsInfoEvent, InfoEventType } from '../../core/Analytics/events/AnalyticsInfoEvent';\n\nexport class AmazonPayElement extends UIElement<AmazonPayConfiguration> {\n    public static type = TxVariants.amazonpay;\n\n    protected static defaultProps = defaultProps;\n\n    formatProps(props) {\n        return {\n            ...props,\n            checkoutMode: props.isDropin ? 'ProcessOrder' : props.checkoutMode,\n            environment: props.environment.toUpperCase(),\n            locale: props.locale.replace('-', '_'),\n            productType: props.isDropin && !props.addressDetails ? 'PayOnly' : props.productType\n        };\n    }\n\n    /**\n     * Formats the component data output\n     */\n    formatData(): AmazonPayElementData {\n        const { amazonCheckoutSessionId: checkoutSessionId } = this.props;\n        return {\n            paymentMethod: {\n                type: AmazonPayElement.type,\n                ...(checkoutSessionId && { checkoutSessionId })\n            },\n            browserInfo: this.browserInfo\n        };\n    }\n\n    protected override beforeRender(configSetByMerchant?: AmazonPayConfiguration) {\n        const event = new AnalyticsInfoEvent({\n            type: InfoEventType.rendered,\n            component: this.type,\n            configData: { ...configSetByMerchant, showPayButton: this.props.showPayButton },\n            ...(configSetByMerchant?.isExpress && { isExpress: configSetByMerchant.isExpress }),\n            ...(configSetByMerchant?.expressPage && { expressPage: configSetByMerchant.expressPage })\n        });\n\n        this.analytics.sendAnalytics(event);\n    }\n\n    getShopperDetails() {\n        const { amazonCheckoutSessionId, configuration = {}, loadingContext, clientKey } = this.props;\n        if (!amazonCheckoutSessionId) return console.error('Could not shopper details. Missing checkoutSessionId.');\n\n        const request: CheckoutDetailsRequest = {\n            checkoutSessionId: amazonCheckoutSessionId,\n            getDeliveryAddress: true,\n            publicKeyId: configuration.publicKeyId,\n            region: configuration.region\n        };\n\n        return getCheckoutDetails(loadingContext, clientKey, request);\n    }\n\n    public handleDeclineFlow() {\n        const { amazonCheckoutSessionId, configuration = {}, loadingContext, clientKey } = this.props;\n        if (!amazonCheckoutSessionId) return console.error('Could handle the decline flow. Missing checkoutSessionId.');\n\n        const request: CheckoutDetailsRequest = {\n            checkoutSessionId: amazonCheckoutSessionId,\n            getDeclineFlowUrl: true,\n            publicKeyId: configuration.publicKeyId,\n            region: configuration.region\n        };\n\n        getCheckoutDetails(loadingContext, clientKey, request)\n            .then((response = {}) => {\n                if (!response?.declineFlowUrl) throw response;\n                window.location.assign(response.declineFlowUrl);\n            })\n            .catch(error => {\n                if (this.props.onError) this.props.onError(error, this.componentRef);\n            });\n    }\n\n    get isValid() {\n        return true;\n    }\n\n    get browserInfo() {\n        return collectBrowserInfo();\n    }\n\n    public submit(): void {\n        const amazonComponentSubmit = this.componentRef && this.componentRef.getSubmitFunction();\n        if (amazonComponentSubmit) {\n            return amazonComponentSubmit();\n        }\n        this.makePaymentsCall().then(sanitizeResponse).then(verifyPaymentDidNotFail).then(this.handleResponse).catch(this.handleFailedResult);\n    }\n\n    protected override componentToRender(): h.JSX.Element {\n        return (\n            <AmazonPayComponent\n                ref={ref => {\n                    this.componentRef = ref;\n                }}\n                showPayButton={this.props.showPayButton}\n                onClick={this.props.onClick}\n                onError={this.props.onError}\n                onSignOut={this.props.onSignOut}\n                {...this.props}\n            />\n        );\n    }\n}\n\nexport default AmazonPayElement;\n"],"names":["AmazonPayElement","UIElement","formatProps","props","_object_spread_props","_object_spread","checkoutMode","isDropin","environment","toUpperCase","locale","replace","productType","addressDetails","formatData","amazonCheckoutSessionId","checkoutSessionId","this","paymentMethod","type","browserInfo","beforeRender","configSetByMerchant","event","AnalyticsInfoEvent","InfoEventType","rendered","component","configData","showPayButton","isExpress","expressPage","analytics","sendAnalytics","getShopperDetails","configuration","loadingContext","clientKey","console","error","request","getDeliveryAddress","publicKeyId","region","getCheckoutDetails","handleDeclineFlow","getDeclineFlowUrl","then","response","declineFlowUrl","window","location","assign","catch","onError","componentRef","isValid","collectBrowserInfo","submit","amazonComponentSubmit","getSubmitFunction","makePaymentsCall","sanitizeResponse","verifyPaymentDidNotFail","handleResponse","handleFailedResult","componentToRender","h","AmazonPayComponent","ref","onClick","onSignOut","_define_property","TxVariants","amazonpay","defaultProps"],"mappings":"q1CAYO,MAAMA,UAAyBC,EAKlCC,WAAAA,CAAYC,GACR,OAAOC,EAAAC,EAAA,CAAA,EACAF,GAAAA,CACHG,aAAcH,EAAMI,SAAW,eAAiBJ,EAAMG,aACtDE,YAAaL,EAAMK,YAAYC,cAC/BC,OAAQP,EAAMO,OAAOC,QAAQ,IAAK,KAClCC,YAAaT,EAAMI,WAAaJ,EAAMU,eAAiB,UAAYV,EAAMS,aAEjF,CAKAE,UAAAA,GACI,MAAQC,wBAAyBC,GAAsBC,KAAKd,MAC5D,MAAO,CACHe,cAAeb,EAAA,CACXc,KAAMnB,EAAiBmB,MACnBH,GAAqB,CAAEA,sBAE/BI,YAAaH,KAAKG,YAE1B,CAEmBC,YAAAA,CAAaC,GAC5B,MAAMC,EAAQ,IAAIC,EAAmBnB,EAAA,CACjCc,KAAMM,EAAcC,SACpBC,UAAWV,KAAKE,KAChBS,WAAYxB,EAAAC,EAAA,CAAA,EAAKiB,GAAAA,CAAqBO,cAAeZ,KAAKd,MAAM0B,kBAC5DP,aAAAA,EAAAA,EAAqBQ,YAAa,CAAEA,UAAWR,EAAoBQ,YACnER,aAAAA,EAAAA,EAAqBS,cAAe,CAAEA,YAAaT,EAAoBS,eAG/Ed,KAAKe,UAAUC,cAAcV,EACjC,CAEAW,iBAAAA,GACI,MAAMnB,wBAAEA,EAAuBoB,cAAEA,EAAgB,CAAA,EAAEC,eAAEA,EAAcC,UAAEA,GAAcpB,KAAKd,MACxF,IAAKY,EAAyB,OAAOuB,QAAQC,MAAM,yDAEnD,MAAMC,EAAkC,CACpCxB,kBAAmBD,EACnB0B,oBAAoB,EACpBC,YAAaP,EAAcO,YAC3BC,OAAQR,EAAcQ,QAG1B,OAAOC,EAAmBR,EAAgBC,EAAWG,EACzD,CAEOK,iBAAAA,GACH,MAAM9B,wBAAEA,EAAuBoB,cAAEA,EAAgB,CAAA,EAAEC,eAAEA,EAAcC,UAAEA,GAAcpB,KAAKd,MACxF,IAAKY,EAAyB,OAAOuB,QAAQC,MAAM,6DAEnD,MAAMC,EAAkC,CACpCxB,kBAAmBD,EACnB+B,mBAAmB,EACnBJ,YAAaP,EAAcO,YAC3BC,OAAQR,EAAcQ,QAG1BC,EAAmBR,EAAgBC,EAAWG,GACzCO,KAAK,CAACC,EAAW,MACd,KAAKA,aAAAA,EAAAA,EAAUC,gBAAgB,MAAMD,EACrCE,OAAOC,SAASC,OAAOJ,EAASC,kBAEnCI,MAAMd,IACCtB,KAAKd,MAAMmD,SAASrC,KAAKd,MAAMmD,QAAQf,EAAOtB,KAAKsC,eAEnE,CAEA,WAAIC,GACA,OAAO,CACX,CAEA,eAAIpC,GACA,OAAOqC,GACX,CAEOC,MAAAA,GACH,MAAMC,EAAwB1C,KAAKsC,cAAgBtC,KAAKsC,aAAaK,oBACrE,GAAID,EACA,OAAOA,IAEX1C,KAAK4C,mBAAmBd,KAAKe,GAAkBf,KAAKgB,GAAyBhB,KAAK9B,KAAK+C,gBAAgBX,MAAMpC,KAAKgD,mBACtH,CAEmBC,iBAAAA,GACf,OACIC,EAACC,EAAAA,EAAAA,CACGC,IAAKA,IACDpD,KAAKsC,aAAec,GAExBxC,cAAeZ,KAAKd,MAAM0B,cAC1ByC,QAASrD,KAAKd,MAAMmE,QACpBhB,QAASrC,KAAKd,MAAMmD,QACpBiB,UAAWtD,KAAKd,MAAMoE,WAClBtD,KAAKd,OAGrB,EAxGAqE,EADSxE,EACKmB,OAAOsD,EAAWC,WAEhCF,EAHSxE,EAGQ2E,eAAeA"}