{"version":3,"file":"utils.js","sources":["../../../../src/components/AmazonPay/utils.ts"],"sourcesContent":["import {\n    AMAZONPAY_URL_EU,\n    AMAZONPAY_URL_US,\n    FALLBACK_LOCALE_EU,\n    FALLBACK_LOCALE_US,\n    LEDGER_CURRENCIES_PER_REGION,\n    SUPPORTED_LOCALES_EU,\n    SUPPORTED_LOCALES_US\n} from './config';\nimport { AmazonPayButtonProps, AmazonPayButtonSettings, ChargeAmount, Currency, PayloadJSON, Region, SupportedLocale } from './types';\nimport { PaymentAmount } from '../../types/global-types';\nimport { getDecimalAmount } from '../../utils/amount-util';\n\n/**\n * Returns the AmazonPay script URL for passed region.\n * @param region - Two-letter country code in ISO 3166 format\n * @returns the AmazonPay script URL\n */\nexport function getAmazonPayUrl(region: Region): string {\n    return region === 'US' ? AMAZONPAY_URL_US : AMAZONPAY_URL_EU;\n}\n\n/**\n * Returns the AmazonPay button settings object\n * @param props -\n * @returns the AmazonPay button settings\n */\nexport function getAmazonPaySettings(props: AmazonPayButtonProps, amount?: PaymentAmount): AmazonPayButtonSettings {\n    return {\n        ...(props.buttonColor && { buttonColor: props.buttonColor }),\n        ...(props.design && { design: getDesignCode(props.design) }),\n        checkoutLanguage: getCheckoutLocale(props.locale, props.configuration.region),\n        ledgerCurrency: LEDGER_CURRENCIES_PER_REGION[props.configuration.region] || props.currency || (amount?.currency as Currency),\n        merchantId: props.configuration.merchantId,\n        productType: props.productType,\n        placement: props.placement,\n        sandbox: props.environment === 'TEST'\n    };\n}\n\n/**\n * Returns the fallback locale for passed region.\n * @param region - Two-letter country code in ISO 3166 format\n * @returns A fallback locale\n */\nexport function getFallbackLocale(region: Region): SupportedLocale {\n    return region === 'US' ? FALLBACK_LOCALE_US : FALLBACK_LOCALE_EU;\n}\n\n/**\n * Returns an array of supported locales for passed region.\n * @param region - Two-letter country code in ISO 3166 format\n * @returns An array of supported locales\n */\nexport function getSupportedLocales(region: Region): SupportedLocale[] {\n    const supportedLocales = region === 'US' ? SUPPORTED_LOCALES_US : SUPPORTED_LOCALES_EU;\n    return supportedLocales as unknown as SupportedLocale[];\n}\n\n/**\n * Gets a locale and matches it with one of the supported locales for the given region.\n * If there's no match, it will return the region's fallback option.\n * @param locale - Locale to be processed\n * @param region - Two-letter country code in ISO 3166 format\n * @returns A supported locale\n */\nexport function getCheckoutLocale(locale: string, region: Region): SupportedLocale {\n    const supportedLocales = getSupportedLocales(region);\n    const isSupportedLocale = supportedLocales.includes(locale as SupportedLocale);\n    const checkoutLocale = isSupportedLocale ? locale : getFallbackLocale(region);\n\n    return checkoutLocale as SupportedLocale;\n}\n\n/**\n * Gets the design code from the given alias.\n * @param design - The alias of one of the possible designs.\n * @returns A design code\n */\nexport function getDesignCode(design: string): string {\n    if (design === 'noTagline') return 'C0001';\n    return null;\n}\n\n/**\n * Returns the amount in the format Amazon expects.\n * @param amount - The amount object in the Adyen format\n * @returns the charge amount object in the Amazon format\n */\nexport function getChargeAmount(amount: PaymentAmount): ChargeAmount {\n    return {\n        amount: String(getDecimalAmount(amount.value, amount.currency)),\n        currencyCode: amount.currency as Currency\n    };\n}\n\n/**\n * Returns a PayloadJSON object.\n * @param props -\n * @returns PayloadJSON\n */\nexport function getPayloadJSON(props, amount: PaymentAmount): PayloadJSON {\n    const { addressDetails, cancelUrl, checkoutMode, deliverySpecifications, returnUrl, merchantMetadata, chargePermissionType, recurringMetadata } =\n        props;\n\n    const { storeId } = props.configuration;\n    const isPayNow = checkoutMode === 'ProcessOrder';\n    const finalAmount = isPayNow ? getChargeAmount(amount) : null;\n\n    return {\n        storeId,\n        chargePermissionType,\n        webCheckoutDetails: {\n            ...(isPayNow ? { checkoutResultReturnUrl: returnUrl } : { checkoutReviewReturnUrl: returnUrl }),\n            ...(cancelUrl && { checkoutCancelUrl: cancelUrl }),\n            ...(isPayNow && { checkoutMode })\n        },\n        ...(isPayNow && {\n            paymentDetails: {\n                chargeAmount: finalAmount,\n                paymentIntent: 'Confirm',\n                presentmentCurrency: finalAmount.currencyCode,\n                totalOrderAmount: finalAmount\n            }\n        }),\n        ...(recurringMetadata && { recurringMetadata }),\n        ...(merchantMetadata && { merchantMetadata }),\n        ...(deliverySpecifications && { deliverySpecifications }),\n        ...(addressDetails && { addressDetails })\n    };\n}\n"],"names":["getAmazonPayUrl","region","AMAZONPAY_URL_US","AMAZONPAY_URL_EU","getAmazonPaySettings","props","amount","_object_spread_props","_object_spread","buttonColor","design","getDesignCode","checkoutLanguage","getCheckoutLocale","locale","configuration","ledgerCurrency","LEDGER_CURRENCIES_PER_REGION","currency","merchantId","productType","placement","sandbox","environment","getFallbackLocale","FALLBACK_LOCALE_US","FALLBACK_LOCALE_EU","getSupportedLocales","SUPPORTED_LOCALES_US","SUPPORTED_LOCALES_EU","includes","getChargeAmount","String","getDecimalAmount","value","currencyCode","getPayloadJSON","addressDetails","cancelUrl","checkoutMode","deliverySpecifications","returnUrl","merchantMetadata","chargePermissionType","recurringMetadata","storeId","isPayNow","finalAmount","webCheckoutDetails","checkoutResultReturnUrl","checkoutReviewReturnUrl","checkoutCancelUrl","paymentDetails","chargeAmount","paymentIntent","presentmentCurrency","totalOrderAmount"],"mappings":"kjCAkBO,SAASA,EAAgBC,GAC5B,MAAkB,OAAXA,EAAkBC,EAAmBC,CAChD,CAOO,SAASC,EAAqBC,EAA6BC,GAC9D,OAAOC,EAAAC,EAAA,GACCH,EAAMI,aAAe,CAAEA,YAAaJ,EAAMI,aAC1CJ,EAAMK,QAAU,CAAEA,OAAQC,EAAcN,EAAMK,UAAQ,CAC1DE,iBAAkBC,EAAkBR,EAAMS,OAAQT,EAAMU,cAAcd,QACtEe,eAAgBC,EAA6BZ,EAAMU,cAAcd,SAAWI,EAAMa,WAAaZ,aAAAA,EAAAA,EAAQY,UACvGC,WAAYd,EAAMU,cAAcI,WAChCC,YAAaf,EAAMe,YACnBC,UAAWhB,EAAMgB,UACjBC,QAA+B,SAAtBjB,EAAMkB,aAEvB,CAOO,SAASC,EAAkBvB,GAC9B,MAAkB,OAAXA,EAAkBwB,EAAqBC,CAClD,CAOO,SAASC,EAAoB1B,GAEhC,MADoC,OAAXA,EAAkB2B,EAAuBC,CAEtE,CASO,SAAShB,EAAkBC,EAAgBb,GAK9C,OAJyB0B,EAAoB1B,GACF6B,SAAShB,GACTA,EAASU,EAAkBvB,EAG1E,CAOO,SAASU,EAAcD,GAC1B,MAAe,cAAXA,EAA+B,QAC5B,IACX,CAOO,SAASqB,EAAgBzB,GAC5B,MAAO,CACHA,OAAQ0B,OAAOC,EAAiB3B,EAAO4B,MAAO5B,EAAOY,WACrDiB,aAAc7B,EAAOY,SAE7B,CAOO,SAASkB,EAAe/B,EAAOC,GAClC,MAAM+B,eAAEA,EAAcC,UAAEA,EAASC,aAAEA,EAAYC,uBAAEA,EAAsBC,UAAEA,EAASC,iBAAEA,EAAgBC,qBAAEA,EAAoBC,kBAAEA,GACxHvC,GAEEwC,QAAEA,GAAYxC,EAAMU,cACpB+B,EAA4B,iBAAjBP,EACXQ,EAAcD,EAAWf,EAAgBzB,GAAU,KAEzD,OAAOE,EAAA,CACHqC,UACAF,uBACAK,mBAAoBxC,KACZsC,EAAW,CAAEG,wBAAyBR,GAAc,CAAES,wBAAyBT,GAC/EH,GAAa,CAAEa,kBAAmBb,GAClCQ,GAAY,CAAEP,kBAElBO,GAAY,CACZM,eAAgB,CACZC,aAAcN,EACdO,cAAe,UACfC,oBAAqBR,EAAYZ,aACjCqB,iBAAkBT,IAGtBH,GAAqB,CAAEA,qBACvBF,GAAoB,CAAEA,oBACtBF,GAA0B,CAAEA,0BAC5BH,GAAkB,CAAEA,kBAEhC"}