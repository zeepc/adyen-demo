{"version":3,"file":"GooglePayService.js","sources":["../../../../src/components/GooglePay/GooglePayService.ts"],"sourcesContent":["import { isReadyToPayRequest, initiatePaymentRequest } from './requests';\nimport { resolveEnvironment } from './utils';\nimport Script from '../../utils/Script';\nimport config from './config';\nimport type { GooglePayConfiguration } from './types';\nimport type { IAnalytics } from '../../core/Analytics/Analytics';\n\nclass GooglePayService {\n    private readonly analytics: IAnalytics;\n\n    public readonly paymentsClient: Promise<google.payments.api.PaymentsClient>;\n\n    constructor(environment: string, analytics: IAnalytics, paymentDataCallbacks: google.payments.api.PaymentDataCallbacks) {\n        const googlePayEnvironment = resolveEnvironment(environment);\n\n        this.analytics = analytics;\n        this.paymentsClient = this.getGooglePaymentsClient({\n            environment: googlePayEnvironment,\n            paymentDataCallbacks\n        });\n    }\n\n    /**\n     * Initialize a Google Pay API client\n     *\n     * @see {@link https://developers.google.com/pay/api/web/reference/client#PaymentsClient|PaymentsClient constructor}\n     * @returns Google Pay API client\n     */\n    async getGooglePaymentsClient(paymentOptions: google.payments.api.PaymentOptions): Promise<google.payments.api.PaymentsClient> {\n        if (!window.google?.payments) {\n            const script = new Script({ src: config.URL, component: 'googlepay', analytics: this.analytics });\n            await script.load();\n        }\n\n        return new google.payments.api.PaymentsClient(paymentOptions);\n    }\n\n    /**\n     * Determine a shopper's ability to return a form of payment from the Google Pay API.\n     * @see {@link https://developers.google.com/pay/api/web/reference/client#isReadyToPay|isReadyToPay}\n     */\n    isReadyToPay(props): Promise<google.payments.api.IsReadyToPayResponse> {\n        // eslint-disable-next-line @typescript-eslint/no-misused-promises\n        if (!this.paymentsClient) return Promise.reject(new Error('Google Pay is not available'));\n\n        return this.paymentsClient.then(client => client.isReadyToPay(isReadyToPayRequest(props)));\n    }\n\n    prefetchPaymentData(props: GooglePayConfiguration, countryCode: string): void {\n        // eslint-disable-next-line @typescript-eslint/no-misused-promises\n        if (!this.paymentsClient) throw new Error('Google Pay is not available');\n\n        const paymentDataRequest = initiatePaymentRequest(props, countryCode);\n        void this.paymentsClient.then(client => client.prefetchPaymentData(paymentDataRequest));\n    }\n\n    /**\n     * Show Google Pay payment sheet when Google Pay payment button is clicked\n     * @returns paymentData response from Google Pay API after user approves payment\n     * @see {@link https://developers.google.com/pay/api/web/reference/object#PaymentData|PaymentData object reference}\n     */\n    initiatePayment(props: GooglePayConfiguration, countryCode: string): Promise<google.payments.api.PaymentData> {\n        // eslint-disable-next-line @typescript-eslint/no-misused-promises\n        if (!this.paymentsClient) throw new Error('Google Pay is not available');\n\n        const paymentDataRequest = initiatePaymentRequest(props, countryCode);\n        return this.paymentsClient.then(client => client.loadPaymentData(paymentDataRequest));\n    }\n}\n\nexport default GooglePayService;\n"],"names":["GooglePayService","getGooglePaymentsClient","paymentOptions","window","google","payments","script","Script","src","config","URL","component","analytics","this","load","api","PaymentsClient","isReadyToPay","props","paymentsClient","then","client","isReadyToPayRequest","Promise","reject","Error","prefetchPaymentData","countryCode","paymentDataRequest","initiatePaymentRequest","initiatePayment","loadPaymentData","constructor","environment","paymentDataCallbacks","_define_property","googlePayEnvironment","resolveEnvironment"],"mappings":"wTAOA,MAAMA,EAqBF,6BAAMC,CAAwBC,GACrBC,IAAAA,EAAL,aAAKA,EAAAA,OAAOC,kBAAPD,OAAAA,EAAAA,EAAeE,UAAU,CAC1B,MAAMC,EAAS,IAAIC,EAAO,CAAEC,IAAKC,EAAOC,IAAKC,UAAW,YAAaC,UAAWC,KAAKD,kBAC/EN,EAAOQ,MACjB,CAEA,OAAO,IAAIV,OAAOC,SAASU,IAAIC,eAAed,EAClD,CAMAe,YAAAA,CAAaC,GAET,OAAKL,KAAKM,eAEHN,KAAKM,eAAeC,KAAKC,GAAUA,EAAOJ,aAAaK,EAAoBJ,KAFjDK,QAAQC,OAAO,IAAIC,MAAM,+BAG9D,CAEAC,mBAAAA,CAAoBR,EAA+BS,GAE/C,IAAKd,KAAKM,eAAgB,MAAM,IAAIM,MAAM,+BAE1C,MAAMG,EAAqBC,EAAuBX,EAAOS,GACpDd,KAAKM,eAAeC,KAAKC,GAAUA,EAAOK,oBAAoBE,GACvE,CAOAE,eAAAA,CAAgBZ,EAA+BS,GAE3C,IAAKd,KAAKM,eAAgB,MAAM,IAAIM,MAAM,+BAE1C,MAAMG,EAAqBC,EAAuBX,EAAOS,GACzD,OAAOd,KAAKM,eAAeC,KAAKC,GAAUA,EAAOU,gBAAgBH,GACrE,CAvDA,WAAAI,CAAYC,EAAqBrB,EAAuBsB,GAJxDC,EAAAtB,KAAiBD,oBAEjBuB,EAAAtB,KAAgBM,yBAGZ,MAAMiB,EAAuBC,EAAmBJ,GAEhDpB,KAAKD,UAAYA,EACjBC,KAAKM,eAAiBN,KAAKZ,wBAAwB,CAC/CgC,YAAaG,EACbF,wBAER"}