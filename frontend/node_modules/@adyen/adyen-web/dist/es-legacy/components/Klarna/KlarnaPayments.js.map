{"version":3,"file":"KlarnaPayments.js","sources":["../../../../src/components/Klarna/KlarnaPayments.tsx"],"sourcesContent":["import { h } from 'preact';\nimport UIElement from '../internal/UIElement/UIElement';\nimport PayButton from '../internal/PayButton';\nimport { KlarnaContainer } from './components/KlarnaContainer/KlarnaContainer';\nimport { TxVariants } from '../tx-variants';\nimport type { KlarnaAction, KlarnaAdditionalDetailsData, KlarnaComponentRef, KlarnaConfiguration } from './types';\nimport type { ICore } from '../../core/types';\nimport { PayButtonProps } from '../internal/PayButton/PayButton';\n\nclass KlarnaPayments extends UIElement<KlarnaConfiguration> {\n    public static type = TxVariants.klarna;\n    public static txVariants = [TxVariants.klarna, TxVariants.klarna_account, TxVariants.klarna_paynow, TxVariants.klarna_b2b];\n\n    public componentRef: KlarnaComponentRef;\n\n    protected static defaultProps = {\n        useKlarnaWidget: false\n    };\n\n    constructor(checkout: ICore, props?: KlarnaConfiguration) {\n        super(checkout, props);\n\n        this.onComplete = this.onComplete.bind(this);\n        this.updateWithAction = this.updateWithAction.bind(this);\n        this.submit = this.submit.bind(this);\n        this.onLoaded = this.onLoaded.bind(this);\n    }\n    get isValid() {\n        return true;\n    }\n\n    protected formatData() {\n        return {\n            paymentMethod: {\n                type: this.type,\n                ...(this.props.useKlarnaWidget ? { subtype: 'sdk' } : {})\n            }\n        };\n    }\n\n    public payButton = (props: PayButtonProps) => {\n        return <PayButton onClick={this.submit} {...props} />;\n    };\n\n    public override handleAction(action: KlarnaAction, props = {}): UIElement | null {\n        if (action.type === 'sdk') {\n            this.updateWithAction(action);\n            return;\n        }\n        return super.handleAction(action, props);\n    }\n\n    updateWithAction(action: KlarnaAction): void {\n        if (action.paymentMethodType !== this.type) throw new Error('Invalid Action');\n        this.componentRef.setAction(action);\n    }\n\n    private onLoaded() {\n        // When action/widget is loaded, set the 'drop-in' back to ready\n        this.setElementStatus('ready');\n    }\n\n    public override activate() {\n        this.componentRef.reinitializeWidget();\n    }\n\n    protected onComplete(details: KlarnaAdditionalDetailsData): void {\n        this.handleAdditionalDetails(details);\n    }\n\n    protected override componentToRender(): h.JSX.Element {\n        return (\n            <KlarnaContainer\n                {...this.props}\n                setComponentRef={this.setComponentRef}\n                displayName={this.displayName}\n                onComplete={this.onComplete}\n                onError={this.props.onError}\n                payButton={this.payButton}\n                onLoaded={this.onLoaded}\n                showPayButton={this.props.showPayButton}\n                onActionHandled={this.onActionHandled}\n                type={this.props.type}\n            />\n        );\n    }\n}\n\nexport default KlarnaPayments;\n"],"names":["KlarnaPayments","UIElement","isValid","formatData","paymentMethod","_object_spread","type","this","props","useKlarnaWidget","subtype","handleAction","action","super","updateWithAction","paymentMethodType","Error","componentRef","setAction","onLoaded","setElementStatus","activate","reinitializeWidget","onComplete","details","handleAdditionalDetails","componentToRender","h","KlarnaContainer","setComponentRef","displayName","onError","payButton","showPayButton","onActionHandled","constructor","checkout","_define_property","PayButton","onClick","submit","bind","TxVariants","klarna","txVariants","klarna_account","klarna_paynow","klarna_b2b","defaultProps"],"mappings":"gmCASA,MAAMA,UAAuBC,EAkBzB,WAAIC,GACA,OAAO,CACX,CAEUC,UAAAA,GACN,MAAO,CACHC,cAAeC,EAAA,CACXC,KAAMC,KAAKD,MACPC,KAAKC,MAAMC,gBAAkB,CAAEC,QAAS,OAAU,CAAA,GAGlE,CAMgBC,YAAAA,CAAaC,EAAsBJ,EAAQ,IACvD,GAAoB,QAAhBI,EAAON,KAIX,OAAOO,MAAMF,aAAaC,EAAQJ,GAH9BD,KAAKO,iBAAiBF,EAI9B,CAEAE,gBAAAA,CAAiBF,GACb,GAAIA,EAAOG,oBAAsBR,KAAKD,KAAM,MAAM,IAAIU,MAAM,kBAC5DT,KAAKU,aAAaC,UAAUN,EAChC,CAEQO,QAAAA,GAEJZ,KAAKa,iBAAiB,QAC1B,CAEgBC,QAAAA,GACZd,KAAKU,aAAaK,oBACtB,CAEUC,UAAAA,CAAWC,GACjBjB,KAAKkB,wBAAwBD,EACjC,CAEmBE,iBAAAA,GACf,OACIC,EAACC,EAAAA,EAAAA,EAAAA,GACOrB,KAAKC,OAAK,CACdqB,gBAAiBtB,KAAKsB,gBACtBC,YAAavB,KAAKuB,YAClBP,WAAYhB,KAAKgB,WACjBQ,QAASxB,KAAKC,MAAMuB,QACpBC,UAAWzB,KAAKyB,UAChBb,SAAUZ,KAAKY,SACfc,cAAe1B,KAAKC,MAAMyB,cAC1BC,gBAAiB3B,KAAK2B,gBACtB5B,KAAMC,KAAKC,MAAMF,OAG7B,CAlEA,WAAA6B,CAAYC,EAAiB5B,GACzBK,MAAMuB,EAAU5B,GAPpB6B,EAAA9B,KAAOU,oBAAP,GA2BAoB,EAAA9B,KAAOyB,YAAaxB,GACTmB,EAACW,EAAAA,EAAAA,CAAUC,QAAShC,KAAKiC,QAAYhC,KAnB5CD,KAAKgB,WAAahB,KAAKgB,WAAWkB,KAAKlC,MACvCA,KAAKO,iBAAmBP,KAAKO,iBAAiB2B,KAAKlC,MACnDA,KAAKiC,OAASjC,KAAKiC,OAAOC,KAAKlC,MAC/BA,KAAKY,SAAWZ,KAAKY,SAASsB,KAAKlC,KACvC,EAhBA8B,EADErC,EACYM,OAAOoC,EAAWC,QAChCN,EAFErC,EAEY4C,aAAa,CAACF,EAAWC,OAAQD,EAAWG,eAAgBH,EAAWI,cAAeJ,EAAWK,aAI/GV,EANErC,EAMegD,eAAe,CAC5BvC,iBAAiB"}