import{createElement as e}from"../../../../external/preact/dist/preact.js";import{useRef as t,useState as n,useCallback as o,useEffect as a}from"../../../../external/preact/hooks/dist/hooks.js";import r from"../../../../utils/Script.js";import{KLARNA_REFUSED_RESULT_CODE as i,KLARNA_WIDGET_URL as l}from"../../constants.js";import s from"../../../../core/Analytics/useAnalytics.js";function c(e,t){if(null==e)return{};var n,o,a,r={};if("undefined"!=typeof Reflect&&Reflect.ownKeys){for(n=Reflect.ownKeys(e),a=0;a<n.length;a++)o=n[a],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o]);return r}if(r=function(e,t){if(null==e)return{};var n,o,a={},r=Object.getOwnPropertyNames(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n]);return a}(e,t),Object.getOwnPropertySymbols)for(n=Object.getOwnPropertySymbols(e),a=0;a<n.length;a++)o=n[a],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o]);return r}function p(p){let{sdkData:m,paymentMethodType:y,widgetInitializationTime:d,payButton:u}=p,f=c(p,["sdkData","paymentMethodType","widgetInitializationTime","payButton"]);const w=t(null),[_,h]=n("ready"),{analytics:g}=s(),k=o(()=>{h("error"),f.onComplete({data:{paymentData:f.paymentData,details:{resultCode:i}}})},[f.paymentData,f.onComplete]),b=o(()=>{window.Klarna.Payments.init({client_token:m.client_token}),window.Klarna.Payments.load({container:w.current,payment_method_category:m.payment_method_category},function(e){!e.show_form||e.error?k():f.onLoaded()})},[m.client_token,m.payment_method_category]),v=o(()=>{h("loading");try{window.Klarna.Payments.authorize({payment_method_category:m.payment_method_category},function(e){!0===e.approved&&!0===e.show_form?(h("success"),f.onComplete({data:{paymentData:f.paymentData,details:{authorization_token:e.authorization_token}}})):e.approved||!0!==e.show_form?k():(h("ready"),f.onError(e))})}catch(e){k()}},[m.payment_method_category,f.onComplete,f.onError]),O=e=>{"Enter"!==e.key&&"Enter"!==e.code||(e.preventDefault(),v())};return a(()=>{var e,t;(null===(t=window.Klarna)||void 0===t||null===(e=t.Payments)||void 0===e?void 0:e.init)&&b()},[d]),a(()=>{window.klarnaAsyncCallback=function(){b()};const e=new r({src:l,component:"klarna",analytics:g});return e.load(),()=>{e.remove()}},[b,g]),"error"!==_&&"success"!==_?e("div",{className:"adyen-checkout__klarna-widget"},e("div",{ref:w}),u({status:_,disabled:"loading"===_,onClick:v,onKeyDown:O})):null}export{p as KlarnaWidget};
//# sourceMappingURL=KlarnaWidget.js.map
