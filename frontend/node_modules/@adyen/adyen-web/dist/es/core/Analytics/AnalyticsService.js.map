{"version":3,"file":"AnalyticsService.js","sources":["../../../../src/core/Analytics/AnalyticsService.ts"],"sourcesContent":["import AdyenCheckoutError from '../Errors/AdyenCheckoutError';\nimport { AbstractAnalyticsEvent } from './events/AbstractAnalyticsEvent';\nimport { HttpOptions, httpPost } from '../Services/http';\nimport type { ApplicationInfo } from './types';\n\nexport interface IAnalyticsService {\n    requestCheckoutAttemptId(payload: RequestAttemptIdPayload): Promise<string>;\n    sendEvents(payload: AnalyticsEventPayload, checkoutAttemptId: string): Promise<void>;\n    reportIntegrationFlavor(flavor: 'dropin' | 'components', checkoutAttemptId: string): Promise<void>;\n}\n\nexport interface RequestAttemptIdPayload {\n    version: string;\n    channel: 'Web';\n    platform: 'Web';\n    locale: string;\n    checkoutStage: 'precheckout' | 'checkout';\n    referrer: string;\n    screenWidth: number;\n    buildType: string;\n    level: 'initial' | 'all';\n    sessionId?: string;\n    checkoutAttemptId?: string;\n    applicationInfo?: ApplicationInfo;\n}\n\nexport interface AnalyticsEventPayload {\n    channel: 'Web';\n    platform: 'Web';\n    info: Array<AbstractAnalyticsEvent>;\n    errors: Array<AbstractAnalyticsEvent>;\n    logs: Array<AbstractAnalyticsEvent>;\n}\n\nexport interface AnalyticsFlavorPayload {\n    flavor: 'dropin' | 'components';\n    checkoutAttemptId: string;\n}\n\nconst ANALYTICS_PATH = 'v3/analytics';\n\nclass AnalyticsService implements IAnalyticsService {\n    private readonly clientKey: string;\n    private readonly analyticsContext: string;\n\n    constructor({ clientKey, analyticsContext }: { clientKey: string; analyticsContext: string }) {\n        this.clientKey = clientKey;\n        this.analyticsContext = analyticsContext;\n    }\n\n    public async requestCheckoutAttemptId(payload: RequestAttemptIdPayload) {\n        const httpOptions: HttpOptions = {\n            loadingContext: this.analyticsContext,\n            path: `${ANALYTICS_PATH}?clientKey=${this.clientKey}`\n        };\n\n        try {\n            const { checkoutAttemptId } = await httpPost<{ checkoutAttemptId: string }>(httpOptions, payload);\n            return checkoutAttemptId;\n        } catch (error: unknown) {\n            throw new AdyenCheckoutError('NETWORK_ERROR', 'requestCheckoutAttemptId() - failed to get checkout attempt ID', { cause: error });\n        }\n    }\n\n    public async sendEvents(payload: AnalyticsEventPayload, checkoutAttemptId: string): Promise<void> {\n        if (!checkoutAttemptId) {\n            throw new AdyenCheckoutError('IMPLEMENTATION_ERROR', 'sendEvents() - checkoutAttemptId is required');\n        }\n\n        // No events to be sent\n        if (!payload.info.length && !payload.errors.length && !payload.logs.length) {\n            return Promise.resolve();\n        }\n\n        const httpOptions: HttpOptions = {\n            loadingContext: this.analyticsContext,\n            path: `${ANALYTICS_PATH}/${checkoutAttemptId}?clientKey=${this.clientKey}`\n        };\n\n        try {\n            await httpPost(httpOptions, payload);\n        } catch (error: unknown) {\n            throw new AdyenCheckoutError('NETWORK_ERROR', 'sendEvents() - failed to send events', { cause: error });\n        }\n    }\n\n    public async reportIntegrationFlavor(flavor: 'dropin' | 'components', checkoutAttemptId: string): Promise<void> {\n        if (!flavor || !checkoutAttemptId) {\n            throw new AdyenCheckoutError('IMPLEMENTATION_ERROR', 'reportIntegrationFlavor() - flavor or checkoutAttemptId is required');\n        }\n\n        const httpOptions: HttpOptions = {\n            loadingContext: this.analyticsContext,\n            path: `${ANALYTICS_PATH}?clientKey=${this.clientKey}`\n        };\n\n        const payload: AnalyticsFlavorPayload = {\n            flavor,\n            checkoutAttemptId\n        };\n\n        try {\n            await httpPost(httpOptions, payload);\n        } catch (error: unknown) {\n            throw new AdyenCheckoutError('NETWORK_ERROR', 'reportIntegrationFlavor() - failed to send flavor', { cause: error });\n        }\n    }\n}\n\nexport { AnalyticsService };\n"],"names":["ANALYTICS_PATH","AnalyticsService","requestCheckoutAttemptId","payload","httpOptions","loadingContext","this","analyticsContext","path","clientKey","checkoutAttemptId","httpPost","error","AdyenCheckoutError","cause","sendEvents","info","length","errors","logs","Promise","resolve","reportIntegrationFlavor","flavor","constructor","_define_property"],"mappings":"sNAuCA,MAAMA,EAAiB,eAEvB,MAAMC,EASF,8BAAaC,CAAyBC,GAClC,MAAMC,EAA2B,CAC7BC,eAAgBC,KAAKC,iBACrBC,KAAM,GAAGR,eAA4BM,KAAKG,aAG9C,IACI,MAAMC,kBAAEA,SAA4BC,EAAwCP,EAAaD,GACzF,OAAOO,CACX,CAAE,MAAOE,GACL,MAAM,IAAIC,EAAmB,gBAAiB,iEAAkE,CAAEC,MAAOF,GAC7H,CACJ,CAEA,gBAAaG,CAAWZ,EAAgCO,GACpD,IAAKA,EACD,MAAM,IAAIG,EAAmB,uBAAwB,gDAIzD,IAAKV,EAAQa,KAAKC,SAAWd,EAAQe,OAAOD,SAAWd,EAAQgB,KAAKF,OAChE,OAAOG,QAAQC,UAGnB,MAAMjB,EAA2B,CAC7BC,eAAgBC,KAAKC,iBACrBC,KAAM,GAAGR,KAAkBU,eAA+BJ,KAAKG,aAGnE,UACUE,EAASP,EAAaD,EAChC,CAAE,MAAOS,GACL,MAAM,IAAIC,EAAmB,gBAAiB,uCAAwC,CAAEC,MAAOF,GACnG,CACJ,CAEA,6BAAaU,CAAwBC,EAAiCb,GAClE,IAAKa,IAAWb,EACZ,MAAM,IAAIG,EAAmB,uBAAwB,uEAGzD,MAAMT,EAA2B,CAC7BC,eAAgBC,KAAKC,iBACrBC,KAAM,GAAGR,eAA4BM,KAAKG,aAGxCN,EAAkC,CACpCoB,SACAb,qBAGJ,UACUC,EAASP,EAAaD,EAChC,CAAE,MAAOS,GACL,MAAM,IAAIC,EAAmB,gBAAiB,oDAAqD,CAAEC,MAAOF,GAChH,CACJ,CA7DA,WAAAY,EAAYf,UAAEA,EAASF,iBAAEA,IAHzBkB,EAAAnB,KAAiBG,oBACjBgB,EAAAnB,KAAiBC,2BAGbD,KAAKG,UAAYA,EACjBH,KAAKC,iBAAmBA,CAC5B"}