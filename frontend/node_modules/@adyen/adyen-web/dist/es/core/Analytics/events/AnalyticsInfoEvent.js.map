{"version":3,"file":"AnalyticsInfoEvent.js","sources":["../../../../../src/core/Analytics/events/AnalyticsInfoEvent.ts"],"sourcesContent":["import { AbstractAnalyticsEvent, AnalyticsEventCategory } from './AbstractAnalyticsEvent';\nimport { mapErrorCodesForAnalytics } from '../utils';\n\ntype AnalyticsInfoEventProps = {\n    type: InfoEventType;\n    component: string;\n    target?: UiTarget;\n    issuer?: string;\n    isExpress?: boolean;\n    expressPage?: string;\n    isStoredPaymentMethod?: boolean;\n    brand?: string;\n    validationErrorCode?: string;\n    validationErrorMessage?: string;\n    configData?: Record<string, any>;\n    cdnUrl?: string;\n    selectedValue?: string;\n};\n\nexport enum UiTarget {\n    instantPaymentButton = 'instant_payment_button',\n    dualBrandButton = 'dual_brand_button',\n    fastlaneSignupConsentToggle = 'fastlane_signup_consent_toggle',\n    otherPaymentMethodButton = 'otherpaymentmethod_button',\n    featuredIssuer = 'featured_issuer',\n    list = 'list',\n    listSearch = 'list_search',\n    qrDownloadButton = 'qr_download_button',\n    segmentedControl = 'segmented_control',\n    cardNumber = 'card_number',\n    expiryDate = 'expiry_date',\n    expiryMonth = 'expiry_month',\n    expiryYear = 'expiry_year',\n    securityCode = 'security_code'\n}\n\nexport enum InfoEventType {\n    /** When a UI element is clicked */\n    clicked = 'clicked',\n    /** When a component is rendered in the browser (e.g. render() method is called) */\n    rendered = 'rendered',\n    /** When a list item is selected (e.g. issuer list) */\n    selected = 'selected',\n    /** When there is a validation issue with the input */\n    validationError = 'validationError',\n    /** When input gets focus */\n    focus = 'focus',\n    /** When input gets unfocus */\n    unfocus = 'unfocus',\n    /** When iframe fields are configured */\n    configured = 'configured',\n    /** When a dropdown list is displayed */\n    displayed = 'displayed',\n    /** When shopper utilizes an input field to search for values (e.g. issuer list) */\n    input = 'input',\n    /** When shopper clicks to download the image (e.g. QR code image) */\n    download = 'download',\n    sdkDownloadInitiated = 'sdkDownloadInitiated',\n    sdkDownloadFailed = 'sdkDownloadFailed',\n    sdkDownloadAborted = 'sdkDownloadAborted',\n    sdkDownloadCompleted = 'sdkDownloadCompleted',\n    Initialized = 'initialized',\n    LookupStarted = 'lookupStarted',\n    LookupUserNotFound = 'lookupUserNotFound',\n    OtpStarted = 'otpStarted',\n    OtpSucceeded = 'otpSucceeded',\n    OtpCanceled = 'otpCanceled',\n    OtpFailed = 'otpFailed',\n    AddressSelectorClicked = 'addressSelectorClicked',\n    AddressSelectorClosed = 'addressSelectorClosed',\n    AddressChanged = 'addressChanged'\n}\n\nexport class AnalyticsInfoEvent extends AbstractAnalyticsEvent {\n    /**\n     * Analytics event type\n     */\n    private readonly type: InfoEventType;\n\n    /**\n     * Component config data set by the merchant. Sent only in 'rendered' events\n     * @private\n     */\n    private readonly configData?: Record<string, string | boolean>;\n    private readonly target?: UiTarget;\n    private readonly issuer?: string;\n    private readonly isExpress?: boolean;\n    private readonly expressPage?: string;\n    private readonly isStoredPaymentMethod?: boolean;\n    private readonly brand?: string;\n    private readonly selectedValue?: string;\n    private readonly validationErrorCode?: string;\n    private readonly validationErrorMessage?: string;\n\n    /**\n     *  Third party script URL's (e.g. Apple Pay)\n     */\n    public cdnUrl?: string;\n\n    constructor(props: AnalyticsInfoEventProps) {\n        super(props.component);\n\n        this.type = props.type;\n\n        if (props.target) this.target = props.target;\n        if (props.issuer) this.issuer = props.issuer;\n        if (props.isStoredPaymentMethod !== undefined) this.isStoredPaymentMethod = props.isStoredPaymentMethod;\n        if (props.isExpress !== undefined) this.isExpress = props.isExpress;\n        if (props.expressPage) this.expressPage = props.expressPage;\n        if (props.brand) this.brand = props.brand;\n        if (props.cdnUrl) this.cdnUrl = props.cdnUrl;\n        if (props.selectedValue) this.selectedValue = props.selectedValue;\n        if (props.validationErrorCode) this.validationErrorCode = props.validationErrorCode;\n        if (props.validationErrorMessage) this.validationErrorMessage = props.validationErrorMessage;\n        if (this.type === InfoEventType.rendered) {\n            this.configData = this.createAnalyticsConfigData(props?.configData);\n        }\n\n        // Some of the more generic validation error codes required combination with target to retrieve a specific code\n        if (this.type === InfoEventType.validationError) {\n            this.validationErrorCode = mapErrorCodesForAnalytics(this.validationErrorCode, this.target);\n        }\n    }\n\n    /**\n     * Set of properties that must not be included when creating the configData for Analytics\n     * @private\n     */\n    private get configDataExcludedFields() {\n        const DROPIN_FIELDS = ['paymentMethodsConfiguration'];\n        const FIELDS_INJECTED_BY_DROPIN = [\n            'elementRef',\n            'isDropin',\n            'oneClick',\n            'storedPaymentMethodId',\n            'paymentMethodId',\n            'isInstantPayment',\n            'type'\n        ];\n        const PII_FIELDS = ['data', 'holderName', 'shopperEmail', 'email', 'telephoneNumber', 'clickToPayConfiguration'];\n\n        /**\n         * TODO: Many unit tests are passing 'modules' as props, which leads to circular structure issue\n         * The components must use the 'modules' from the core and not from the props\n         */\n        const UNIT_TEST_FIELDS = ['modules', 'i18n'];\n\n        return [...DROPIN_FIELDS, ...FIELDS_INJECTED_BY_DROPIN, ...PII_FIELDS, ...UNIT_TEST_FIELDS];\n    }\n\n    /**\n     * Creates a serializable analytics payload from the given config object.\n     * Functions are replaced with 'function', and objects/arrays are stringified.\n     */\n    private createAnalyticsConfigData(config: Record<string, any>) {\n        if (!config) return {};\n\n        const MAX_STRING_LENGTH = 128;\n        const result: Record<string, string> = {};\n\n        try {\n            for (const [key, value] of Object.entries(config)) {\n                if (!this.configDataExcludedFields.includes(key)) {\n                    if (typeof value === 'function') {\n                        result[key] = 'function';\n                    } else if (Array.isArray(value)) {\n                        result[key] = value.join(', ').substring(0, MAX_STRING_LENGTH);\n                    } else if (typeof value === 'object' && value !== null) {\n                        result[key] = JSON.stringify(value).substring(0, MAX_STRING_LENGTH);\n                    } else {\n                        result[key] = value;\n                    }\n                }\n            }\n\n            return result;\n        } catch (error: unknown) {\n            if (process.env.NODE_ENV === 'development') console.warn('AnalyticsInfoEvent: Error when creating configData\\n', error);\n            return result;\n        }\n    }\n\n    public getEventCategory(): AnalyticsEventCategory {\n        return AnalyticsEventCategory.info;\n    }\n}\n"],"names":["UiTarget","InfoEventType","AnalyticsInfoEvent","AbstractAnalyticsEvent","configDataExcludedFields","createAnalyticsConfigData","config","result","key","value","Object","entries","this","includes","Array","isArray","join","substring","JSON","stringify","error","getEventCategory","AnalyticsEventCategory","info","constructor","props","super","component","_define_property","type","configData","target","issuer","isExpress","expressPage","isStoredPaymentMethod","brand","selectedValue","validationErrorCode","validationErrorMessage","cdnUrl","undefined","mapErrorCodesForAnalytics"],"mappings":"iRAmBO,IAAAA,EAAKA,SAAAA,GAAAA,2fAAAA,CAeZ,CAfYA,CAeZ,CAAA,GAEOC,EAAKA,SAAAA,GAAAA,OACyBA,EAAA,QAAA,UAEgDA,EAAA,SAAA,WAE7BA,EAAA,SAAA,WAEAA,EAAA,gBAAA,kBAE1BA,EAAA,MAAA,QAEEA,EAAA,QAAA,UAEUA,EAAA,WAAA,aAEAA,EAAA,UAAA,YAE2CA,EAAA,MAAA,QAEdA,EAAA,SAAA,+gBAnB3DA,CAmCZ,CAnCYA,CAmCZ,CAAA,GAEO,MAAMC,UAA2BC,EAuDpC,4BAAYC,GAmBR,MAAO,CAlBgB,8BAEnB,aACA,WACA,WACA,wBACA,kBACA,mBACA,OAEgB,OAAQ,aAAc,eAAgB,QAAS,kBAAmB,0BAM5D,UAAW,OAGzC,CAMQC,yBAAAA,CAA0BC,GAC9B,IAAKA,EAAQ,MAAO,CAAA,EAEpB,MACMC,EAAiC,CAAA,EAEvC,IACI,IAAK,MAAOC,EAAKC,KAAUC,OAAOC,QAAQL,GACjCM,KAAKR,yBAAyBS,SAASL,KACnB,mBAAVC,EACPF,EAAOC,GAAO,WACPM,MAAMC,QAAQN,GACrBF,EAAOC,GAAOC,EAAMO,KAAK,MAAMC,UAAU,EAT/B,KAWVV,EAAOC,GADiB,iBAAVC,GAAgC,OAAVA,EACtBS,KAAKC,UAAUV,GAAOQ,UAAU,EAXpC,KAaIR,GAK1B,OAAOF,CACX,CAAE,MAAOa,GAEL,OAAOb,CACX,CACJ,CAEOc,gBAAAA,GACH,OAAOC,EAAuBC,IAClC,CArFA,WAAAC,CAAYC,GACRC,MAAMD,EAAME,WAvBhBC,EAAAhB,KAAiBiB,eAMjBD,OAAiBE,qBACjBF,EAAAhB,KAAiBmB,iBACjBH,EAAAhB,KAAiBoB,cAAjB,GACAJ,EAAAhB,KAAiBqB,iBAAjB,GACAL,OAAiBM,mBAAjB,GACAN,EAAAhB,KAAiBuB,6BAAjB,GACAP,OAAiBQ,aAAjB,GACAR,EAAAhB,KAAiByB,wBACjBT,OAAiBU,8BACjBV,EAAAhB,KAAiB2B,iCAKjBX,EAAAhB,KAAO4B,iBAKH5B,KAAKiB,KAAOJ,EAAMI,KAEdJ,EAAMM,SAAQnB,KAAKmB,OAASN,EAAMM,QAClCN,EAAMO,SAAQpB,KAAKoB,OAASP,EAAMO,aACFS,IAAhChB,EAAMU,wBAAqCvB,KAAKuB,sBAAwBV,EAAMU,4BAC1DM,IAApBhB,EAAMQ,YAAyBrB,KAAKqB,UAAYR,EAAMQ,WACtDR,EAAMS,cAAatB,KAAKsB,YAAcT,EAAMS,aAC5CT,EAAMW,QAAOxB,KAAKwB,MAAQX,EAAMW,OAChCX,EAAMe,SAAQ5B,KAAK4B,OAASf,EAAMe,QAClCf,EAAMY,gBAAezB,KAAKyB,cAAgBZ,EAAMY,eAChDZ,EAAMa,sBAAqB1B,KAAK0B,oBAAsBb,EAAMa,qBAC5Db,EAAMc,yBAAwB3B,KAAK2B,uBAAyBd,EAAMc,wBACzD,aAAT3B,KAAKiB,OACLjB,KAAKkB,WAAalB,KAAKP,0BAA0BoB,GAAOK,aAI/C,oBAATlB,KAAKiB,OACLjB,KAAK0B,oBAAsBI,EAA0B9B,KAAK0B,oBAAqB1B,KAAKmB,QAE5F"}