{"version":3,"file":"http.js","sources":["../../../../src/core/Services/http.ts"],"sourcesContent":["import { DEFAULT_HTTP_TIMEOUT, FALLBACK_CONTEXT } from '../config';\nimport AdyenCheckoutError from '../Errors/AdyenCheckoutError';\n\nexport interface HttpOptions {\n    accept?: string;\n    contentType?: string;\n    headers?;\n    loadingContext?: string;\n    method?: string;\n    path: string;\n    timeout?: number;\n    errorLevel?: ErrorLevel;\n    errorMessage?: string;\n    errorCode?: string;\n}\n\ninterface FetchErrorOptions {\n    message?: string;\n    level?: ErrorLevel;\n    cause?: unknown;\n    code?: string;\n}\n\ntype ErrorLevel = 'silent' | 'info' | 'warn' | 'error' | 'fatal';\n\ntype AdyenApiErrorResponse = {\n    errorCode: string;\n    message: string;\n    errorType: string;\n    status: number;\n};\n\nfunction isAdyenApiErrorResponse(data: any): data is AdyenApiErrorResponse {\n    return data && data.errorCode && data.errorType && data.message && data.status;\n}\n\nexport function http<T>(options: HttpOptions, payload?: any): Promise<T> {\n    const {\n        headers = [],\n        errorLevel = 'warn',\n        errorCode,\n        loadingContext = FALLBACK_CONTEXT,\n        method = 'GET',\n        path,\n        timeout = DEFAULT_HTTP_TIMEOUT\n    } = options;\n\n    const request: RequestInit = {\n        method,\n        mode: 'cors',\n        cache: 'default',\n        credentials: 'same-origin',\n        headers: {\n            Accept: 'application/json, text/plain, */*',\n            'Content-Type': method === 'POST' ? 'application/json' : 'text/plain',\n            ...headers\n        },\n        redirect: 'follow',\n        referrerPolicy: 'no-referrer-when-downgrade',\n        ...(AbortSignal?.timeout && { signal: AbortSignal?.timeout(timeout) }),\n        ...(payload && { body: JSON.stringify(payload) })\n    };\n\n    const url = `${loadingContext}${path}`;\n\n    return (\n        fetch(url, request)\n            .then(async response => {\n                // Handle empty responses (e.g., 204 No Content)\n                if (response.status === 204) {\n                    return;\n                }\n\n                const data = await response.json();\n\n                if (response.ok) {\n                    return data;\n                }\n\n                if (isAdyenApiErrorResponse(data)) {\n                    handleFetchError({ message: data.message, level: errorLevel, cause: data, code: errorCode });\n                    return;\n                }\n\n                const errorMessage = options.errorMessage || `Service at ${url} is not available`;\n                handleFetchError({ message: errorMessage, level: errorLevel, cause: data, code: errorCode });\n                return;\n            })\n            /**\n             * Catch block handles Network error, CORS error, or exception throw by the `handleFetchError`\n             * inside the `then` block\n             */\n            .catch((error: unknown) => {\n                /**\n                 * If error is instance of AdyenCheckoutError, which means that it was already\n                 * handled by the `handleFetchError` on the `then` block, then we just throw it.\n                 * There is no need to create it again\n                 */\n                if (error instanceof AdyenCheckoutError) {\n                    throw error;\n                }\n\n                // eslint-disable-next-line @typescript-eslint/no-base-to-string,@typescript-eslint/restrict-template-expressions\n                const errorMessage = options.errorMessage || `Call to ${url} failed. Error= ${error}`;\n                handleFetchError({ message: errorMessage, level: errorLevel, cause: error, code: errorCode });\n            })\n    );\n}\n\nfunction handleFetchError({ message, level, cause, code }: FetchErrorOptions): void {\n    switch (level) {\n        case 'silent': {\n            break;\n        }\n        case 'info':\n        case 'warn':\n        case 'error': {\n            console[level](message);\n            break;\n        }\n        default:\n            throw new AdyenCheckoutError('NETWORK_ERROR', message, { cause, code });\n    }\n}\n\nexport function httpGet<T = any>(options: HttpOptions, data?: any): Promise<T> {\n    return http<T>({ ...options, method: 'GET' }, data);\n}\n\nexport function httpPost<T = any>(options: HttpOptions, data?: any): Promise<T> {\n    return http<T>({ ...options, method: 'POST' }, data);\n}\n"],"names":["http","options","payload","headers","errorLevel","errorCode","loadingContext","FALLBACK_CONTEXT","method","path","timeout","DEFAULT_HTTP_TIMEOUT","request","mode","cache","credentials","Accept","redirect","referrerPolicy","AbortSignal","signal","body","JSON","stringify","url","fetch","then","async","response","status","data","json","ok","errorType","message","isAdyenApiErrorResponse","handleFetchError","level","cause","code","errorMessage","catch","error","AdyenCheckoutError","console","httpGet","httpPost"],"mappings":"yHAoCO,SAASA,EAAQC,EAAsBC,GAC1C,MAAMC,QACFA,EAAU,GAAEC,WACZA,EAAa,OAAMC,UACnBA,EAASC,eACTA,EAAiBC,EAAgBC,OACjCA,EAAS,MAAKC,KACdA,EAAIC,QACJA,EAAUC,GACVV,EAEEW,EAAuB,CACzBJ,SACAK,KAAM,OACNC,MAAO,UACPC,YAAa,cACbZ,QAAS,CACLa,OAAQ,oCACR,eAA2B,SAAXR,EAAoB,mBAAqB,gBACtDL,GAEPc,SAAU,SACVC,eAAgB,gCACZC,aAAaT,SAAW,CAAEU,OAAQD,aAAaT,QAAQA,OACvDR,GAAW,CAAEmB,KAAMC,KAAKC,UAAUrB,KAGpCsB,EAAM,GAAGlB,IAAiBG,IAEhC,OACIgB,MAAMD,EAAKZ,GACNc,KAAKC,MAAMC,IAER,GAAwB,MAApBA,EAASC,OACT,OAGJ,MAAMC,QAAaF,EAASG,OAE5B,GAAIH,EAASI,GACT,OAAOF,EAGX,GA/ChB,SAAiCA,GAC7B,OAAOA,GAAQA,EAAKzB,WAAayB,EAAKG,WAAaH,EAAKI,SAAWJ,EAAKD,MAC5E,CA6CoBM,CAAwBL,GAExB,YADAM,EAAiB,CAAEF,QAASJ,EAAKI,QAASG,MAAOjC,EAAYkC,MAAOR,EAAMS,KAAMlC,IAKpF+B,EAAiB,CAAEF,QADEjC,EAAQuC,cAAgB,cAAchB,qBACjBa,MAAOjC,EAAYkC,MAAOR,EAAMS,KAAMlC,MAOnFoC,MAAOC,IAMJ,GAAIA,aAAiBC,EACjB,MAAMD,EAKVN,EAAiB,CAAEF,QADEjC,EAAQuC,cAAgB,WAAWhB,oBAAsBkB,IACpCL,MAAOjC,EAAYkC,MAAOI,EAAOH,KAAMlC,KAGjG,CAEA,SAAS+B,GAAiBF,QAAEA,EAAOG,MAAEA,EAAKC,MAAEA,EAAKC,KAAEA,IAC/C,OAAQF,GACJ,IAAK,SACD,MAEJ,IAAK,OACL,IAAK,OACL,IAAK,QACDO,QAAQP,GAAOH,GACf,MAEJ,QACI,MAAM,IAAIS,EAAmB,gBAAiBT,EAAS,CAAEI,QAAOC,SAE5E,CAEO,SAASM,EAAiB5C,EAAsB6B,GACnD,OAAO9B,EAAQ,IAAKC,EAASO,OAAQ,OAASsB,EAClD,CAEO,SAASgB,EAAkB7C,EAAsB6B,GACpD,OAAO9B,EAAQ,IAAKC,EAASO,OAAQ,QAAUsB,EACnD"}