{"version":3,"file":"AchComponent.js","sources":["../../../../../src/components/Ach/components/AchComponent.tsx"],"sourcesContent":["import { h } from 'preact';\nimport { useCallback, useEffect, useMemo, useRef, useState } from 'preact/hooks';\nimport { useCoreContext } from '../../../core/Context/CoreProvider';\nimport FormInstruction from '../../internal/FormInstruction';\nimport { AccountTypeSelector } from './AccountTypeSelector';\nimport Fieldset from '../../internal/FormFields/Fieldset';\nimport useForm from '../../../utils/useForm';\nimport Field from '../../internal/FormFields/Field';\nimport InputText from '../../internal/FormFields/InputText';\nimport { achValidationRules, achFormatters } from './validate';\nimport StoreDetails from '../../internal/StoreDetails';\nimport useSRPanelForAchErrors from './useSRPanelForACHErrors';\nimport useImage from '../../../core/Context/useImage';\nimport { PREFIX } from '../../internal/Icon/constants';\n\nimport type { PayButtonProps } from '../../internal/PayButton/PayButton';\nimport type { ComponentMethodsRef } from '../../internal/UIElement/types';\nimport type { AchPlaceholders } from '../types';\nimport type { AchStateErrors } from './useSRPanelForACHErrors';\n\ntype AchForm = {\n    selectedAccountType: string;\n    ownerName: string;\n    routingNumber: string;\n    accountNumber: string;\n    accountNumberVerification: string;\n};\n\nexport type AchFormPrefillData = Partial<Pick<AchForm, 'ownerName'>>;\n\ninterface AchComponentProps {\n    onChange({\n        data,\n        valid,\n        errors,\n        isValid,\n        storePaymentMethod\n    }: {\n        data: AchForm;\n        valid: { [key: string]: boolean };\n        errors: { [key: string]: any };\n        isValid: boolean;\n        storePaymentMethod: boolean;\n    }): void;\n    payButton: (props: PayButtonProps) => h.JSX.Element;\n    setComponentRef: (ref: ComponentMethodsRef) => void;\n    hasHolderName: boolean;\n    showPayButton: boolean;\n    enableStoreDetails: boolean;\n    placeholders?: AchPlaceholders;\n    data?: AchFormPrefillData;\n}\n\nfunction AchComponent({\n    onChange,\n    payButton,\n    showPayButton,\n    placeholders,\n    data: defaultData,\n    hasHolderName,\n    setComponentRef,\n    enableStoreDetails\n}: AchComponentProps) {\n    const getImage = useImage();\n    const schema = useMemo(\n        () => ['selectedAccountType', 'routingNumber', 'accountNumber', 'accountNumberVerification', ...(hasHolderName ? ['ownerName'] : [])],\n        [hasHolderName]\n    );\n    const { i18n } = useCoreContext();\n    const [status, setStatus] = useState('ready');\n    const { handleChangeFor, triggerValidation, data, errors, valid, isValid } = useForm<AchForm>({\n        schema,\n        defaultData,\n        rules: achValidationRules,\n        formatters: achFormatters\n    });\n    const [storePaymentMethod, setStorePaymentMethod] = useState(false);\n    const isFormDisabled = status === 'loading';\n\n    const isValidating = useRef(false);\n\n    const achRef = useRef<ComponentMethodsRef>({\n        setStatus: setStatus,\n        showValidation: () => {\n            isValidating.current = true;\n            triggerValidation();\n        }\n    });\n\n    useEffect(() => {\n        setComponentRef(achRef.current);\n    }, [setComponentRef, achRef.current]);\n\n    useSRPanelForAchErrors({ errors: errors as AchStateErrors, data, isValidating });\n\n    useEffect(() => {\n        onChange({ data, valid, errors, isValid, storePaymentMethod });\n    }, [onChange, data, valid, errors, isValid, storePaymentMethod]);\n\n    /**\n     * If the \"Verify account number\" field has errors, we want to trigger\n     * its validation when there is any change done to the \"Account number\" field\n     */\n    const onAccountNumberInput = useCallback(\n        (event: h.JSX.TargetedInputEvent<HTMLInputElement>) => {\n            handleChangeFor('accountNumber', 'input')(event);\n\n            const hasAccountVerificationError = !!errors.accountNumberVerification;\n            if (hasAccountVerificationError) {\n                triggerValidation(['accountNumberVerification']);\n            }\n        },\n        [handleChangeFor, triggerValidation, data.accountNumberVerification, errors.accountNumberVerification]\n    );\n\n    return (\n        <div className=\"adyen-checkout__ach\">\n            <FormInstruction />\n\n            <Fieldset classNameModifiers={[]} label={i18n.get('ach.bankAccount.title')}>\n                <AccountTypeSelector\n                    placeholder={placeholders?.accountTypeSelector}\n                    onSelect={handleChangeFor('selectedAccountType')}\n                    selectedAccountType={data.selectedAccountType}\n                    disabled={isFormDisabled}\n                    errorMessage={!!errors.selectedAccountType && i18n.get(errors.selectedAccountType.errorMessage)}\n                />\n\n                {hasHolderName && (\n                    <Field\n                        label={i18n.get('ach.accountHolderNameField.title')}\n                        errorMessage={!!errors.ownerName && i18n.get(errors.ownerName.errorMessage)}\n                        isValid={!!valid.ownerName}\n                        name={'ownerName'}\n                    >\n                        <InputText\n                            disabled={isFormDisabled}\n                            name={'ownerName'}\n                            placeholder={placeholders?.ownerName}\n                            value={data.ownerName}\n                            onInput={handleChangeFor('ownerName', 'input')}\n                            onBlur={handleChangeFor('ownerName', 'blur')}\n                            required={true}\n                        />\n                    </Field>\n                )}\n\n                <Field\n                    label={i18n.get('ach.routingNumber.label')}\n                    classNameModifiers={['col-60']}\n                    errorMessage={!!errors.routingNumber && i18n.get(errors.routingNumber.errorMessage)}\n                    name={'routingNumber'}\n                    isValid={!!valid.routingNumber}\n                >\n                    <InputText\n                        disabled={isFormDisabled}\n                        name={'routingNumber'}\n                        placeholder={placeholders?.routingNumber}\n                        value={data.routingNumber}\n                        onInput={handleChangeFor('routingNumber', 'input')}\n                        onBlur={handleChangeFor('routingNumber', 'blur')}\n                        required={true}\n                        maxlength={9}\n                    />\n                </Field>\n\n                <Field\n                    label={i18n.get('ach.bankAccountNumber.label')}\n                    classNameModifiers={['col-40']}\n                    errorMessage={!!errors.accountNumber && i18n.get(errors.accountNumber.errorMessage)}\n                    isValid={!!valid.accountNumber}\n                    name={'accountNumber'}\n                >\n                    <InputText\n                        disabled={isFormDisabled}\n                        name={'accountNumber'}\n                        placeholder={placeholders?.accountNumber}\n                        value={data.accountNumber}\n                        onInput={onAccountNumberInput}\n                        onBlur={handleChangeFor('accountNumber', 'blur')}\n                        required={true}\n                        maxlength={17}\n                    />\n                </Field>\n\n                <Field\n                    label={i18n.get('ach.bankAccountNumberVerification.label')}\n                    errorMessage={!!errors.accountNumberVerification && i18n.get(errors.accountNumberVerification.errorMessage)}\n                    name={'accountNumberVerification'}\n                    isValid={!!valid.accountNumberVerification}\n                >\n                    <InputText\n                        disabled={isFormDisabled}\n                        name={'accountNumberVerification'}\n                        placeholder={placeholders?.accountNumberVerification}\n                        value={data.accountNumberVerification}\n                        onInput={handleChangeFor('accountNumberVerification', 'input')}\n                        onBlur={handleChangeFor('accountNumberVerification', 'blur')}\n                        required={true}\n                        maxlength={17}\n                    />\n                </Field>\n            </Fieldset>\n\n            {enableStoreDetails && <StoreDetails disabled={isFormDisabled} onChange={setStorePaymentMethod} />}\n\n            {showPayButton && payButton({ status, icon: getImage({ imageFolder: 'components/' })(`${PREFIX}lock`) })}\n        </div>\n    );\n}\n\nexport default AchComponent;\n"],"names":["AchComponent","onChange","payButton","showPayButton","placeholders","data","defaultData","hasHolderName","setComponentRef","enableStoreDetails","getImage","useImage","schema","useMemo","i18n","useCoreContext","status","setStatus","useState","handleChangeFor","triggerValidation","errors","valid","isValid","useForm","rules","achValidationRules","formatters","achFormatters","storePaymentMethod","setStorePaymentMethod","isFormDisabled","isValidating","useRef","achRef","showValidation","current","useEffect","useSRPanelForAchErrors","onAccountNumberInput","useCallback","event","accountNumberVerification","h","div","className","FormInstruction","Fieldset","classNameModifiers","label","get","AccountTypeSelector","placeholder","accountTypeSelector","onSelect","selectedAccountType","disabled","errorMessage","Field","ownerName","name","InputText","value","onInput","onBlur","required","routingNumber","maxlength","accountNumber","StoreDetails","icon","imageFolder","PREFIX"],"mappings":"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"}