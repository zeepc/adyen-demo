import{createElement as t}from"../../../../external/preact/dist/preact.js";import{useRef as e,useState as a,useCallback as o,useEffect as n}from"../../../../external/preact/hooks/dist/hooks.js";import r from"../../../../utils/Script.js";import{KLARNA_REFUSED_RESULT_CODE as s,KLARNA_WIDGET_URL as i}from"../../constants.js";import c from"../../../../core/Analytics/useAnalytics.js";function m({sdkData:m,paymentMethodType:l,widgetInitializationTime:d,payButton:y,...p}){const u=e(null),[_,f]=a("ready"),{analytics:h}=c(),w=o(()=>{f("error"),p.onComplete({data:{paymentData:p.paymentData,details:{resultCode:s}}})},[p.paymentData,p.onComplete]),k=o(()=>{window.Klarna.Payments.init({client_token:m.client_token}),window.Klarna.Payments.load({container:u.current,payment_method_category:m.payment_method_category},function(t){!t.show_form||t.error?w():p.onLoaded()})},[m.client_token,m.payment_method_category]),g=o(()=>{f("loading");try{window.Klarna.Payments.authorize({payment_method_category:m.payment_method_category},function(t){!0===t.approved&&!0===t.show_form?(f("success"),p.onComplete({data:{paymentData:p.paymentData,details:{authorization_token:t.authorization_token}}})):t.approved||!0!==t.show_form?w():(f("ready"),p.onError(t))})}catch(t){w()}},[m.payment_method_category,p.onComplete,p.onError]),C=t=>{"Enter"!==t.key&&"Enter"!==t.code||(t.preventDefault(),g())};return n(()=>{const t=window.Klarna?.Payments?.init;t&&k()},[d]),n(()=>{window.klarnaAsyncCallback=function(){k()};const t=new r({src:i,component:"klarna",analytics:h});return t.load(),()=>{t.remove()}},[k,h]),"error"!==_&&"success"!==_?t("div",{className:"adyen-checkout__klarna-widget"},t("div",{ref:u}),y({status:_,disabled:"loading"===_,onClick:g,onKeyDown:C})):null}export{m as KlarnaWidget};
//# sourceMappingURL=KlarnaWidget.js.map
