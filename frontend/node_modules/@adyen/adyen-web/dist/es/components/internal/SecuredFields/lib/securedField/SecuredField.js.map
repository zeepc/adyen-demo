{"version":3,"file":"SecuredField.js","sources":["../../../../../../../src/components/internal/SecuredFields/lib/securedField/SecuredField.ts"],"sourcesContent":["import * as logger from '../utilities/logger';\nimport createIframe from './utils/createIframe';\nimport { removeAllChildren, selectOne } from '../utilities/dom';\nimport { off, on } from '../../../../../utils/listenerUtils';\nimport postMessageToIframe from '../CSF/utils/iframes/postMessageToIframe';\nimport { isChromeVoxPostMsg, isWebpackPostMsg, originCheckPassed } from '../CSF/utils/iframes/postMessageValidation';\nimport {\n    CVC_POLICY_HIDDEN,\n    CVC_POLICY_OPTIONAL,\n    DATE_POLICY_HIDDEN,\n    DATE_POLICY_OPTIONAL,\n    ENCRYPTED_EXPIRY_DATE,\n    ENCRYPTED_EXPIRY_MONTH,\n    ENCRYPTED_EXPIRY_YEAR,\n    ENCRYPTED_SECURITY_CODE\n} from '../constants';\nimport { generateRandomNumber } from '../utilities/commonUtils';\nimport { CVCPolicyType, DatePolicyType, RtnType_callbackFn, RtnType_noParamVoidFn, RtnType_postMessageListener, SFFeedbackObj } from '../types';\nimport AbstractSecuredField from './AbstractSecuredField';\nimport { AriaConfig, IframeConfigObject, SecuredFieldSetupObject, SecuredFieldCommonProps } from '../types';\nimport { reject } from '../../../../../utils/commonUtils';\nimport { processAriaConfig } from './utils/processAriaConfig';\nimport { processPlaceholders } from './utils/processPlaceholders';\nimport Language from '../../../../../language/Language';\nimport { hasOwnProperty } from '../../../../../utils/hasOwnProperty';\nimport { Placeholders } from '../../SFP/types';\nimport './SecuredField.scss';\nimport { AnalyticsErrorEvent, ErrorEventCode, ErrorEventType } from '../../../../../core/Analytics/events/AnalyticsErrorEvent';\n\nconst logPostMsg = false;\nconst doLog = false;\n\nclass SecuredField extends AbstractSecuredField {\n    constructor(pSetupObj: SecuredFieldSetupObject, i18n: Language) {\n        super();\n\n        /**\n         * List of props to exclude from being set on this.sfConfig.\n         * These props are only required for internal purposes. They do not get sent to the iframe\n         */\n        const deltaPropsArr: string[] = ['loadingContext', 'holderEl', 'iframeSrc', 'showContextualElement', 'placeholders'];\n\n        /**\n         * List of props from setup object that will be set on this.sfConfig\n         * These props will all end up being sent to the iframe\n         */\n        const configVarsFromSetUpObj = reject(deltaPropsArr).from(pSetupObj);\n\n        // Copy passed setup object values to this.sfConfig\n        this.sfConfig = {\n            // ...this.sfConfig, // Do we need to do this? Pretty sure we don't\n            ...configVarsFromSetUpObj,\n            // Break references on iframeUIConfig object so we can overwrite its properties in each securedField instance\n            iframeUIConfig: { ...configVarsFromSetUpObj.iframeUIConfig }\n        } as SecuredFieldCommonProps;\n\n        /**\n         * Extract values only needed for init\n         */\n        const { iframeSrc, placeholders, showContextualElement } = pSetupObj;\n\n        /**\n         * Store those passed setup object values that are needed in multiple functions\n         */\n        this.loadingContext = pSetupObj.loadingContext;\n        this.holderEl = pSetupObj.holderEl;\n        this.submitAnalytics = pSetupObj.submitAnalytics;\n        this.componentType = pSetupObj.componentType;\n\n        /**\n         * Initiate other values on 'this' through setters\n         */\n        this.isValid = false;\n        this.iframeContentWindow = null;\n        this.numKey = generateRandomNumber();\n        this.isEncrypted = false;\n        this.hasError = false;\n        this.errorType = '';\n        this.cvcPolicy = pSetupObj.cvcPolicy;\n        this.expiryDatePolicy = pSetupObj.expiryDatePolicy;\n\n        if (process.env.NODE_ENV === 'development' && doLog) {\n            logger.log(\n                '### SecuredField::constructor:: this.sfConfig.fieldType=',\n                this.sfConfig.fieldType,\n                'isValid=',\n                this._isValid,\n                'numKey=',\n                this.numKey\n            );\n            logger.log('\\n');\n        }\n\n        return this.init(i18n, iframeSrc, placeholders, showContextualElement);\n    }\n\n    init(i18n: Language, iframeSrc: string, placeholders: Placeholders, showContextualElement: boolean): SecuredField {\n        /**\n         * Ensure all fields have a related ariaConfig object containing, at minimum, an iframeTitle property and a (translated) errors object\n         */\n        const processedAriaConfig: AriaConfig = processAriaConfig(this.sfConfig.txVariant, this.sfConfig.fieldType, i18n, showContextualElement);\n        // Set result back onto config object\n        this.sfConfig.iframeUIConfig.ariaConfig = processedAriaConfig;\n\n        // Set result back onto config object\n        this.sfConfig.iframeUIConfig.placeholders = processPlaceholders(this.sfConfig.txVariant, this.sfConfig.fieldType, placeholders);\n\n        /**\n         * Configure, create & reference iframe and add load listener\n         */\n        const iframeConfig = {\n            src: iframeSrc,\n            title: processedAriaConfig[this.sfConfig.fieldType].iframeTitle,\n            policy: 'origin'\n        };\n\n        const iframeEl: HTMLIFrameElement = createIframe(iframeConfig);\n\n        // Place the iframe into the holder\n        this.holderEl.appendChild(iframeEl);\n\n        // Now examine the holder to get an actual DOM node\n        const iframe: HTMLIFrameElement = selectOne(this.holderEl, '.js-iframe');\n\n        if (iframe) {\n            if (!iframe.contentWindow) {\n                // Warn the dev\n                console.error(\n                    'ERROR: Trying to initialise a securedField iframe, but the iframe.contentWindow is undefined. Are you sure the element into which the Card component is being mounted already exists in the DOM *before* the Card component is mounted?'\n                );\n                // Log the error\n                const event = new AnalyticsErrorEvent({\n                    component: this.componentType,\n                    code: ErrorEventCode.SECURED_FIELDS_IFRAME_CONTENT_WINDOW_NOT_FOUND,\n                    errorType: ErrorEventType.implementation,\n                    message: `Trying to initialise an iframe for ${this.sfConfig.fieldType}, but the iframe.contentWindow is undefined`\n                });\n\n                this.submitAnalytics?.(event);\n            }\n\n            this.iframeContentWindow = iframe.contentWindow;\n\n            // Create reference to bound fn (see getters/setters for binding)\n            this.iframeOnLoadListener = this.iframeOnLoadListenerFn;\n\n            on(iframe, 'load', this.iframeOnLoadListener, false);\n        }\n\n        this.iframeRef = iframe;\n\n        return this;\n    }\n\n    iframeOnLoadListenerFn(): void {\n        // Create reference to bound fn (see getters/setters for binding)\n        this.postMessageListener = this.postMessageListenerFn;\n\n        // Add general listener for 'message' EVENT - the event that 'powers' postMessage\n        on(window, 'message', this.postMessageListener, false);\n\n        // Create and send config object to iframe\n        const configObj: IframeConfigObject = {\n            ...this.sfConfig,\n            numKey: this.numKey\n        };\n\n        if (window._b$dl) console.log('### SecuredField:::: onIframeLoaded:: created configObj=', configObj);\n\n        postMessageToIframe(configObj, this.iframeContentWindow, this.loadingContext);\n        //--\n\n        // Callback to say iframe loaded\n        this.onIframeLoadedCallback();\n    }\n\n    postMessageListenerFn(event: MessageEvent): void {\n        // Check message is from expected domain\n        if (!originCheckPassed(event, this.loadingContext, this.sfConfig.showWarnings)) {\n            return;\n        }\n\n        // TODO - for debugging purposes this would always be useful to see\n        //        logger.log('\\n',this.sfConfig.fieldType,'### CSF SecuredField::postMessageListener:: event.data=',event.data);\n\n        if (process.env.NODE_ENV === 'development' && logPostMsg) {\n            logger.log(\n                '\\n###CSF SecuredField::postMessageListener:: DOMAIN & ORIGIN MATCH, NO WEBPACK WEIRDNESS fieldType=',\n                this.sfConfig.fieldType,\n                'txVariant=',\n                this.sfConfig.txVariant,\n                'this.numKey=',\n                this.numKey\n            );\n        }\n\n        // PARSE DATA OBJECT (thus testing if it is a JSON string) - OR TRY & WORK OUT WHY THE PARSING FAILED\n        let feedbackObj: SFFeedbackObj;\n\n        try {\n            feedbackObj = JSON.parse(event.data);\n        } catch (e) {\n            // Was the message generated by webpack?\n            if (isWebpackPostMsg(event)) {\n                if (this.sfConfig.showWarnings) logger.log('### SecuredField::postMessageListenerFn:: PARSE FAIL - WEBPACK');\n                return;\n            }\n\n            // Was the message generated by ChromeVox?\n            if (isChromeVoxPostMsg(event)) {\n                if (this.sfConfig.showWarnings) logger.log('### SecuredField::postMessageListenerFn:: PARSE FAIL - CHROMEVOX');\n                return;\n            }\n\n            if (this.sfConfig.showWarnings)\n                logger.log('### SecuredField::postMessageListenerFn:: PARSE FAIL - UNKNOWN REASON: event.data=', event.data);\n            return;\n        }\n\n        // CHECK FOR EXPECTED PROPS\n        const hasMainProps: boolean = hasOwnProperty(feedbackObj, 'action') && hasOwnProperty(feedbackObj, 'numKey');\n\n        if (!hasMainProps) {\n            if (this.sfConfig.showWarnings) logger.warn('WARNING SecuredField :: postMessage listener for iframe :: data mismatch!');\n            return;\n        }\n\n        if (process.env.NODE_ENV === 'development' && logPostMsg) {\n            logger.log('### SecuredField::postMessageListener:: feedbackObj.numKey=', feedbackObj.numKey);\n        }\n\n        if (this.numKey !== feedbackObj.numKey) {\n            if (this.sfConfig.showWarnings) {\n                logger.warn(\n                    'WARNING SecuredField :: postMessage listener for iframe :: data mismatch! (Probably a message from an unrelated securedField)'\n                );\n            }\n            return;\n        }\n\n        // VALIDATION CHECKS PASSED - DECIDE ON COURSE OF ACTION\n        if (process.env.NODE_ENV === 'development' && logPostMsg) {\n            logger.log(\n                '### SecuredField::postMessageListener:: numkeys match PROCEED WITH POST MESSAGE PROCESSING fieldType=',\n                this.sfConfig.fieldType,\n                'txVariant=',\n                this.sfConfig.txVariant\n            );\n        }\n\n        switch (feedbackObj.action) {\n            case 'encryption':\n                this.isValid = true;\n                this.onEncryptionCallback(feedbackObj);\n                break;\n\n            case 'config':\n                if (window._b$dl)\n                    console.log('### SecuredField::postMessageListenerFn:: configured - calling onConfigCallback', feedbackObj.fieldType);\n                this.onConfigCallback(feedbackObj);\n                break;\n\n            case 'focus':\n                this.onFocusCallback(feedbackObj);\n                break;\n\n            case 'binValue':\n                this.onBinValueCallback(feedbackObj);\n                break;\n\n            // iOS ONLY - RE. iOS BUGS AROUND BLUR AND FOCUS EVENTS\n            case 'touch':\n                this.onTouchstartCallback(feedbackObj);\n                break;\n\n            // Only happens for Firefox & IE <= 11\n            case 'shifttab':\n                this.onShiftTabCallback(feedbackObj);\n                break;\n\n            case 'autoComplete':\n                this.onAutoCompleteCallback(feedbackObj);\n                break;\n\n            case 'enterKeyPressed':\n                this.onKeyPressedCallback(feedbackObj);\n                break;\n\n            case 'encryptionError': {\n                const event = new AnalyticsErrorEvent({\n                    component: this.componentType,\n                    code: feedbackObj.code,\n                    errorType: ErrorEventType.internal,\n                    message: `${feedbackObj.error}. Field= ${this.sfConfig.fieldType}`\n                });\n\n                this.submitAnalytics?.(event);\n                break;\n            }\n\n            /**\n             * Validate, because action =\n             *\n             *  'brand'\n             *  'delete'\n             *  'luhnCheck'\n             *  'incomplete field' (an error that follows from a focus (blur) event)\n             *  'incorrectly filled field' (an error that follows from a focus (blur) event)\n             *  'numberKeyPressed' (or date-, month-, year-, cvc-, pin-, or iban- KeyPressed)\n             *    - since we have no \"error\" action \"...KeyPressed\" is the action type on most error events (other than \"incomplete field, 'incorrectly filled field' or \"luhnCheck\")\n             *    and often these error events representing the clearing of an existing error\n             */\n            default:\n                // If we're validation handling (& not encryption handling) field must be invalid\n                this.isValid = false;\n                this.onValidationCallback(feedbackObj);\n        }\n    }\n\n    destroy(): void {\n        off(window, 'message', this.postMessageListener, false);\n        off(this.iframeRef, 'load', this.iframeOnLoadListener, false);\n        this.iframeContentWindow = null;\n        removeAllChildren(this.holderEl);\n    }\n\n    /**\n     * Returns whether the securedField is hidden OR whether it is optional and not in error\n     */\n    isOptionalOrHidden(): boolean {\n        if (\n            this.sfConfig.fieldType === ENCRYPTED_EXPIRY_DATE ||\n            this.sfConfig.fieldType === ENCRYPTED_EXPIRY_MONTH ||\n            this.sfConfig.fieldType === ENCRYPTED_EXPIRY_YEAR\n        ) {\n            switch (this.expiryDatePolicy) {\n                case DATE_POLICY_HIDDEN:\n                    return true;\n                case DATE_POLICY_OPTIONAL:\n                    return !this.hasError;\n                default:\n                    return false;\n            }\n        }\n\n        if (this.sfConfig.fieldType === ENCRYPTED_SECURITY_CODE) {\n            switch (this.cvcPolicy) {\n                case CVC_POLICY_HIDDEN:\n                    return true;\n                case CVC_POLICY_OPTIONAL:\n                    return !this.hasError;\n                default:\n                    return false;\n            }\n        }\n\n        // Any other type of securedField is not optional & can't be hidden\n        return false;\n    }\n\n    // /////// ALLOCATE CALLBACKS /////////\n    onIframeLoaded(callbackFn: RtnType_noParamVoidFn): SecuredField {\n        this.onIframeLoadedCallback = callbackFn;\n        return this;\n    }\n\n    onEncryption(callbackFn: RtnType_callbackFn): SecuredField {\n        this.onEncryptionCallback = callbackFn;\n        return this;\n    }\n\n    onValidation(callbackFn: RtnType_callbackFn): SecuredField {\n        this.onValidationCallback = callbackFn;\n        return this;\n    }\n\n    onConfig(callbackFn: RtnType_callbackFn): SecuredField {\n        this.onConfigCallback = callbackFn;\n        return this;\n    }\n\n    onFocus(callbackFn: RtnType_callbackFn): SecuredField {\n        this.onFocusCallback = callbackFn;\n        return this;\n    }\n\n    onBinValue(callbackFn: RtnType_callbackFn): SecuredField {\n        this.onBinValueCallback = callbackFn;\n        return this;\n    }\n\n    onTouchstart(callbackFn: RtnType_callbackFn): SecuredField {\n        this.onTouchstartCallback = callbackFn;\n        return this;\n    }\n\n    onShiftTab(callbackFn: RtnType_callbackFn): SecuredField {\n        this.onShiftTabCallback = callbackFn;\n        return this;\n    }\n\n    onAutoComplete(callbackFn: RtnType_callbackFn): SecuredField {\n        this.onAutoCompleteCallback = callbackFn;\n        return this;\n    }\n\n    onKeyPressed(callbackFn: RtnType_callbackFn): SecuredField {\n        this.onKeyPressedCallback = callbackFn;\n        return this;\n    }\n    //------------------------------------\n\n    // ///////////// GETTERS/SETTERS //////////////\n\n    get errorType(): string {\n        return this._errorType;\n    }\n    set errorType(value: string) {\n        this._errorType = value;\n    }\n\n    get hasError(): boolean {\n        return this._hasError;\n    }\n    set hasError(value: boolean) {\n        this._hasError = value;\n    }\n\n    get isValid(): boolean {\n        if (this.sfConfig.fieldType === ENCRYPTED_SECURITY_CODE) {\n            switch (this.cvcPolicy) {\n                case CVC_POLICY_HIDDEN:\n                    // If cvc is hidden then the field is always valid\n                    return true;\n                case CVC_POLICY_OPTIONAL:\n                    // If cvc is optional then the field is always valid UNLESS it has an error\n                    return !this.hasError;\n                default:\n                    return this._isValid;\n            }\n        }\n\n        if (\n            this.sfConfig.fieldType === ENCRYPTED_EXPIRY_DATE ||\n            this.sfConfig.fieldType === ENCRYPTED_EXPIRY_MONTH ||\n            this.sfConfig.fieldType === ENCRYPTED_EXPIRY_YEAR\n        ) {\n            switch (this.expiryDatePolicy) {\n                case DATE_POLICY_HIDDEN:\n                    // If date is hidden then the field is always valid\n                    return true;\n                case DATE_POLICY_OPTIONAL:\n                    // If date is optional then the field is always valid UNLESS it has an error\n                    return !this.hasError;\n                default:\n                    return this._isValid;\n            }\n        }\n\n        return this._isValid;\n    }\n    set isValid(value: boolean) {\n        this._isValid = value;\n    }\n\n    get cvcPolicy(): CVCPolicyType {\n        return this._cvcPolicy;\n    }\n\n    set cvcPolicy(value: CVCPolicyType) {\n        // Only set if this is a CVC field\n        if (this.sfConfig.fieldType !== ENCRYPTED_SECURITY_CODE) return;\n\n        // Only set if value has changed\n        if (value === this.cvcPolicy) return;\n\n        if (process.env.NODE_ENV === 'development' && doLog) logger.log(this.sfConfig.fieldType, '### SecuredField::cvcPolicy:: value=', value);\n\n        this._cvcPolicy = value;\n\n        // If the field has changed status (required <--> not required) AND it's error state was due to an isValidated call\n        // NOTE: fixes issue in Components where you first validate and then start typing a maestro number\n        // - w/o this and the fix in CSF the maestro PM will never register as valid\n        if (this.hasError && this.errorType === 'isValidated') {\n            this.hasError = false;\n        }\n    }\n\n    get expiryDatePolicy(): DatePolicyType {\n        return this._expiryDatePolicy;\n    }\n\n    set expiryDatePolicy(value: DatePolicyType) {\n        // Only set if this is a date field type of securedField\n        if (\n            this.sfConfig.fieldType !== ENCRYPTED_EXPIRY_DATE &&\n            this.sfConfig.fieldType !== ENCRYPTED_EXPIRY_MONTH &&\n            this.sfConfig.fieldType !== ENCRYPTED_EXPIRY_YEAR\n        )\n            return;\n\n        // Only set if value has changed\n        if (value === this.expiryDatePolicy) return;\n\n        if (process.env.NODE_ENV === 'development' && doLog) logger.log(this.sfConfig.fieldType, '### SecuredField:expiryDatePolicy:: value=', value);\n\n        this._expiryDatePolicy = value;\n\n        // If the field has changed status (required <--> not required) AND it's error state was due to an isValidated call\n        if (this.hasError && this.errorType === 'isValidated') {\n            this.hasError = false;\n        }\n    }\n\n    get iframeContentWindow(): Window {\n        return this._iframeContentWindow;\n    }\n    set iframeContentWindow(value: Window) {\n        this._iframeContentWindow = value;\n    }\n\n    get isEncrypted(): boolean {\n        return this._isEncrypted;\n    }\n    set isEncrypted(value: boolean) {\n        this._isEncrypted = value;\n    }\n\n    get numKey(): number {\n        return this._numKey;\n    }\n    set numKey(value: number) {\n        this._numKey = value;\n    }\n\n    // Internal use - way to create listener refs that we can add/remove\n    get iframeOnLoadListener(): RtnType_noParamVoidFn {\n        return this._iframeOnLoadListener;\n    }\n    set iframeOnLoadListener(value: RtnType_noParamVoidFn) {\n        this._iframeOnLoadListener = value.bind(this);\n    }\n\n    get postMessageListener(): RtnType_postMessageListener {\n        return this._postMessageListener;\n    }\n    set postMessageListener(value: RtnType_postMessageListener) {\n        this._postMessageListener = value.bind(this);\n    }\n}\n\nexport default SecuredField;\n"],"names":["SecuredField","AbstractSecuredField","init","i18n","iframeSrc","placeholders","showContextualElement","processedAriaConfig","processAriaConfig","this","sfConfig","txVariant","fieldType","iframeUIConfig","ariaConfig","processPlaceholders","iframeConfig","src","title","iframeTitle","policy","iframeEl","createIframe","holderEl","appendChild","iframe","selectOne","contentWindow","console","error","event","AnalyticsErrorEvent","component","componentType","code","ErrorEventCode","SECURED_FIELDS_IFRAME_CONTENT_WINDOW_NOT_FOUND","errorType","ErrorEventType","implementation","message","submitAnalytics","iframeContentWindow","iframeOnLoadListener","iframeOnLoadListenerFn","on","iframeRef","postMessageListener","postMessageListenerFn","window","configObj","numKey","_b$dl","log","postMessageToIframe","loadingContext","onIframeLoadedCallback","originCheckPassed","showWarnings","feedbackObj","JSON","parse","data","e","isWebpackPostMsg","logger","isChromeVoxPostMsg","hasOwnProperty","action","isValid","onEncryptionCallback","onConfigCallback","onFocusCallback","onBinValueCallback","onTouchstartCallback","onShiftTabCallback","onAutoCompleteCallback","onKeyPressedCallback","internal","onValidationCallback","destroy","off","removeAllChildren","isOptionalOrHidden","ENCRYPTED_EXPIRY_DATE","ENCRYPTED_EXPIRY_MONTH","ENCRYPTED_EXPIRY_YEAR","expiryDatePolicy","DATE_POLICY_HIDDEN","DATE_POLICY_OPTIONAL","hasError","ENCRYPTED_SECURITY_CODE","cvcPolicy","CVC_POLICY_HIDDEN","CVC_POLICY_OPTIONAL","onIframeLoaded","callbackFn","onEncryption","onValidation","onConfig","onFocus","onBinValue","onTouchstart","onShiftTab","onAutoComplete","onKeyPressed","_errorType","value","_hasError","_isValid","_cvcPolicy","_expiryDatePolicy","_iframeContentWindow","isEncrypted","_isEncrypted","_numKey","_iframeOnLoadListener","bind","_postMessageListener","constructor","pSetupObj","super","configVarsFromSetUpObj","reject","from","generateRandomNumber"],"mappings":"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"}