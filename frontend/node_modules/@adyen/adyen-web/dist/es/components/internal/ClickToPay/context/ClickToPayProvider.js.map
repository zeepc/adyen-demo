{"version":3,"file":"ClickToPayProvider.js","sources":["../../../../../../src/components/internal/ClickToPay/context/ClickToPayProvider.tsx"],"sourcesContent":["import { h } from 'preact';\nimport { CtpState } from '../services/ClickToPayService';\nimport { ClickToPayContext } from './ClickToPayContext';\nimport { useCallback, useEffect, useRef, useState } from 'preact/hooks';\nimport { ClickToPayCheckoutPayload, IClickToPayService, IdentityLookupParams } from '../services/types';\nimport ShopperCard from '../models/ShopperCard';\nimport { ClickToPayProps } from '../types';\nimport AdyenCheckoutError from '../../../../core/Errors/AdyenCheckoutError';\nimport { UIElementStatus } from '../../UIElement/types';\n\ntype ClickToPayProviderRef = {\n    setStatus?(status: UIElementStatus): void;\n};\n\nexport type ClickToPayProviderProps = {\n    isStandaloneComponent: boolean;\n    clickToPayService: IClickToPayService | null;\n    configuration: ClickToPayProps;\n    children: any;\n    setClickToPayRef(ref): void;\n    onSubmit(payload: ClickToPayCheckoutPayload): void;\n    onSetStatus(status: UIElementStatus): void;\n    onError(error: AdyenCheckoutError): void;\n};\n\nconst ClickToPayProvider = ({\n    isStandaloneComponent = false,\n    clickToPayService,\n    configuration,\n    children,\n    setClickToPayRef,\n    onSubmit,\n    onSetStatus,\n    onError\n}: ClickToPayProviderProps) => {\n    const [ctpService] = useState<IClickToPayService | null>(clickToPayService);\n    const [ctpState, setCtpState] = useState<CtpState>(clickToPayService?.state || CtpState.NotAvailable);\n    const [isCtpPrimaryPaymentMethod, setIsCtpPrimaryPaymentMethod] = useState<boolean>(true);\n    const [status, setStatus] = useState<UIElementStatus>('ready');\n    const clickToPayRef = useRef<ClickToPayProviderRef>({});\n    const isOnReadyInvoked = useRef<boolean>(false);\n\n    useEffect(() => {\n        setClickToPayRef(clickToPayRef.current);\n        clickToPayRef.current.setStatus = setStatus;\n    }, []);\n\n    useEffect(() => {\n        ctpService?.subscribeOnStateChange(status => setCtpState(status));\n    }, [ctpService]);\n\n    const onReady = useCallback(() => {\n        if (isOnReadyInvoked.current) {\n            return;\n        }\n        configuration.onReady?.();\n        isOnReadyInvoked.current = true;\n    }, [configuration?.onReady]);\n\n    const finishIdentityValidation = useCallback(\n        async (otpValue: string) => {\n            await ctpService?.finishIdentityValidation(otpValue);\n        },\n        [ctpService]\n    );\n\n    const startIdentityValidation = useCallback(async () => {\n        const data = await ctpService?.startIdentityValidation();\n        return data;\n    }, [ctpService]);\n\n    const checkout = useCallback(\n        async (card: ShopperCard) => {\n            return await ctpService?.checkout(card);\n        },\n        [ctpService]\n    );\n\n    const verifyIfShopperIsEnrolled = useCallback(\n        async (shopperIdentity: IdentityLookupParams) => {\n            return await ctpService?.verifyIfShopperIsEnrolled(shopperIdentity);\n        },\n        [ctpService]\n    );\n\n    const logoutShopper = useCallback(async () => {\n        await ctpService?.logout();\n    }, [ctpService]);\n\n    const updateStoreCookiesConsent = useCallback(\n        (shouldStore: boolean) => {\n            ctpService.updateStoreCookiesConsent(shouldStore);\n        },\n        [ctpService]\n    );\n\n    return (\n        <ClickToPayContext.Provider\n            value={{\n                status,\n                onSubmit,\n                onError,\n                onSetStatus,\n                configuration,\n                isStoringCookies: ctpService?.storeCookies,\n                isStandaloneComponent,\n                isCtpPrimaryPaymentMethod,\n                setIsCtpPrimaryPaymentMethod,\n                ctpState,\n                verifyIfShopperIsEnrolled,\n                cards: ctpService?.shopperCards,\n                schemes: ctpService?.schemes,\n                otpMaskedContact: ctpService?.identityValidationData?.maskedShopperContact,\n                otpNetwork: ctpService?.identityValidationData?.selectedNetwork,\n                checkout,\n                logoutShopper,\n                startIdentityValidation,\n                finishIdentityValidation,\n                updateStoreCookiesConsent,\n                onReady\n            }}\n        >\n            {children}\n        </ClickToPayContext.Provider>\n    );\n};\n\nexport default ClickToPayProvider;\n"],"names":["ClickToPayProvider","isStandaloneComponent","clickToPayService","configuration","children","setClickToPayRef","onSubmit","onSetStatus","onError","ctpService","useState","ctpState","setCtpState","state","CtpState","NotAvailable","isCtpPrimaryPaymentMethod","setIsCtpPrimaryPaymentMethod","status","setStatus","clickToPayRef","useRef","isOnReadyInvoked","useEffect","current","subscribeOnStateChange","onReady","useCallback","finishIdentityValidation","async","otpValue","startIdentityValidation","checkout","card","verifyIfShopperIsEnrolled","shopperIdentity","logoutShopper","logout","updateStoreCookiesConsent","shouldStore","h","ClickToPayContext","Provider","value","isStoringCookies","storeCookies","cards","shopperCards","schemes","otpMaskedContact","identityValidationData","maskedShopperContact","otpNetwork","selectedNetwork"],"mappings":"yTAyBA,MAAMA,EAAqB,EACvBC,yBAAwB,EACxBC,oBACAC,gBACAC,WACAC,mBACAC,WACAC,cACAC,cAEA,MAAOC,GAAcC,EAAoCR,IAClDS,EAAUC,GAAeF,EAAmBR,GAAmBW,OAASC,EAASC,eACjFC,EAA2BC,GAAgCP,GAAkB,IAC7EQ,EAAQC,GAAaT,EAA0B,SAChDU,EAAgBC,EAA8B,IAC9CC,EAAmBD,GAAgB,GAEzCE,EAAU,KACNlB,EAAiBe,EAAcI,SAC/BJ,EAAcI,QAAQL,UAAYA,GACnC,IAEHI,EAAU,KACNd,GAAYgB,uBAAuBP,GAAUN,EAAYM,KAC1D,CAACT,IAEJ,MAAMiB,EAAUC,EAAY,KACpBL,EAAiBE,UAGrBrB,EAAcuB,YACdJ,EAAiBE,SAAU,IAC5B,CAACrB,GAAeuB,UAEbE,EAA2BD,EAC7BE,MAAOC,UACGrB,GAAYmB,yBAAyBE,KAE/C,CAACrB,IAGCsB,EAA0BJ,EAAYE,eACrBpB,GAAYsB,2BAEhC,CAACtB,IAEEuB,EAAWL,EACbE,MAAOI,SACUxB,GAAYuB,SAASC,IAEtC,CAACxB,IAGCyB,EAA4BP,EAC9BE,MAAOM,SACU1B,GAAYyB,0BAA0BC,IAEvD,CAAC1B,IAGC2B,EAAgBT,EAAYE,gBACxBpB,GAAY4B,WACnB,CAAC5B,IAEE6B,EAA4BX,EAC7BY,IACG9B,EAAW6B,0BAA0BC,IAEzC,CAAC9B,IAGL,OACI+B,EAACC,EAAkBC,SAAQ,CACvBC,MAAO,CACHzB,SACAZ,WACAE,UACAD,cACAJ,gBACAyC,iBAAkBnC,GAAYoC,aAC9B5C,wBACAe,4BACAC,+BACAN,WACAuB,4BACAY,MAAOrC,GAAYsC,aACnBC,QAASvC,GAAYuC,QACrBC,iBAAkBxC,GAAYyC,wBAAwBC,qBACtDC,WAAY3C,GAAYyC,wBAAwBG,gBAChDrB,WACAI,gBACAL,0BACAH,2BACAU,4BACAZ,YAGHtB"}