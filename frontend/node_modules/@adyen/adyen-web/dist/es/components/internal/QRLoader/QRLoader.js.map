{"version":3,"file":"QRLoader.js","sources":["../../../../../src/components/internal/QRLoader/QRLoader.tsx"],"sourcesContent":["import { h } from 'preact';\nimport { useCoreContext } from '../../../core/Context/CoreProvider';\nimport {\n    usePaymentStatusTimer,\n    DEFAULT_PAYMENT_STATUS_TIMER_COUNTDOWN_TIME_MIN,\n    DEFAULT_PAYMENT_STATUS_TIMER_DELAY_MS,\n    DEFAULT_PAYMENT_STATUS_TIMER_THROTTLE_INTERVAL_MS,\n    DEFAULT_PAYMENT_STATUS_TIMER_THROTTLE_TIME_MS\n} from '../../../hooks/usePaymentStatusTimer';\nimport useAutoFocus from '../../../utils/useAutoFocus';\nimport Button from '../Button';\nimport ContentSeparator from '../ContentSeparator';\nimport { AnalyticsInfoEvent, InfoEventType, UiTarget } from '../../../core/Analytics/events/AnalyticsInfoEvent';\nimport { CountdownTime } from '../Countdown/types';\nimport Spinner from '../Spinner';\nimport { QRDetails } from './components/QRDetails';\nimport { QRFinalState } from './components/QRFinalState';\nimport { QRLoaderDetailsProvider } from './QRLoaderDetailsProvider';\nimport { QRLoaderProps } from './types';\nimport { redirectToApp } from '../../../utils/urls';\nimport './QRLoader.scss';\nimport { useAmount } from '../../../core/Context/AmountProvider';\n\nconst QRCODE_URL = 'utility/v1/barcode.png?type=qrCode&data=';\n\nexport function QRLoader(props: Readonly<QRLoaderProps>) {\n    const { i18n, loadingContext } = useCoreContext();\n\n    const { state: timerState, actions: timerActions } = usePaymentStatusTimer({\n        loadingContext,\n        paymentData: props.paymentData,\n        clientKey: props.clientKey,\n        delay: props.delay,\n        throttleTime: props.throttleTime,\n        throttleInterval: props.throttledInterval,\n        type: props.type,\n        onError: props.onError,\n        onComplete: props.onComplete,\n        onActionHandled: props.onActionHandled\n    });\n\n    const { completed, expired, loading, percentage } = timerState;\n    const { onTick, onTimeUp } = timerActions;\n\n    const { showAmount, url, brandLogo, brandName, countdownTime, type, onActionHandled } = props;\n    const { amount } = useAmount();\n\n    const qrCodeImage = props.qrCodeData ? `${loadingContext}${QRCODE_URL}${props.qrCodeData}&clientKey=${props.clientKey}` : props.qrCodeImage;\n\n    const handleCopy = () => {\n        const event = new AnalyticsInfoEvent({\n            component: props.type,\n            type: InfoEventType.download,\n            target: UiTarget.qrDownloadButton\n        });\n        props.onSubmitAnalytics(event);\n    };\n\n    const onQrCodeLoad = () => {\n        onActionHandled?.({\n            componentType: props.type,\n            actionDescription: 'qr-code-loaded'\n        });\n    };\n\n    const qrSubtitleRef = useAutoFocus();\n\n    if (expired) {\n        return <QRFinalState image=\"error\" message={i18n.get('error.subtitle.payment')} />;\n    }\n\n    if (completed) {\n        return <QRFinalState image=\"success\" message={i18n.get('creditCard.success')} />;\n    }\n\n    if (loading) {\n        return (\n            <div className=\"adyen-checkout__qr-loader\">\n                {brandLogo && (\n                    <div className=\"adyen-checkout__qr-loader__brand-logo-wrapper\">\n                        <img alt={brandName} src={brandLogo} className=\"adyen-checkout__qr-loader__brand-logo\" />\n                    </div>\n                )}\n                <Spinner />\n            </div>\n        );\n    }\n\n    const classnames = props.classNameModifiers.map(m => `adyen-checkout__qr-loader--${m}`);\n\n    return (\n        <div className={`adyen-checkout__qr-loader adyen-checkout__qr-loader--${type} ${classnames.join(' ')}`} data-testid={`${type}-qr-loader`}>\n            {brandLogo && (\n                <div className=\"adyen-checkout__qr-loader__brand-logo-wrapper\">\n                    <img src={brandLogo} alt={brandName} className=\"adyen-checkout__qr-loader__brand-logo\" />\n                </div>\n            )}\n\n            {showAmount && amount && amount.value !== null && !!amount.currency && (\n                <h1 className=\"adyen-checkout__qr-loader__payment_amount\">{i18n.amount(amount.value, amount.currency)}</h1>\n            )}\n\n            {url && (\n                <div className=\"adyen-checkout__qr-loader__app-link\">\n                    {props.redirectIntroduction && <p className=\"adyen-checkout__qr-loader__subtitle\">{i18n.get(props.redirectIntroduction)}</p>}\n                    <Button classNameModifiers={['qr-loader']} onClick={() => redirectToApp(url)} label={i18n.get(props.buttonLabel)} />\n                    <ContentSeparator />\n                </div>\n            )}\n\n            {/* eslint-disable-next-line jsx-a11y/no-noninteractive-tabindex */}\n            <p ref={qrSubtitleRef} tabIndex={0} className=\"adyen-checkout__qr-loader__subtitle\">\n                {typeof props.introduction === 'string' ? i18n.get(props.introduction) : props.introduction?.()}\n            </p>\n\n            <QRLoaderDetailsProvider\n                type={type}\n                qrCodeImage={qrCodeImage}\n                qrCodeData={props.qrCodeData}\n                percentage={percentage}\n                timeToPay={props.timeToPay}\n                copyBtn={props.copyBtn}\n                instructions={props.instructions}\n                countdownTime={countdownTime}\n                onTick={(time: CountdownTime) => onTick(time)}\n                onQRCodeLoad={onQrCodeLoad}\n                onTimeUp={() => onTimeUp()}\n                handleCopy={handleCopy}\n            >\n                {props.children ? props.children : <QRDetails />}\n            </QRLoaderDetailsProvider>\n        </div>\n    );\n}\n\nQRLoader.defaultProps = {\n    countdownTime: DEFAULT_PAYMENT_STATUS_TIMER_COUNTDOWN_TIME_MIN,\n    delay: DEFAULT_PAYMENT_STATUS_TIMER_DELAY_MS,\n    throttleTime: DEFAULT_PAYMENT_STATUS_TIMER_THROTTLE_TIME_MS,\n    throttledInterval: DEFAULT_PAYMENT_STATUS_TIMER_THROTTLE_INTERVAL_MS,\n    onError: () => {},\n    onComplete: () => {},\n    classNameModifiers: [],\n    introduction: 'wechatpay.scanqrcode',\n    timeToPay: 'wechatpay.timetopay',\n    buttonLabel: 'openApp',\n    showAmount: true\n};\n"],"names":["QRLoader","props","i18n","loadingContext","useCoreContext","state","timerState","actions","timerActions","usePaymentStatusTimer","paymentData","clientKey","delay","throttleTime","throttleInterval","throttledInterval","type","onError","onComplete","onActionHandled","completed","expired","loading","percentage","onTick","onTimeUp","showAmount","url","brandLogo","brandName","countdownTime","amount","useAmount","qrCodeImage","qrCodeData","qrSubtitleRef","useAutoFocus","h","QRFinalState","image","message","get","div","className","img","alt","src","Spinner","classnames","classNameModifiers","map","m","join","data-testid","value","currency","h1","redirectIntroduction","p","Button","onClick","redirectToApp","label","buttonLabel","ContentSeparator","ref","tabIndex","introduction","QRLoaderDetailsProvider","timeToPay","copyBtn","instructions","time","onQRCodeLoad","componentType","actionDescription","handleCopy","event","AnalyticsInfoEvent","component","InfoEventType","download","target","UiTarget","qrDownloadButton","onSubmitAnalytics","children","QRDetails","defaultProps","DEFAULT_PAYMENT_STATUS_TIMER_COUNTDOWN_TIME_MIN","DEFAULT_PAYMENT_STATUS_TIMER_DELAY_MS","DEFAULT_PAYMENT_STATUS_TIMER_THROTTLE_TIME_MS","DEFAULT_PAYMENT_STATUS_TIMER_THROTTLE_INTERVAL_MS"],"mappings":"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"}