{"version":3,"file":"cardType.js","sources":["../../../../../../../../src/components/internal/SecuredFields/lib/CSF/utils/cardType.ts"],"sourcesContent":["import { CardObject } from '../../types';\nimport { hasOwnProperty } from '../../../../../../utils/hasOwnProperty';\n\nlet shortestPermittedCardLength;\n\ninterface CardType {\n    __NO_BRAND?: string;\n    cards?: CardObject[];\n}\n\nconst CardType: CardType = {};\nCardType.__NO_BRAND = 'noBrand';\n\nCardType.cards = [];\n\nCardType.cards.push({\n    cardType: 'mc',\n    startingRules: [51, 52, 53, 54, 55, 22, 23, 24, 25, 26, 27],\n    permittedLengths: [16],\n    pattern: /^(5[1-5][0-9]{0,14}|2[2-7][0-9]{0,14})$/,\n    securityCode: 'CVC'\n});\n\nCardType.cards.push({ cardType: 'visadankort', startingRules: [4571], permittedLengths: [16], pattern: /^(4571)[0-9]{0,12}$/ });\n\nCardType.cards.push({\n    cardType: 'visa',\n    startingRules: [4],\n    permittedLengths: [13, 16, 19],\n    pattern: /^4[0-9]{0,18}$/,\n    securityCode: 'CVV'\n});\n\nCardType.cards.push({ cardType: 'amex', startingRules: [34, 37], permittedLengths: [15], pattern: /^3[47][0-9]{0,13}$/, securityCode: 'CID' });\n\nCardType.cards.push({ cardType: 'diners', startingRules: [36], permittedLengths: [14, 15, 16, 17, 18, 19], pattern: /^(36)[0-9]{0,12}$/ });\n\nCardType.cards.push({ cardType: 'maestrouk', startingRules: [6759], permittedLengths: [16, 18, 19], pattern: /^(6759)[0-9]{0,15}$/ });\n\nCardType.cards.push({ cardType: 'solo', startingRules: [6767], permittedLengths: [16, 18, 19], pattern: /^(6767)[0-9]{0,15}$/ });\n\nCardType.cards.push({\n    cardType: 'laser',\n    startingRules: [6304, 6706, 677117, 677120],\n    permittedLengths: [16, 17, 18, 19],\n    pattern: /^(6304|6706|6709|6771)[0-9]{0,15}$/,\n    cvcPolicy: 'optional'\n});\n\nCardType.cards.push({\n    cardType: 'discover',\n    startingRules: [6011, 644, 645, 646, 647, 648, 649, 65],\n    permittedLengths: [16, 17, 18, 19],\n    pattern: /^(6011[0-9]{0,12}|(644|645|646|647|648|649)[0-9]{0,13}|65[0-9]{0,14})$/\n});\n\nCardType.cards.push({\n    cardType: 'jcb',\n    startingRules: [3528, 3529, 353, 354, 355, 356, 357, 358],\n    permittedLengths: [16, 19],\n    pattern: /^(352[8,9]{1}[0-9]{0,15}|35[4-8]{1}[0-9]{0,16})$/,\n    securityCode: 'CAV'\n});\n\nCardType.cards.push({\n    cardType: 'bcmc',\n    startingRules: [6703, 479658, 606005],\n    permittedLengths: [16, 17, 18, 19],\n    pattern: /^((6703)[0-9]{0,15}|(479658|606005)[0-9]{0,13})$/,\n    cvcPolicy: 'hidden'\n});\n\nCardType.cards.push({ cardType: 'bijcard', startingRules: [5100081], permittedLengths: [16], pattern: /^(5100081)[0-9]{0,9}$/ });\n\nCardType.cards.push({ cardType: 'dankort', startingRules: [5019], permittedLengths: [16], pattern: /^(5019)[0-9]{0,12}$/ });\n\nCardType.cards.push({ cardType: 'hipercard', startingRules: [606282], permittedLengths: [16], pattern: /^(606282)[0-9]{0,10}$/ });\n\n// Moved above maestro (from position below uatp) to stop maestro being recognised over cup\nCardType.cards.push({ cardType: 'cup', startingRules: [62, 81], permittedLengths: [14, 15, 16, 17, 18, 19], pattern: /^(62|81)[0-9]{0,17}$/ }); // orig & android v1 + modified to include our test cards (81...)\n\nCardType.cards.push({\n    cardType: 'maestro',\n    startingRules: [50, 56, 57, 58, 6],\n    permittedLengths: [16, 17, 18, 19],\n    pattern: /^(5[0|6-8][0-9]{0,17}|6[0-9]{0,18})$/,\n    cvcPolicy: 'optional'\n});\n\nCardType.cards.push({\n    cardType: 'elo',\n    // prettier-ignore\n    startingRules: [506699, 50670, 50671, 50672, 50673, 50674, 50675, 50676, 506770, 506771, 506772, 506773, 506774, 506775, 506776, 506777, 506778, 401178, 438935, 451416, 457631, 457632, 504175, 627780, 636297, 636368],\n    permittedLengths: [16],\n    // prettier-ignore\n    pattern:\n        /^((((506699)|(506770)|(506771)|(506772)|(506773)|(506774)|(506775)|(506776)|(506777)|(506778)|(401178)|(438935)|(451416)|(457631)|(457632)|(504175)|(627780)|(636368)|(636297))[0-9]{0,10})|((50676)|(50675)|(50674)|(50673)|(50672)|(50671)|(50670))[0-9]{0,11})$/\n});\n\nCardType.cards.push({ cardType: 'uatp', startingRules: [1], permittedLengths: [15], pattern: /^1[0-9]{0,14}$/, cvcPolicy: 'optional' });\n\nCardType.cards.push({\n    cardType: 'cartebancaire',\n    startingRules: [4, 5, 6],\n    permittedLengths: [16],\n    pattern: /^[4-6][0-9]{0,15}$/\n});\n\nCardType.cards.push({ cardType: 'visaalphabankbonus', startingRules: [450903], permittedLengths: [16], pattern: /^(450903)[0-9]{0,10}$/ });\n\nCardType.cards.push({ cardType: 'mcalphabankbonus', startingRules: [510099], permittedLengths: [16], pattern: /^(510099)[0-9]{0,10}$/ });\n\nCardType.cards.push({\n    cardType: 'hiper',\n    startingRules: [637095, 637568, 637599, 637609, 637612],\n    permittedLengths: [16],\n    pattern: /^(637095|637568|637599|637609|637612)[0-9]{0,10}$/\n});\n\nCardType.cards.push({ cardType: 'oasis', startingRules: [982616], permittedLengths: [16], pattern: /^(982616)[0-9]{0,10}$/, cvcPolicy: 'optional' });\n\nCardType.cards.push({\n    cardType: 'karenmillen',\n    startingRules: [98261465],\n    permittedLengths: [16],\n    pattern: /^(98261465)[0-9]{0,8}$/,\n    cvcPolicy: 'optional'\n});\n\nCardType.cards.push({\n    cardType: 'warehouse',\n    startingRules: [982633],\n    permittedLengths: [16],\n    pattern: /^(982633)[0-9]{0,10}$/,\n    cvcPolicy: 'optional'\n});\n\nCardType.cards.push({ cardType: 'mir', startingRules: [220], permittedLengths: [16, 17, 18, 19], pattern: /^(220)[0-9]{0,16}$/ });\n\nCardType.cards.push({ cardType: 'codensa', startingRules: [590712], permittedLengths: [16], pattern: /^(590712)[0-9]{0,10}$/ });\n\nCardType.cards.push({\n    cardType: 'naranja',\n    startingRules: [377798, 377799, 402917, 402918, 527571, 527572, 589562],\n    permittedLengths: [16, 17, 18, 19],\n    pattern: /^(37|40|5[28])([279])\\d*$/\n});\n\n// TODO: 589657 clashes with naranja, rest ok\nCardType.cards.push({\n    cardType: 'cabal',\n    startingRules: [589657, 600691, 603522, 6042, 6043, 636908],\n    permittedLengths: [16, 17, 18, 19],\n    pattern: /^(58|6[03])([03469])\\d*$/\n});\n\nCardType.cards.push({\n    cardType: 'shopping',\n    startingRules: [2799, 589407, 603488],\n    permittedLengths: [16, 17, 18, 19],\n    pattern: /^(27|58|60)([39])\\d*$/\n});\n\nCardType.cards.push({ cardType: 'argencard', startingRules: [501], permittedLengths: [16, 17, 18, 19], pattern: /^(50)(1)\\d*$/ }); // NOTE: starting rule changed, from 501105, to not clash with dankort. Plus it now matches its regEx!\n\nCardType.cards.push({ cardType: 'troy', startingRules: [9792], permittedLengths: [16], pattern: /^(97)(9)\\d*$/ });\n\n// TODO: clashes with cabal\nCardType.cards.push({ cardType: 'forbrugsforeningen', startingRules: [600722], permittedLengths: [16], pattern: /^(60)(0)\\d*$/ });\n\nCardType.cards.push({\n    cardType: 'vpay',\n    startingRules: [401, 408, 413, 434, 435, 437, 439, 441, 442, 443, 444, 446, 447, 455, 458, 460, 461, 463, 466, 471, 479, 482, 483, 487],\n    permittedLengths: [13, 14, 15, 16, 17, 18, 19],\n    pattern: /^(40[1,8]|413|43[4,5]|44[1,2,3,4,6,7]|45[5,8]|46[0,1,3,6]|47[1,9]|48[2,3,7])[0-9]{0,16}$/ // ^(4[0-1|3-8][0-9]{1,17})$\n});\n\nCardType.cards.push({\n    cardType: 'rupay',\n    startingRules: [508528],\n    permittedLengths: [16],\n    // prettier-ignore\n    pattern:\n        /^(100003|508(2|[5-9])|60(69|[7-8])|652(1[5-9]|[2-5][0-9]|8[5-9])|65300[3-4]|8172([0-1]|[3-5]|7|9)|817(3[3-8]|40[6-9]|410)|35380([0-2]|[5-6]|9))[0-9]{0,12}$/\n});\n\nCardType.cards.push({\n    cardType: 'ticket',\n    expiryDatePolicy: 'hidden'\n});\n\nconst detectCard = (pCardNumber, pAvailableCards?) => {\n    let matchedCards;\n    let i;\n    let len;\n\n    if (pAvailableCards) {\n        // Filter CardType.cards down to those that are found in pAvailableCards\n        matchedCards = CardType.cards\n            .filter(card => pAvailableCards.includes(card.cardType))\n            // Further filter them to those with a regEx pattern that matches pCardNumber\n            .filter(card => hasOwnProperty(card, 'pattern') && pCardNumber.match(card.pattern));\n\n        // If we have matched cards: if there's only one - return it; else return the one with the longest startingRule\n        if (matchedCards.length) {\n            if (matchedCards.length === 1) {\n                return matchedCards[0];\n            }\n\n            // Find longest rule for each matched card & store it as a property on the card\n            for (i = 0, len = matchedCards.length; i < len; i += 1) {\n                if (!matchedCards[i].longestRule) {\n                    const longestRule = matchedCards[i].startingRules.reduce((a, b) => (a > b ? a : b));\n                    // What we actually store is how many chars are in the rule\n                    matchedCards[i].longestRule = String(longestRule).length;\n                }\n            }\n\n            // Based on each matched cards longest rule - find the card with the longest one!\n            return matchedCards.reduce((a, b) => (a.longestRule >= b.longestRule ? a : b));\n        }\n\n        return { cardType: CardType.__NO_BRAND };\n    }\n\n    return { cardType: CardType.__NO_BRAND };\n};\n\nconst detectCardLength = (pCard, pUnformattedVal) => {\n    let maxLength;\n    let shortenedNewValue;\n    let lengthDiff = 0;\n    let reachedValidLength = false;\n    let unformattedVal = pUnformattedVal;\n\n    // Find the longest of the permitted card number lengths for this card brand\n    const maxPermittedLength = pCard.cardType !== CardType.__NO_BRAND ? pCard.permittedLengths[pCard.permittedLengths.length - 1] : 0;\n\n    // If the input value is longer than it's max permitted length then shorten it to that length\n    if (maxPermittedLength && unformattedVal > maxPermittedLength) {\n        lengthDiff = unformattedVal.length - maxPermittedLength;\n\n        if (lengthDiff > 0) {\n            unformattedVal = unformattedVal.substring(0, unformattedVal.length - lengthDiff);\n            shortenedNewValue = unformattedVal;\n        }\n    }\n\n    // If cardNumber has reached one of the cardBrand's 'permitted lengths' - mark it as 'valid'\n    pCard.permittedLengths.forEach(pItem => {\n        if (unformattedVal.length === pItem) {\n            reachedValidLength = true;\n        }\n    });\n\n    // If cardNumber is as long as the cardBrand's maximum permitted length then set the maxLength var\n    if (unformattedVal.length === maxPermittedLength) {\n        // Set maxlength to max + the right amount of spaces (one for every 4 digits, but not on the last block)\n        const div = Math.floor(unformattedVal.length / 4);\n        const mod = unformattedVal.length % 4;\n        const numSpaces = mod > 0 ? div : div - 1;\n\n        maxLength = maxPermittedLength + numSpaces;\n\n        if (pCard.cardType.toLowerCase() === 'amex') {\n            maxLength = maxPermittedLength + 2; // = 17 = 15 digits with space after 4th & 10th\n        }\n    }\n\n    return {\n        shortenedNewValue,\n        maxLength,\n        reachedValidLength\n    };\n};\n\nconst getShortestPermittedCardLength = () => {\n    if (!shortestPermittedCardLength) {\n        let permittedLengthsArray = [];\n\n        CardType.cards.forEach(pItem => {\n            permittedLengthsArray = permittedLengthsArray.concat(pItem.permittedLengths ?? []);\n        });\n\n        shortestPermittedCardLength = Math.min.apply(null, permittedLengthsArray);\n    }\n\n    return shortestPermittedCardLength;\n};\n\nconst getCardByBrand = pBrand => {\n    const cardType = CardType.cards.filter(card => card.cardType === pBrand);\n\n    return cardType[0];\n};\n\nconst isGenericCardType = type => {\n    if (!type) throw new Error('Error: isGenericCardType: type param has not been specified');\n    return type === 'card' || type === 'scheme';\n};\n\nexport default {\n    detectCard,\n    detectCardLength,\n    getShortestPermittedCardLength,\n    getCardByBrand,\n    isGenericCardType,\n    __NO_BRAND: CardType.__NO_BRAND,\n    allCards: CardType.cards\n};\n"],"names":["shortestPermittedCardLength","CardType","cards","push","cardType","startingRules","permittedLengths","pattern","securityCode","cvcPolicy","expiryDatePolicy","detectCard","pCardNumber","pAvailableCards","matchedCards","i","len","filter","card","includes","hasOwnProperty","match","length","longestRule","reduce","a","b","String","__NO_BRAND","detectCardLength","pCard","pUnformattedVal","maxLength","shortenedNewValue","lengthDiff","reachedValidLength","unformattedVal","maxPermittedLength","substring","forEach","pItem","div","Math","floor","toLowerCase","getShortestPermittedCardLength","permittedLengthsArray","concat","min","apply","getCardByBrand","pBrand","isGenericCardType","type","Error","allCards"],"mappings":"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"}