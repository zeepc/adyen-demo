{"version":3,"file":"FastlaneSignup.js","sources":["../../../../../../src/components/Card/components/Fastlane/FastlaneSignup.tsx"],"sourcesContent":["import { Fragment, h } from 'preact';\nimport { useCallback, useEffect, useMemo, useState } from 'preact/hooks';\nimport cx from 'classnames';\nimport Toggle from '../../../internal/Toggle';\nimport Img from '../../../internal/Img';\nimport useImage from '../../../../core/Context/useImage';\nimport USOnlyPhoneInput from './USOnlyPhoneInput';\nimport { InfoButton } from './InfoButton';\nimport { useCoreContext } from '../../../../core/Context/CoreProvider';\nimport { LabelOnlyDisclaimerMessage } from '../../../internal/DisclaimerMessage/DisclaimerMessage';\nimport { isConfigurationValid } from './utils/validate-configuration';\nimport mobileNumberFormatter from './utils/mobile-number-formatter';\nimport type { FastlaneSignupConfiguration } from '../../../PayPalFastlane/types';\n\nimport './FastlaneSignup.scss';\nimport { AnalyticsInfoEvent, InfoEventType, UiTarget } from '../../../../core/Analytics/events/AnalyticsInfoEvent';\nimport { AbstractAnalyticsEvent } from '../../../../core/Analytics/events/AbstractAnalyticsEvent';\n\ntype FastlaneSignupProps = FastlaneSignupConfiguration & {\n    currentDetectedBrand: string;\n    onChange(state: any): void;\n    onSubmitAnalytics(event: AbstractAnalyticsEvent): void;\n    // Component type (e.g. scheme, bcmc)\n    type: string;\n};\n\nconst SUPPORTED_BRANDS = ['mc', 'visa'];\n\nconst FastlaneSignup = ({\n    showConsent,\n    defaultToggleState,\n    termsAndConditionsLink,\n    privacyPolicyLink,\n    termsAndConditionsVersion,\n    fastlaneSessionId,\n    currentDetectedBrand,\n    telephoneNumber: telephoneNumberFromProps,\n    onChange,\n    onSubmitAnalytics,\n    type\n}: FastlaneSignupProps) => {\n    const shouldDisplaySignup = useMemo(() => showConsent && SUPPORTED_BRANDS.includes(currentDetectedBrand), [showConsent, currentDetectedBrand]);\n    const [hasConsentFormBeenShown, setHasConsentFormBeenShown] = useState<boolean>(shouldDisplaySignup);\n    const [isChecked, setIsChecked] = useState<boolean>(defaultToggleState);\n    const getImage = useImage();\n    const [telephoneNumber, setTelephoneNumber] = useState<string>('');\n    const { i18n } = useCoreContext();\n    const isFastlaneConfigurationValid = useMemo(() => {\n        return isConfigurationValid({\n            showConsent,\n            defaultToggleState,\n            termsAndConditionsLink,\n            privacyPolicyLink,\n            termsAndConditionsVersion,\n            fastlaneSessionId\n        });\n    }, [showConsent, defaultToggleState, termsAndConditionsLink, privacyPolicyLink, termsAndConditionsVersion, fastlaneSessionId]);\n\n    const handleToggleChange = useCallback(() => {\n        const newValue = !isChecked;\n        setIsChecked(newValue);\n\n        const event = new AnalyticsInfoEvent({\n            component: type,\n            type: InfoEventType.clicked,\n            target: UiTarget.fastlaneSignupConsentToggle,\n            configData: {\n                isToggleOn: newValue\n            }\n        });\n        onSubmitAnalytics(event);\n    }, [isChecked, onSubmitAnalytics, type]);\n\n    /**\n     * If the configuration is valid, the Component propagates fastlaneData to the Card component state\n     *\n     * 'telephoneNumber' is optional since the shopper can check out without passing it\n     * 'termsAndConditionsVersion' is optional since the signup flow may not be available for the shopper, although we still add fastlaneData to the /payments request for analytics purposes\n     */\n    useEffect(() => {\n        if (!isFastlaneConfigurationValid) {\n            return;\n        }\n\n        onChange({\n            fastlaneData: {\n                consentShown: hasConsentFormBeenShown,\n                fastlaneSessionId: fastlaneSessionId,\n                consentGiven: shouldDisplaySignup ? isChecked : false,\n                ...(termsAndConditionsVersion && { consentVersion: termsAndConditionsVersion }),\n                ...(telephoneNumber && { telephoneNumber })\n            }\n        });\n    }, [\n        shouldDisplaySignup,\n        hasConsentFormBeenShown,\n        termsAndConditionsVersion,\n        isChecked,\n        fastlaneSessionId,\n        telephoneNumber,\n        onChange,\n        isFastlaneConfigurationValid\n    ]);\n\n    /**\n     * If the sign-up has been displayed at least once, we set hasConsentFormBeenShown: true\n     */\n    useEffect(() => {\n        if (shouldDisplaySignup) {\n            setHasConsentFormBeenShown(true);\n        }\n    }, [shouldDisplaySignup]);\n\n    useEffect(() => {\n        if (!isFastlaneConfigurationValid) {\n            return;\n        }\n\n        const event = new AnalyticsInfoEvent({\n            component: type,\n            type: InfoEventType.rendered,\n            configData: {\n                isFastlaneSignupRendered: shouldDisplaySignup\n            }\n        });\n\n        onSubmitAnalytics(event);\n    }, [shouldDisplaySignup, isFastlaneConfigurationValid, onSubmitAnalytics, type]);\n\n    if (!shouldDisplaySignup || !isFastlaneConfigurationValid) {\n        return null;\n    }\n\n    return (\n        <div className=\"adyen-checkout-card__fastlane\" data-testid=\"fastlane-signup-component\">\n            <div\n                className={cx('adyen-checkout-card__fastlane-consent-toggle', {\n                    'adyen-checkout-card__fastlane-consent-toggle--active': isChecked\n                })}\n            >\n                <Toggle\n                    checked={isChecked}\n                    onChange={handleToggleChange}\n                    ariaLabel={i18n.get('card.fastlane.consentToggle')}\n                    label={<span>{i18n.get('card.fastlane.consentToggle')}</span>}\n                />\n                <InfoButton />\n            </div>\n\n            {isChecked && (\n                <Fragment>\n                    <USOnlyPhoneInput initialValue={mobileNumberFormatter(telephoneNumberFromProps)} onChange={setTelephoneNumber} />\n                    <div className=\"adyen-checkout-card__fastlane-consent-text\">\n                        <LabelOnlyDisclaimerMessage\n                            message={i18n.get('card.fastlane.consentText')}\n                            urls={[termsAndConditionsLink, privacyPolicyLink]}\n                        />\n                    </div>\n                    <Img\n                        className=\"adyen-checkout-card__fastlane-brand\"\n                        src={getImage({ imageFolder: 'components/' })(`paypal_fastlane_black`)}\n                        alt={i18n.get('card.fastlane.a11y.logo')}\n                    />\n                </Fragment>\n            )}\n        </div>\n    );\n};\n\nexport default FastlaneSignup;\n"],"names":["SUPPORTED_BRANDS","FastlaneSignup","showConsent","defaultToggleState","termsAndConditionsLink","privacyPolicyLink","termsAndConditionsVersion","fastlaneSessionId","currentDetectedBrand","telephoneNumber","telephoneNumberFromProps","onChange","onSubmitAnalytics","type","shouldDisplaySignup","useMemo","includes","hasConsentFormBeenShown","setHasConsentFormBeenShown","useState","isChecked","setIsChecked","getImage","useImage","setTelephoneNumber","i18n","useCoreContext","isFastlaneConfigurationValid","isConfigurationValid","handleToggleChange","useCallback","newValue","event","AnalyticsInfoEvent","component","InfoEventType","clicked","target","UiTarget","fastlaneSignupConsentToggle","configData","isToggleOn","useEffect","fastlaneData","consentShown","consentGiven","consentVersion","rendered","isFastlaneSignupRendered","h","div","className","data-testid","cx","Toggle","checked","ariaLabel","get","label","span","InfoButton","Fragment","USOnlyPhoneInput","initialValue","mobileNumberFormatter","LabelOnlyDisclaimerMessage","message","urls","Img","src","imageFolder","alt"],"mappings":"24BA0BA,MAAMA,EAAmB,CAAC,KAAM,QAE1BC,EAAiB,EACnBC,cACAC,qBACAC,yBACAC,oBACAC,4BACAC,oBACAC,uBACAC,gBAAiBC,EACjBC,WACAC,oBACAC,WAEA,MAAMC,EAAsBC,EAAQ,IAAMb,GAAeF,EAAiBgB,SAASR,GAAuB,CAACN,EAAaM,KACjHS,EAAyBC,GAA8BC,EAAkBL,IACzEM,EAAWC,GAAgBF,EAAkBhB,GAC9CmB,EAAWC,KACVd,EAAiBe,GAAsBL,EAAiB,KACzDM,KAAEA,GAASC,IACXC,EAA+BZ,EAAQ,IAClCa,EAAqB,CACxB1B,cACAC,qBACAC,yBACAC,oBACAC,4BACAC,sBAEL,CAACL,EAAaC,EAAoBC,EAAwBC,EAAmBC,EAA2BC,IAErGsB,EAAqBC,EAAY,KACnC,MAAMC,GAAYX,EAClBC,EAAaU,GAEb,MAAMC,EAAQ,IAAIC,EAAmB,CACjCC,UAAWrB,EACXA,KAAMsB,EAAcC,QACpBC,OAAQC,EAASC,4BACjBC,WAAY,CACRC,WAAYV,KAGpBnB,EAAkBoB,IACnB,CAACZ,EAAWR,EAAmBC,IA0DlC,OAlDA6B,EAAU,KACDf,GAILhB,EAAS,CACLgC,aAAc,CACVC,aAAc3B,EACdV,kBAAmBA,EACnBsC,eAAc/B,GAAsBM,KAChCd,GAA6B,CAAEwC,eAAgBxC,MAC/CG,GAAmB,CAAEA,uBAGlC,CACCK,EACAG,EACAX,EACAc,EACAb,EACAE,EACAE,EACAgB,IAMJe,EAAU,KACF5B,GACAI,GAA2B,IAEhC,CAACJ,IAEJ4B,EAAU,KACN,IAAKf,EACD,OAGJ,MAAMK,EAAQ,IAAIC,EAAmB,CACjCC,UAAWrB,EACXA,KAAMsB,EAAcY,SACpBP,WAAY,CACRQ,yBAA0BlC,KAIlCF,EAAkBoB,IACnB,CAAClB,EAAqBa,EAA8Bf,EAAmBC,IAErEC,GAAwBa,EAKzBsB,EAACC,MAAAA,CAAIC,UAAU,gCAAgCC,cAAY,6BACvDH,EAACC,MAAAA,CACGC,UAAWE,EAAG,+CAAgD,CAC1D,uDAAwDjC,KAG5D6B,EAACK,EAAAA,CACGC,QAASnC,EACTT,SAAUkB,EACV2B,UAAW/B,EAAKgC,IAAI,+BACpBC,MAAOT,EAACU,OAAAA,KAAMlC,EAAKgC,IAAI,kCAE3BR,EAACW,EAAAA,OAGJxC,GACG6B,EAACY,EAAAA,KACGZ,EAACa,EAAAA,CAAiBC,aAAcC,EAAsBtD,GAA2BC,SAAUa,IAC3FyB,EAACC,MAAAA,CAAIC,UAAU,8CACXF,EAACgB,EAAAA,CACGC,QAASzC,EAAKgC,IAAI,6BAClBU,KAAM,CAAC/D,EAAwBC,MAGvC4C,EAACmB,EAAAA,CACGjB,UAAU,sCACVkB,IAAK/C,EAAS,CAAEgD,YAAa,eAAxBhD,CAAyC,yBAC9CiD,IAAK9C,EAAKgC,IAAI,+BA/BvB"}