import{createElement as e}from"../../../external/preact/dist/preact.js";import{useRef as t,useState as r,useCallback as a,useEffect as s}from"../../../external/preact/hooks/dist/hooks.js";import n from"../../../core/Errors/AdyenCheckoutError.js";import o from"../../internal/Spinner/Spinner.js";import{CashAppPayEvents as i}from"../services/types.js";import c from"../../internal/StoreDetails/StoreDetails.js";function l({enableStoreDetails:l,cashAppService:u,onClick:d,onChangeStoreDetails:m,onAuthorize:p,onError:h}){const g=t(null),[y,C]=r("loading"),f=t([]),[E,b]=r(!1);this.setStatus=C;const R=a(async()=>{try{await u.initialize(),f.current=[u.subscribeToEvent(i.CustomerDismissed,()=>{h(new n("CANCEL","Customer dismissed the modal"))}),u.subscribeToEvent(i.CustomerRequestDeclined,async()=>{h(new n("ERROR","Payment declined by CashAppPay")),await u.restart(),await u.renderButton(g.current)}),u.subscribeToEvent(i.CustomerRequestApproved,({customerProfile:e,grants:t})=>{const r={...e?.id&&{customerId:e.id},...e?.cashtag&&{cashTag:e.cashtag},...t?.payment?.grantId&&{grantId:t.payment.grantId},...t?.onFile?.grantId&&{onFileGrantId:t.onFile.grantId}};p(r)}),u.subscribeToEvent(i.CustomerRequestFailed,()=>{h(new n("ERROR","Customer request failed"))})],await u.renderButton(g.current),C("ready")}catch(e){h(e instanceof n?e:new n("ERROR","Error when initializing CashAppPay",{cause:e}))}},[u,h,p]);return s(()=>{l&&(u.setStorePaymentMethod(E),m(E))},[l,E]),s(()=>(R(),()=>{u.restart(),f.current.forEach(e=>e())}),[u,R]),e("div",{className:"adyen-checkout__cashapp","aria-live":"polite","aria-busy":"loading"===y},"loading"===y&&e(o,null),"loading"!==y&&l&&e(c,{storeDetails:E,onChange:b}),e("div",{onClick:d,className:"adyen-checkout__cashapp-button",ref:g}))}export{l as CashAppComponent};
//# sourceMappingURL=CashAppComponent.js.map
