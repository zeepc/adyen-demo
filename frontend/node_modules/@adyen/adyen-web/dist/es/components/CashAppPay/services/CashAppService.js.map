{"version":3,"file":"CashAppService.js","sources":["../../../../../src/components/CashAppPay/services/CashAppService.ts"],"sourcesContent":["import { ICashAppSdkLoader } from './CashAppSdkLoader';\nimport AdyenCheckoutError from '../../../core/Errors/AdyenCheckoutError';\nimport { CashAppPayEvents, CashAppServiceConfig, ICashAppSDK, ICashAppService } from './types';\nimport { PaymentAmount } from '../../../types';\n\nexport default class CashAppService implements ICashAppService {\n    private readonly sdkLoader: ICashAppSdkLoader;\n    private readonly configuration: CashAppServiceConfig;\n\n    private pay: ICashAppSDK;\n\n    /**\n     * Reference to CashApp 'begin' method\n     */\n    private startAuthorization?: () => void;\n\n    constructor(sdkLoader: ICashAppSdkLoader, configuration: CashAppServiceConfig) {\n        this.configuration = configuration;\n        this.sdkLoader = sdkLoader;\n\n        if (!configuration.clientId) {\n            console.warn('CashAppService: clientId is missing');\n        }\n    }\n\n    private isOneTimePayment(amount: PaymentAmount): boolean {\n        return amount?.value > 0;\n    }\n\n    private isOnFilePayment(): boolean {\n        return this.configuration.storePaymentMethod;\n    }\n\n    public setStorePaymentMethod(store: boolean) {\n        this.configuration.storePaymentMethod = store;\n    }\n\n    public async initialize(): Promise<void> {\n        try {\n            const { environment, clientId } = this.configuration;\n            const cashApp = await this.sdkLoader.load(environment);\n            this.pay = await cashApp.pay({ clientId });\n        } catch (error) {\n            throw new AdyenCheckoutError('ERROR', 'Error during initialization', { cause: error });\n        }\n    }\n\n    public async renderButton(target: HTMLElement): Promise<void> {\n        try {\n            const { button, useCashAppButtonUi } = this.configuration;\n\n            const { begin } = await this.pay.render(target, {\n                manage: false,\n                button: useCashAppButtonUi ? { width: 'full', shape: 'semiround', ...button } : false\n            });\n            this.startAuthorization = begin;\n        } catch (error) {\n            throw new AdyenCheckoutError('ERROR', 'Error rendering CashAppPay button', { cause: error });\n        }\n    }\n\n    public begin(): void {\n        if (!this.startAuthorization) console.warn('CashAppService - begin() not available');\n        else this.startAuthorization();\n    }\n\n    public subscribeToEvent(eventType: CashAppPayEvents, callback: Function): Function {\n        this.pay.addEventListener(eventType, callback);\n        return () => {\n            this.pay.removeEventListener(eventType, callback);\n        };\n    }\n\n    public async createCustomerRequest(amount: PaymentAmount): Promise<void> {\n        try {\n            const { referenceId, scopeId, redirectURL = window.location.href } = this.configuration;\n\n            const customerRequest = {\n                referenceId,\n                redirectURL,\n                actions: {\n                    ...(this.isOneTimePayment(amount) && {\n                        payment: {\n                            amount,\n                            scopeId\n                        }\n                    }),\n                    ...(this.isOnFilePayment() && {\n                        onFile: {\n                            scopeId\n                        }\n                    })\n                }\n            };\n            await this.pay.customerRequest(customerRequest);\n        } catch (error) {\n            throw new AdyenCheckoutError('ERROR', 'Something went wrong during customerRequest creation', { cause: error });\n        }\n    }\n\n    public async restart(): Promise<void> {\n        await this.pay.restart();\n    }\n}\n"],"names":["CashAppService","isOneTimePayment","amount","value","isOnFilePayment","this","configuration","storePaymentMethod","setStorePaymentMethod","store","initialize","environment","clientId","cashApp","sdkLoader","load","pay","error","AdyenCheckoutError","cause","renderButton","target","button","useCashAppButtonUi","begin","render","manage","width","shape","startAuthorization","console","warn","subscribeToEvent","eventType","callback","addEventListener","removeEventListener","createCustomerRequest","referenceId","scopeId","redirectURL","window","location","href","customerRequest","actions","payment","onFile","restart","constructor","_define_property"],"mappings":"kLAKe,MAAMA,EAoBTC,gBAAAA,CAAiBC,GACrB,OAAOA,GAAQC,MAAQ,CAC3B,CAEQC,eAAAA,GACJ,OAAOC,KAAKC,cAAcC,kBAC9B,CAEOC,qBAAAA,CAAsBC,GACzBJ,KAAKC,cAAcC,mBAAqBE,CAC5C,CAEA,gBAAaC,GACT,IACI,MAAMC,YAAEA,EAAWC,SAAEA,GAAaP,KAAKC,cACjCO,QAAgBR,KAAKS,UAAUC,KAAKJ,GAC1CN,KAAKW,UAAYH,EAAQG,IAAI,CAAEJ,YACnC,CAAE,MAAOK,GACL,MAAM,IAAIC,EAAmB,QAAS,8BAA+B,CAAEC,MAAOF,GAClF,CACJ,CAEA,kBAAaG,CAAaC,GACtB,IACI,MAAMC,OAAEA,EAAMC,mBAAEA,GAAuBlB,KAAKC,eAEtCkB,MAAEA,SAAgBnB,KAAKW,IAAIS,OAAOJ,EAAQ,CAC5CK,QAAQ,EACRJ,SAAQC,GAAqB,CAAEI,MAAO,OAAQC,MAAO,eAAgBN,KAEzEjB,KAAKwB,mBAAqBL,CAC9B,CAAE,MAAOP,GACL,MAAM,IAAIC,EAAmB,QAAS,oCAAqC,CAAEC,MAAOF,GACxF,CACJ,CAEOO,KAAAA,GACEnB,KAAKwB,mBACLxB,KAAKwB,qBADoBC,QAAQC,KAAK,yCAE/C,CAEOC,gBAAAA,CAAiBC,EAA6BC,GAEjD,OADA7B,KAAKW,IAAImB,iBAAiBF,EAAWC,GAC9B,KACH7B,KAAKW,IAAIoB,oBAAoBH,EAAWC,GAEhD,CAEA,2BAAaG,CAAsBnC,GAC/B,IACI,MAAMoC,YAAEA,EAAWC,QAAEA,EAAOC,YAAEA,EAAcC,OAAOC,SAASC,MAAStC,KAAKC,cAEpEsC,EAAkB,CACpBN,cACAE,cACAK,QAAS,IACDxC,KAAKJ,iBAAiBC,IAAW,CACjC4C,QAAS,CACL5C,SACAqC,eAGJlC,KAAKD,mBAAqB,CAC1B2C,OAAQ,CACJR,oBAKVlC,KAAKW,IAAI4B,gBAAgBA,EACnC,CAAE,MAAO3B,GACL,MAAM,IAAIC,EAAmB,QAAS,uDAAwD,CAAEC,MAAOF,GAC3G,CACJ,CAEA,aAAa+B,SACH3C,KAAKW,IAAIgC,SACnB,CAtFA,WAAAC,CAAYnC,EAA8BR,GAV1C4C,EAAA7C,KAAiBS,oBACjBoC,EAAA7C,KAAiBC,wBAEjB4C,EAAA7C,KAAQW,cAKRkC,EAAA7C,KAAQwB,6BAGJxB,KAAKC,cAAgBA,EACrBD,KAAKS,UAAYA,EAEZR,EAAcM,UACfkB,QAAQC,KAAK,sCAErB"}