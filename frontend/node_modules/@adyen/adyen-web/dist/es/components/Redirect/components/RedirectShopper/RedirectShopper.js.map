{"version":3,"file":"RedirectShopper.js","sources":["../../../../../../src/components/Redirect/components/RedirectShopper/RedirectShopper.tsx"],"sourcesContent":["import { Component, h } from 'preact';\nimport detectInIframeInSameOrigin from '../../../../utils/detectInIframeInSameOrigin';\nimport { ActionHandledReturnObject } from '../../../../types/global-types';\n\ninterface RedirectShopperProps {\n    beforeRedirect: (resolve, reject, url) => Promise<void>;\n    url: string;\n    method: 'GET' | 'POST';\n    data?: any;\n    redirectFromTopWhenInIframe?: boolean;\n    paymentMethodType?: string;\n    onActionHandled?: (rtnObj: ActionHandledReturnObject) => void;\n    onRedirectError?: () => void;\n}\n\nclass RedirectShopper extends Component<RedirectShopperProps> {\n    private postForm;\n    public static defaultProps = {\n        beforeRedirect: resolve => resolve(),\n        onRedirectError: () => {},\n        method: 'GET'\n    };\n\n    componentDidMount() {\n        const doRedirect = () => {\n            // call callback\n            this.props.onActionHandled?.({\n                componentType: this.props.paymentMethodType,\n                actionDescription: 'performing-redirect'\n            });\n\n            // perform redirect\n            if (this.postForm) {\n                this.postForm.submit();\n            } else {\n                if (this.props.redirectFromTopWhenInIframe && detectInIframeInSameOrigin()) {\n                    // if in an iframe and the config prop allows it - try to redirect from the top level window\n                    window.top.location.assign?.(this.props.url);\n                } else {\n                    window.location.assign(this.props.url);\n                }\n            }\n        };\n\n        const dispatchEvent = new Promise(\n            (resolve, reject) =>\n                void this.props.beforeRedirect(resolve, reject, {\n                    url: this.props.url,\n                    method: this.props.method,\n                    ...(this.props.data ? { data: this.props.data } : {})\n                })\n        );\n\n        dispatchEvent.then(doRedirect).catch(() => {\n            this.props.onRedirectError();\n        });\n    }\n\n    render({ url, method, data = {} }) {\n        if (method === 'POST') {\n            return (\n                <form\n                    method=\"post\"\n                    data-testid=\"redirect-shopper-form\"\n                    action={url}\n                    style={{ display: 'none' }}\n                    ref={ref => {\n                        this.postForm = ref;\n                    }}\n                    {...(this.props.redirectFromTopWhenInIframe && detectInIframeInSameOrigin() && { target: '_top' })}\n                >\n                    {Object.keys(data).map(key => (\n                        <input type=\"hidden\" name={key} key={key} value={data[key]} />\n                    ))}\n                </form>\n            );\n        }\n\n        return null;\n    }\n}\n\nexport default RedirectShopper;\n"],"names":["RedirectShopper","Component","componentDidMount","Promise","resolve","reject","this","props","beforeRedirect","url","method","data","then","onActionHandled","componentType","paymentMethodType","actionDescription","postForm","submit","redirectFromTopWhenInIframe","detectInIframeInSameOrigin","window","top","location","assign","catch","onRedirectError","render","h","form","data-testid","action","style","display","ref","target","Object","keys","map","key","input","type","name","value","super","args","_define_property","defaultProps"],"mappings":"iRAeA,MAAMA,UAAwBC,EAQ1BC,iBAAAA,GAqB0B,IAAIC,QACtB,CAACC,EAASC,KACDC,KAAKC,MAAMC,eAAeJ,EAASC,EAAQ,CAC5CI,IAAKH,KAAKC,MAAME,IAChBC,OAAQJ,KAAKC,MAAMG,UACfJ,KAAKC,MAAMI,KAAO,CAAEA,KAAML,KAAKC,MAAMI,MAAS,CAAA,MAIhDC,KA7BK,KAEfN,KAAKC,MAAMM,kBAAkB,CACzBC,cAAeR,KAAKC,MAAMQ,kBAC1BC,kBAAmB,wBAInBV,KAAKW,SACLX,KAAKW,SAASC,SAEVZ,KAAKC,MAAMY,6BAA+BC,IAE1CC,OAAOC,IAAIC,SAASC,SAASlB,KAAKC,MAAME,KAExCY,OAAOE,SAASC,OAAOlB,KAAKC,MAAME,OAcfgB,MAAM,KACjCnB,KAAKC,MAAMmB,mBAEnB,CAEAC,MAAAA,EAAOlB,IAAEA,EAAGC,OAAEA,EAAMC,KAAEA,EAAO,CAAA,IACzB,MAAe,SAAXD,EAEIkB,EAACC,OAAAA,CACGnB,OAAO,OACPoB,cAAY,wBACZC,OAAQtB,EACRuB,MAAO,CAAEC,QAAS,QAClBC,IAAKA,IACD5B,KAAKW,SAAWiB,MAEf5B,KAAKC,MAAMY,6BAA+BC,KAAgC,CAAEe,OAAQ,SAExFC,OAAOC,KAAK1B,GAAM2B,IAAIC,GACnBX,EAACY,QAAAA,CAAMC,KAAK,SAASC,KAAMH,EAAKA,IAAKA,EAAKI,MAAOhC,EAAK4B,OAM/D,IACX,mBAhEJK,SAAAC,GACIC,EAAAxC,KAAQW,oBACR6B,EAFE9C,EAEY+C,eAAe,CACzBvC,eAAgBJ,GAAWA,IAC3BsB,gBAAiB,OACjBhB,OAAQ"}